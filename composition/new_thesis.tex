% Packages and bibliography
\documentclass[english,a4paper,12pt,oneside]{scrbook}
\usepackage[utf8]{inputenc}
\usepackage{amsmath, amsthm, amssymb}
\usepackage[english]{babel}
\usepackage{marvosym}
\usepackage{graphics}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{float}
\usepackage{mathtools}
\usepackage{calrsfs}
\DeclareMathAlphabet{\pazocal}{OMS}{zplm}{m}{n}
\usepackage[toc,page]{appendix}
\usepackage{xcolor}
\usepackage{cleveref}
\usepackage[backend=bibtex]{biblatex}
\usepackage[nottoc,notlot,notlof]{tocbibind}
\usepackage{tikz-cd}
\addbibresource{Bibliography/bibliography.bib}

% Formatting options
\setlength{\parindent}{0em}
\parskip = 0.35cm \relax
%\renewcommand{\baselinestretch}{1.25}

% Equations and theorems style
\counterwithin*{equation}{section}
\counterwithin*{equation}{subsection}
\renewcommand{\theequation}{%
  \thesection.%
  \ifnum\value{subsection}>0 \arabic{subsection}.\fi
  \arabic{equation}%
}
\newtheoremstyle{break}
  {\topsep}{\topsep}%
  {\upshape}{}%
  {\bfseries}{}%
  {\newline}{}%
\theoremstyle{break}
\newtheorem{thm}[equation]{Theorem}
\newtheorem{cor}[equation]{Corollary}
\newtheorem{lemma}[equation]{Lemma}
\newtheorem{defn}[equation]{Definition}
\newtheorem{prop}[equation]{Proposition}
\newtheorem{ass}[equation]{Assumption}
\newtheorem{pb}[equation]{Problem}
\newenvironment{mproof}[1][\proofname]{%
  \begin{proof}[#1]$ $\par\nobreak\ignorespaces
}{%
  \end{proof}
}
\renewcommand*{\proofname}{Proof}
\theoremstyle{remark}
\newtheorem{obs}[equation]{Observation}
\newtheorem{es}[equation]{Example}

% Useful commands
\newcommand{\mR}{\mathbb{R}}
\newcommand{\mS}{\mathbb{S}^{n-1}}
\newcommand{\cV}{\pazocal{V}}
\newcommand{\ds}{\displaystyle}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
\newcommand{\HN}[1]{\norm{#1}_{H}}
\newcommand{\VN}[1]{\norm{#1}_{V}}
\newcommand{\VSN}[1]{\norm{#1}_{V^*}}
\newcommand{\tr}{\text{tr}}
\newcommand{\cc}{\subset\subset}
\newcommand{\emb}{\hookrightarrow}
\newcommand{\ind}[1]{\{\text{ #1 }\}}
\newcommand{\mind}[1]{$#1$}
\newcommand{\cT}{\pazocal{T}}
\newcommand{\id}{\text{Id}}
\newcommand{\te}{\theta}
\newcommand{\Te}{\Theta}
\newcommand{\tred}[1]{\textcolor{red}{#1}}
\newcommand{\dive}{\text{div}}
\newcommand{\weakc}{\rightharpoonup}
\newcommand{\xh}{\hat{x}}
\newcommand{\yh}{\hat{y}}
\newcommand{\eps}{\epsilon}

\begin{document}

% Titelseite
\pagestyle{empty}       % keine Seitennummer
  \parbox{1.5cm}{\resizebox*{110pt}{!}{\includegraphics{Logos/blau/2015_Logo_TUM_CMYK.pdf}}}\hspace{310pt}%
  \parbox{1.5cm}{\resizebox*{90pt}{!}{\includegraphics{Logos/08_Mathematik/MA_blau/FAK_MA_CMYK.pdf}}}%
\vspace*{1.5cm}
\begin{center}
{\Huge Technical University of Munich}
\\
\vspace*{1.5cm}
{\huge \textsc{Department of Mathematics}}
\\
\vspace*{3cm}
{\Huge \textbf{[Thesis Title]}}
\\
\vspace*{3cm}
{\Large Master's Thesis}\linebreak \\
{\Large von}\linebreak \\
{\Large [First Name Last Name]}\\
\vspace*{3cm}
{\Large 
\begin{tabular}{ll}
Supervisor: & Prof. Dr. [First Name Last Name]\\
Advisor: & [First Name Last Name]\\
Submission Date: & [Day. Month. Year]
\end{tabular}
}
\end{center}
\newpage    % Seitenwechsel

% Seite 2
\vspace*{18cm}
\noindent
I hereby declare that this thesis is my own work and that no other sources have been used except those clearly indicated and referenced.
\\[2cm]
Place, Date\\
original, hand-written signature
\newpage

% vertikaler Leerraum
\vspace*{2.2cm}
\noindent %kein Einzug
{\Huge \textbf{Acknowledgements}} \\
\vspace*{1.6cm} \\
% Seitennummerierung "rï¿½misch
\pagenumbering{roman}
% Kopfzeilen (automatisch erzeugt)
\pagestyle{headings}
[text of acknowledgements]

% Seite 3
\newpage
\section*{German Abstract}
[abstract text]
\section*{English Abstract}
[abstract text]
%Seite 4
\newpage
\tableofcontents  

\pagenumbering{arabic}  % Nummerierung der Seiten in 'arabisch' % neues Kapitel mit Namen "Introduction"

\chapter{Introduction}  \setcounter{page}{1}   % setzt Seitenzaehlung auf 1

\chapter{Continuous problem}

\section{Gateaux differentiability}

\begin{ass}[Geometry assumptions for the shape optimization problem]
\label{ass:geo_sh}
Let $D\subseteq \mR^n$ be a bounded Lipschitz domain, and $\Omega_r \cc D$ also bounded Lipschitz. Call $U_r:=D\setminus \Omega_r$, another bounded Lipschitz domain.
\end{ass}

\begin{defn}[Admissible transformations]

Given $D$, we consider the set $\cT$ as defined in \cref{def:adm}, based on the perturbations $\Te$, also defined in \cref{def:adm}.

We consider $\cT_a:=\cT \cap \{ \tau \in W^{1,\infty}(\mR^n, \mR^n), \norm{\tau - \id}_{W^{1,\infty}(\mR^n, \mR^n)}<C(U_r)\}$, where $C(U_r)$ is given by \cref{thm:ptb_id_lip}.

This ensures that $T(U_r)\cc D$ is also bounded Lipschitz, $T$ the unique Lipschitz continuous representive of any $\tau \in \cT_a$ (see \cref{prop:lipk}).

Thanks to \cref{prop:ptb_id}, a small $\Te$ perturbation of $\tau \in \cT_a$ done in the $W^{1,\infty}(D;\mR^n)$ topology leaves us inside $\cT_a$.

\end{defn}

Note, we need $T$ to have a Lipschitz inverse to conclude $T(U_r)\cc D$: for $x \in D$, we have $0<\delta = \inf_{d \in \partial D}|x-d|\leq \norm{T^{-1}}_{W^{1,\infty}(\mR^n,\mR^n)}\inf_{d \in \partial D}|T(x)-d|$.

We are interested in solving the following problem.

\begin{pb}[Shape optimization problem]
\label{pb:shopt}
Suppose \cref{ass:geo_sh}, \cref{ass:diri}, \cref{ass:neu} hold. Using the notation $T = U(\tau)$ for "unique continuous representative" of $\tau$, we want to solve:

$$\inf_{\tau \in \cT_a}\frac{1}{2}\norm{v_\tau-w_\tau}_{L^2(I,H_T)}^2=:J(\tau)$$

Here $v^\tau = v_0^\tau + \bar{u}$, and $v_0^\tau, w_\tau$ are given in \cref{pb:joint_mov} and $\bar{u}$ is given in \cref{pb:diri_ext}. The notation for the spaces also comes from  \cref{pb:joint_mov}, where $\cdot_T$ means a space defined on the moving domain, $H=L^2, W=H^1_0, V = H^1_c$ (and the last space is defined in \cref{subs:inh_diri}).

\end{pb}

\begin{obs}[Well posedness of $J$]

We know from \cref{prop:diri_wp} that $v_0^T + \bar{u}$ doesn't depend on the particular choice of $\bar{u}$, therefore, for different $\tau$'s yielding the same domain, $J(\tau)$ doesn't change.

\end{obs}

Moreover, \cref{ass:geo_sh} ensures in particular \cref{ass:pull}, which enables the applicability of \cref{thm:eq_pde}.

Now, let $U:=T(U_r)$, for $T \in \cT_a$ (we write $T \in \cT_a$ for $\tau \in \cT_a$, $U(\tau)=T$) and let $\delta \te \in \Te$. 

We are interested in finding $J'(\tau) \in \Te^*$ such that, for all $\delta \te_k \rightarrow 0$ in $\Te$, we have:


$$\lim_{k}\frac{|J(\tau+\delta \te_k)-J(\tau)-J'(\tau)(\delta \te_k)|}{\norm{\delta \te_k}_{\Te}}$$

For simplificity we have put $\norm{\te}_\Te = \norm{\te}_{W^{1,\infty}(\mR^n;\mR^n)}=\norm{\te}_{W^{1,\infty}(D;\mR^n)}$.

Note, $\tau+\delta \te_k \in \cT_a$ for large enough $k$. In fact, $\tau+\delta \te_k \in \cT$ for large $k$ as in \cref{prop:ptb_id}, and the condition on $C(U_r)$ is satisfied too, because $\te :=\tau-\id$ was already in the $W^{1,\infty}$ open ball of radius $C(U_r)$ centered at the origin, and so will be $\te + \delta_k\te$, always for large $k$.

Now, $\tau+\delta \te_k  = (\id+\delta\te_k \circ \tau^{-1})\circ \tau$, and $\id+\delta\te_k \circ \tau^{-1}$ is in $\cT_a$ (it is in $\cT$ by \cref{prop:ptb_id} and the reasoning above shows it is also in $\cT_a$).

We are then equivalently interested in:

$$\lim_{k}\frac{|J((\id+\delta\te_k \circ \tau^{-1})\circ \tau)-J(\tau)-J'(\tau)(\delta \te_k)|}{\norm{\delta \te_k}_{\Te}}$$

This amounts to setting the reference domain to $T(U_r)$ instead of $U_r$ and perturbing the former, at least for the sake of computing derivatives.

We now introduce a Lagrangian.

For $k\geq K(T)$ we define $T_k:=\id+\delta\te_k \circ \tau^{-1} \in \cT_a$, as seen above.

With the help and the notation of \cref{thm:eq_pde} we can set:

\begin{align*}
L_T(k,w,v_0,q,p) = \\
\frac{1}{2}\int_I \int_{T(U_r)}|v_0+\bar{u}_T\circ T_k - w|^2|\det(DT_k)|+\\
\int_I ( w_t , q |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla w, \nabla q)_{H_T} -\int_I(g,\tr_{U} q)_{L^2(\Gamma_f)} +\\ \int_I (v_{0t},p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla v_0, \nabla p)_{H_T}+\\\int_I((\bar{u}\circ T_k)',p|\det(DT_k)|)_{H_T}+(A_{T_k} \nabla (\bar{u} \circ T_k), \nabla p)_{H_T}
\end{align*}

for $w \in Q_0(I, V_T), v_0 \in Q_0(I,W_T), q \in Q^0(I, V_T), p \in Q^0(I, W_T)$. Remember,  $A_T:=  (DT)^{-1}(DT)^{-t}|\det(DT)|$.

Note that to be precise, $\bar{u}$ is an extension (any extension in fact, satisfying the conditions of \cref{pb:diri_ext}) of the Dirichlet datum $f$, on the moving domain $T_k(T(U_r))$. Because of this, let's fix $\bar{u}_T$ with this property on $T(U_r)$. We show that $\bar{u}_T\circ T_k^{-1}$ satisfies the conditions stated in \cref{pb:diri_ext}. 

In particular:

\begin{itemize}
	\item composition with $T$ preserves the smoothness of the extension, as seen in \cref{lemma:bochner_Hk_map}, given that $\circ T_k^{-1}$ is a linear bounded operator between $V_T$ and $V_{T_k \circ T}$ (see \ref{thm:change})
	\item the initial value is preserved, as seen in the proof of \cref{prop:change_boch}
	\item the trace on $\Sigma_f$ is preserved, because the trace on $\Gamma_f=\partial D$ is preserved, see \cref{thm:change}
\end{itemize}

Therefore we can state the following definition.

\begin{defn}[Lagrangian]

For a fixed $T \in \cT_a$ and  $k\geq K(T)$, for $T_k:=\id+\delta\te_k \circ \tau^{-1} \in \cT_a$, we define:

\begin{align*}
L_T(k,w,v_0,q,p) = \\
\frac{1}{2}\int_I \int_{T(U_r)}|v_0+\bar{u}_T - w|^2|\det(DT_k)|+\\
\int_I ( w_t , q |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla w, \nabla q)_{H_T} -\int_I(g,\tr_{U} q)_{L^2(\Gamma_f)} +\\ \int_I (v_{0t},p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla v_0, \nabla p)_{H_T}+\\\int_I(\bar{u}_T',p|\det(DT_k)|)_{H_T}+(A_{T_k} \nabla \bar{u}_T , \nabla p)_{H_T}
\end{align*}

$L_T$ is defined as a map $\{k\geq K(T)\}\times Q_0(I, V_T)\times Q_0(I,W_T)\times Q^0(I, V_T)\times Q^0(I, W_T)\rightarrow \mR$.

We call $u = (w,v_0)$, $\pi = (q,p)$, $G(k,u,\pi) = L_T(k,w,v_0,q,p)$ to ease the notation.

We also call $b(k, u) = \frac{1}{2}\int_I \int_{T(U_r)}|v_0+\bar{u}_T - w|^2|\det(DT_k)|$ and $a(k, u,\pi) = G(k,u,\pi)-b(k, u)$, $E = Q_0(I, V_T)\times Q_0(I,W_T)$, $F=Q^0(I, V_T)\times Q^0(I, W_T)$.

\end{defn}

\begin{prop}[Properties of the Lagrangian]
\label{prop:lagr}

$L_T$ satisfies the following properties:

\begin{enumerate}
	\item $\psi \mapsto a(k, \phi,\psi)$ is linear, no matter what $\phi,k$
	\item $G$ is Frechet differentiable with respect to $\psi$ at $(k,\phi,0)$ for all $k, \phi$
	\item $d_\psi G(k,\phi,0)[\delta \psi]=0$ for all $\delta \psi \in F$ admits a unique solution $\phi = u^k$
	\item $[0,1]\ni s \mapsto G(k, su^k + (1-s)u^0,\psi)$ is $AC[0,1]$, no matter what $k, \psi$
	\item $G$ is Frechet differentiable with respect to $\phi$ at $(k,\psi,\phi)$ for all $k, \psi, \phi$
	\item $[0,1]\ni s \mapsto d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi]$ is $L^1(0,1)$, no matter what $k, \psi, \delta \phi$
	\item there exists a unique solution $\psi = \pi^k$ to $\ds \int_0^1 d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi]ds =0$ for all $\delta \psi$ 
\end{enumerate}

In particular $\pi^k = (Q^k \circ \tau^k,P^k \circ \tau^k)$, where we introduced the averaged adjoint problems on the moving domain:

\begin{pb}[Averaged adjoint equations]
\label{pb:avg_adj_pb}
\begin{align*}
-Q^k_t-\Delta Q^k =\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} \\
Q^k(T)=0\\
\partial_\nu Q^k = 0 \text{ on } \Sigma_f\\
Q^k = 0 \text{ on } \Sigma_m^{T_k\circ T}
\end{align*}

and

\begin{align*}
-P^k_t-\Delta P^k =-\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}-\bar{u}_T\circ T_k^{-1} \\
P^k(T)=0\\
P^k = 0 \text{ on } \Sigma_m^{T_k\circ T} \sqcup \Sigma_f
\end{align*}
\end{pb}

\end{prop}

\begin{mproof}

The first point is immediate.

\underline{Proof of 2}

All the pieces are linear in $\psi$. We only check the boundedness of the various differentials. For simplicity, call $|\det(DT_k)|=d$, and note that   $\norm{qd}_{H_T}\leq C(d)\norm{q}_{H_T}$.

And now, for instance:
%\int_I \langle w_t , q |\det(DT_\e)|\rangle_{V^*_T,V_T}+ (A_{T_\e}\nabla w, \nabla q)_{H_T} -\int_I(g,\tr_{U} q)_{L^2(\Gamma_f)}
\begin{align*}
\int_I ( w_t , \delta q |\det(DT_k)|)_{H_T} = \int_I ( w_t , \delta q d )_{H_T}\leq\\ C(d) \int_I \norm{w_t}_{H_T}\norm{\delta q}_{H_T}\leq C(d) \norm{w_t}_{L^2(I,H_T)}\norm{\delta q}_{L^2(I,H_T)}\leq\\C(d) \norm{w}_{Q(I,V_T)}\norm{\delta q}_{Q(I,V_T)}\leq
C(d) \norm{w}_{Q(I,V_T)}(\norm{\delta q}_{Q(I,V_T)}+\norm{\delta p}_{Q(I,V_T)}) =\\ C(d) \norm{w}_{Q(I,V_T)}\norm{\delta\psi}_F
\end{align*}

Or also:

\begin{align*}
\int_I(g,\tr_{U} \delta q)_{L^2(\Gamma_f)}\leq \int_I \norm{g}_{L^2(\Gamma_f)}\norm{\delta q}_{V_T}\leq \norm{g}_{H^1(I,L^2(\Gamma_f))}\norm{\delta\psi}_F
\end{align*}

and:

\begin{align*}
\int_I (A_{T_k} \nabla \bar{u}_T, \nabla\delta p)_{H_T}\leq C\norm{A_{T_k}}_{L^\infty(D;\mR^{n\times n})}\int_I \norm{\nabla \bar{u}_T}_{L^2(I,H_T)}\norm{\nabla\delta p}_{L^2(I,H_T)}\leq\\ C(T) \norm{\delta\psi}_F \norm{\bar{u}}_{H^1(I,V_T)}
\end{align*}

\underline{Proof of 3}

We get back the state equations, thanks to linearity, and by testing separately with $\delta \psi =(\delta q, 0)$ and $\delta \psi = (0,\delta p)$, so that a unique solution exists by \cref{thm:eq_pde}.

\underline{Proof of 4}

Every piece but $b$ is linear or constant in the state $\phi$. We only need to prove that $[0,1]\ni s \mapsto b(k, su^k + (1-s)u^0)$ is $AC[0,1]$. But by the structure of the cost function $J$, transported on $T(U_r)$, we see that the latter is a quadratic polynomial in $s$, hence, absolutely continuous.

\underline{Proof of 5}

For the pieces with the gradients, it follows as above, by in case employing the simmetry of $A_{T_k}$.

Now, for instance the linear form $\delta v_0 \mapsto \int_I (\delta v_{0t},p |\det(DT_k)|)_{H_T}$ is also bounded by $C(d) \norm{\delta v_0}_{Q(I,W_T)}\norm{\delta q}_{Q(I,V_T)}$ just like before.

What remains to check is the Frechet differentiability of $b$.

To do so, perturb $\phi$ by $\delta \phi$ and expanding the square:

\begin{align*}
\frac{1}{2}\int_I \int_{T(U_r)}|v_0+\delta v_0+\bar{u}_T - w-\delta w|^2|\det(DT_k)| = \\\frac{1}{2}\int_I \int_{T(U_r)}|v_0+\bar{u}_T - w|^2|\det(DT_k)|+\\\frac{1}{2}\int_I \int_{T(U_r)}|\delta v_0-\delta w|^2|\det(DT_k)|+\\\int_I \int_{T(U_r)}(v_0+\bar{u}_T - w)(\delta v_0-\delta w)|\det(DT_k)|
\end{align*} 

Now, $\ds \int_I \int_{T(U_r)}|\delta v_0-\delta w|^2|\det(DT_k)|\leq C(T_k)\norm{\delta v_0-\delta w}_{L^2(I,H_T)}^2\leq C(T_k)\norm{\phi}_E^2$, so that this term is of higher term.

And $\int_I \int_{T(U_r)}(v_0+\bar{u}_T - w)(\delta v_0-\delta w)|\det(DT_k)|$ is linear and bounded by reasonings similar to the former ones.

\underline{Proof of 6}

By the last point:

\begin{align*}
d_\phi G(k, \phi ,\psi)[\delta \phi] =\\
\int_I ((v_0+\bar{u}_T - w)|\det(DT_k)|,\delta v_0-\delta w)_{H_T}+\\
\int_I (\delta w_t , q |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla \delta w, \nabla q)_{H_T}+\\
\int_I (\delta v_{0t},p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla \delta v_0, \nabla p)_{H_T}
\end{align*}

so that:

\begin{align*}
d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi] = \\
\int_I ((s(v_0^k+\bar{u}_T - w^k)+(1-s)(v_0^0+\bar{u}_T - w^0))|\det(DT_k)|,\delta v_0-\delta w)_{H_T}+\\
\int_I ( \delta w_t , q |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla \delta w, \nabla q)_{H_T}+\\
\int_I ( \delta v_{0t},p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla \delta v_0, \nabla p)_{H_T}
\end{align*}

which is a degree $1$ polynomial in $s$, hence, $L^1(0,1)$.

\underline{Proof of 7}

Rewriting the formula above and integrating in $s$, we come to:

\begin{align*}
\int_0^1d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi]ds = \\
\int_I (((v_0^k+\bar{u}_T - w^k)+(v_0^0+\bar{u}_T - w^0))/2|\det(DT_k)|,\delta v_0-\delta w)_{H_T}+\\
\int_I ( \delta w_t , q |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla \delta w, \nabla q)_{H_T}+\\
\int_I ( \delta v_{0t},p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla \delta v_0, \nabla p)_{H_T}
\end{align*}

As in \cref{prop:change_boch}, $ \delta w_t  = (\delta w\circ T_k^{-1})_t\circ T_k$, where $\delta w\circ T_k^{-1} \in Q_0(I,V_{T_k \circ T})$ by \cref{prop:change_boch} (that can be applied thanks to the smallness of $T_k$).

Applying a change of variables we are left with:

\begin{align*}
\int_0^1 d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi]ds = \\
\int_I \left (\frac{v_0^k-w^k}{2}\circ T_k^{-1}+ \frac{v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta v_0\circ T_k^{-1}-\delta w\circ T_k^{-1}\right)_{H_{T_k \circ T}}+\\
\int_I ((\delta w\circ T_k^{-1})_t , q\circ T_k^{-1} )_{H_{T_k \circ T}}+ (\nabla (\delta w\circ T_k^{-1}), \nabla( q\circ T_k^{-1}))_{H_{T_k \circ T}}+\\
\int_I ( (\delta v_{0}\circ T_k^{-1})_t,p \circ T_k^{-1})_{H_{T_k \circ T}} + ( \nabla \delta (v_0\circ T_k^{-1}), \nabla (p\circ T_k^{-1}))_{H_{T_k \circ T}}
\end{align*}

Here, as we saw in \cref{prop:change_boch}, we have $\delta w\circ T_k^{-1}, w\circ T_k^{-1} \in Q_0(I, V_{T_k \circ T})$, $ \delta v_{0}\circ T_k^{-1}, v_{0}\circ T_k^{-1} \in Q_0(I,W_{T_k \circ T})$, $q\circ T_k^{-1}\in Q^0(I, V_{T_k \circ T})$ and $p\circ T_k^{-1}\in Q^0(I, W_{T_k \circ T})$.

Because $\circ T_k^{-1}$ is a bijection of $Q_0(I,W_{T_k \circ T})$ and $Q_0(I,W_{T_k})$ as we saw in \ref{prop:change_boch} (and analogously of $V$), we have that  $\int_0^1 d_\phi G(k, su^k + (1-s)u^0,\psi)[\delta \phi]ds=0$ for all $\delta \phi \in E$ if and only if:

\begin{align*}
\int_I \left (\frac{v_0^k+w^k}{2}\circ T_k^{-1}- \frac{v_0^0+w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta V_0-\delta W\right)_{H_{T_k \circ T}}+\\
\int_I ( \delta W_t , q\circ T_k^{-1})_{H_{T_k \circ T}}+ (\nabla\delta W, \nabla( q\circ T_k^{-1}))_{H_{T_k \circ T}}+\\
\int_I ( \delta V_{0t},p \circ T_k^{-1})_{H_{T_k \circ T}} + ( \nabla \delta V_0, \nabla (p\circ T_k^{-1}))_{H_{T_k \circ T}} = 0
\end{align*}

for all $\delta W, \in Q_0(I, V_{T_k \circ T})$, $ \delta V_{0} \in Q_0(I,W_{T_k \circ T})$.

We wish to find a (unique) solution $(q^k, p^k) \in Q^0(I, V_T)\times Q^0(I, W_T)$ of this problem. We can equivalently (by \cref{prop:change_boch}) find $(Q^k, P^k) \in Q^0(I, V_{T_k \circ T})\times Q^0(I, W_{T_k \circ T})$ satisfying:

\begin{align*}
\int_I \left (\frac{v_0^k-w^k}{2}\circ T_k^{-1}+ \frac{v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta V_0-\delta W\right)_{H_{T_k \circ T}}+\\
\int_I (\delta W_t ,Q^k )_{H_{T_k \circ T}}+ (\nabla \delta W, \nabla Q^k)_{H_{T_k \circ T}}+\\
\int_I( \delta V_{0t},P^k)_{H_{T_k \circ T}} + ( \nabla \delta V_0, \nabla P^k)_{H_{T_k \circ T}} = 0
\end{align*}

for all $\delta W, \in Q_0(I, V_{T_k \circ T})$, $ \delta V_{0} \in Q_0(I,W_{T_k \circ T})$.

By testing first with $\delta W=0$ and then with $\delta V_0=0$ we can equivalently look for:

\begin{align*}
(Q^k, P^k) \in Q^0(I, V_{T_k \circ T})\times Q^0(I, W_{T_k \circ T}) \text{ with }\\
\int_I (\delta W_t ,Q^k)_{H_{T_k \circ T}}+ (\nabla \delta W, \nabla Q^k)_{H_{T_k \circ T}} =\\ \int_I \left (\frac{v_0^k+w^k-v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta W\right)_{H_{T_k \circ T}}\\
\int_I ( \delta V_{0t},P^k)_{H_{T_k \circ T}}+ ( \nabla \delta V_0, \nabla P^k)_{H_{T_k \circ T}} =\\- \int_I \left (\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta V_0\right)_{H_{T_k \circ T}}
\end{align*}

An application of integration by parts in time (see \cref{prop:Q}) yields the problem:

\begin{align*}
(Q^k, P^k) \in W^0(I, V_{T_k \circ T})\times W^0(I, W_{T_k \circ T}) \text{ with }\\
-\int_I ( Q^k_t, \delta W )_{H_{T_k \circ T}}+ (\nabla \delta W, \nabla Q^k)_{H_{T_k \circ T}} =\\ \int_I \left (\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta W\right)_{H_{T_k \circ T}}\\
-\int_I( P^k_t, \delta V_0)_{H_{T_k \circ T}} + ( \nabla \delta V_0, \nabla P^k)_{H_{T_k \circ T}} =\\- \int_I \left (\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} ,\delta V_0\right)_{H_{T_k \circ T}}
\end{align*}

But this is the weak formulation (cfr. \cref{thm:eq_pde}, \cref{pb:diri_ext}, \cref{pb:neu}) of the problems:

\begin{align*}
-Q^k_t-\Delta Q^k =\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} \\
Q^k(T)=0\\
\partial_\nu Q^k = 0 \text{ on } \Sigma_f\\
Q^k = 0 \text{ on } \Sigma_m
\end{align*}

and

\begin{align*}
-P^k_t-\Delta P^k =-\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}-\bar{u}_T\circ T_k^{-1} \\
P^k(T)=0\\
P^k = 0 \text{ on } \Sigma_m \sqcup \Sigma_f
\end{align*}

Applying the time reversal $t\mapsto T -t$ (where $I = [0,T]$), these are a couple of standard heat equations for which we have available existence, uniqueness and stability results (see \cref{chap:parab_eq}, and \cref{prop:eq_form}).

By calling then $\pi^k = (Q^k \circ T^k,P^k \circ T^k)$ we conclude the proof.

\end{mproof}

We now turn to the verification of Gateaux differentiability of $J$, applying the techniques proposed in \cite{avg_adj}.

\begin{prop}[Averaged adjoint method for Gateaux derivatives]
\label{prop:adv_adj}

If $J'(\tau) \in \Te^*$ satisfies:

$$\lim_{k}\frac{G(k,u^0,\pi^k)-G(0,u^0,\pi^k)}{t_k}=J'(\tau)[\delta \te]$$

where $\delta\te_k = t_k\delta \te$ for $t_k\rightarrow 0$, then $J'(\tau)$ is the Gateaux derivative of $J$ at $\tau$.

\end{prop}

\begin{mproof}

We have $G(k,u^k,\pi^k)-G(k,u^0,\pi^k)  = \int_0^1 d_\phi G(k, su^k + (1-s)u^0,\pi^k)[u^k-u^0]ds = 0$ because $u^k-u^0 \in E$, and by absolute contintinuity and integrability of derivative as seen in \cref{prop:lagr}.

Moreover, calling $g_k = G(k,u^k,0)-G(0,u^0,0)$, we have:

\begin{itemize}
	\item $g_0 = 0$
	\item $g_k = J((\id+\delta\te_k \circ \tau^{-1})\circ \tau)-J(\tau)$, thanks again to a change of variables
	\item $g_k = G(k,u^k,\pi^k)-G(0,u^0,\pi^k)$ thanks to $\pi^k \in F$ and the state equations (note, this is possible because $k,u^k$ appear, and $0,u^0$ appear, so that the indices don't mix)
\end{itemize}

And now, $J(\tau+\delta\te_k)-J(\tau) = J((\id+\delta\te_k \circ \tau^{-1})\circ \tau)-J(\tau) = g_k = G(k,u^k,\pi^k)-G(0,u^0,\pi^k) = G(k,u^k,\pi^k)-G(k,u^0,\pi^k)+G(k,u^0,\pi^k)-G(0,u^0,\pi^k) = G(k,u^0,\pi^k)-G(0,u^0,\pi^k)$.

\end{mproof}

\begin{prop}[Gateaux differentiability of $J$]
Given $\tau \in \cT_a$, $J$ is Gateaux differentiable at $\tau$ with respect to the $W^{1,\infty}$ topology. The Gateaux differential is:


\begin{align*}
J'(\tau)[\delta \te] =\\ \int_I (w_t^\tau \dive(\delta \te\circ  \tau^{-1}), q^\tau )+ \int_I (A'(\delta\te \circ \tau^{-1})\nabla v^\tau, \nabla p^\tau)+\\
\int_I (v_t^\tau \dive(\delta \te\circ  \tau^{-1}), p^\tau )+ \int_I (A'(\delta\te \circ \tau^{-1})\nabla w^\tau, \nabla q^\tau)+\\
\frac{1}{2}\int_I\int_{T(U_r)}|v^\tau-w^\tau|^2\dive(\delta \te\circ  \tau^{-1})
\end{align*}

where $p^\tau$, $q^\tau$ solve:

\begin{align*}
-q^\tau_t-\Delta q^\tau =v^\tau-w^\tau\\
q^\tau(T)=0\\
\partial_\nu q^\tau = 0 \text{ on } \Sigma_f\\
q^\tau = 0 \text{ on } \Sigma_m^{T_k\circ T}
\end{align*}

and

\begin{align*}
-p^\tau_t-\Delta p^\tau = - v^\tau+ w^\tau \\
p^\tau(T)=0\\
p^\tau = 0 \text{ on } \Sigma_m^{T_k\circ T} \sqcup \Sigma_f
\end{align*}

and where $A'(\delta\te )= - D\delta \te -(D\delta\te)^t + \dive(\delta\te)$.

\end{prop}

\begin{mproof}

\underline{The shape derivative is linear and bounded}

Linearity is immediate. For the boundedness:

\begin{align*}
|J'(\tau)[\delta \te]| \leq\\ \norm{\dive(\delta \te\circ  \tau^{-1})}_{L^\infty(T(U_r))}\left (\int_I( \norm{q_t^\tau}_{H^T}\norm{q^\tau}_{H_T}+ \norm{v_t^\tau}_{H_T}\norm{p^\tau}_{H_T})+\frac{1}{2}\norm{v^\tau-w^\tau}^2_{L^2(I,H_T)}\right )+\\
\left(\sum_{ij} \norm{(A'(\delta\te \circ \tau^{-1})_{ij}}_{L^\infty(T(U_r))}\right )\left (
\int_I \norm{\nabla v^\tau}_{H_T} \norm{\nabla p^\tau}_{H_T}+ \int_I \norm{\nabla w^\tau}_{H_T} \norm{\nabla q^\tau}_{H_T}\right )
\end{align*}

and then, for $C$ independent of $\delta \te$:

\begin{align*}
|J'(\tau)[\delta \te]| \leq\\ C \left ( \norm{\dive(\delta \te\circ  \tau^{-1})}_{L^\infty(T(U_r))}+\left(\sum_{ij} \norm{(A'(\delta\te \circ \tau^{-1})_{ij}}_{L^\infty(T(U_r))}\right )\right )\leq\\
\norm{\delta \te \circ \tau^{-1}}_{W^{1,\infty}(\mR^n;\mR^n)}\leq \\
C\norm{\delta \te }_{W^{1,\infty}(\mR^n;\mR^n)}
\end{align*}

where in the last step we applied point i) of lemme 2.2, \cite{murat}. This shows the boundedness.

\underline{Conclusion}

Assume $p^k \weakc p^0$ in $Q(I,W_T)$ and $q^k \weakc q^0$ in $Q(I,V_T)$.

Now, using that $u^0=(w^\tau, v_0^\tau)$:

\begin{align*}
G(k,u^0,\pi^k)-G(0,u^0,\pi^k) =\\
\frac{1}{2}\int_I \int_{T(U_r)}|v^\tau-w^\tau|^2|\det(DT_k)|+\\
\int_I ( w_t^\tau |\det(DT_k)| , q^k)_{H_T}+ (A_{T_k}\nabla w^\tau, \nabla q^k)_{H_T} -\int_I(g,\tr_{U} q^k)_{L^2(\Gamma_f)} +\\ \int_I (v_t^\tau |\det(DT_k)|,p^k )_{H_T} + (A_{T_k} \nabla v^\tau, \nabla p^k)_{H_T} - \\
\frac{1}{2}\int_I \int_{T(U_r)}|v^\tau-w^\tau|^2-\\
\int_I ( w_t^\tau , q^k )_{H_T}+(\nabla w^\tau, \nabla q^k)_{H_T} +\int_I(g,\tr_{U} q^k)_{L^2(\Gamma_f)} -\\ \int_I (v_t^\tau,p^k )_{H_T} + ( \nabla v^\tau, \nabla p^k)_{H_T} \\
\end{align*}

Grouping some terms and cancelling the boundary integral:

\begin{align*}
G(k,u^0,\pi^k)-G(0,u^0,\pi^k) =\\
\frac{1}{2}\int_I \int_{T(U_r)}|v^\tau-w^\tau|^2(|\det(DT_k)|-1)+\\
\int_I ( w_t^\tau (|\det(DT_k)| -1), q^k)_{H_T}+ ((A_{T_k}-I)\nabla w^\tau, \nabla q^k)_{H_T}+\\
\int_I (v_t^\tau (|\det(DT_k)|-1),p^k )_{H_T} + ((A_{T_k}-I) \nabla v^\tau, \nabla p^k)_{H_T} \\
\end{align*}

Now, the application $\delta \te \mapsto \id +\delta \te \circ \tau^{-1}$ is Frechet differentiable at $\delta \te =0$, as a map of $\Te$ into $\cV^1$, with Frechet derivative $\delta \te \circ \tau^{-1}$, which is linear and bounded by point i) of lemme 2.2, \cite{murat}. Note, we needed here $\tau \in \cT^1$.

Also, the maps $\delta \eta \mapsto |\det(D\eta)|$ and $\eta\mapsto (D\eta)^{-1}(D\eta)^{-t}|\det D\eta|$ are Frechet differentiable at $\id$, from $\cV^1$ into $L^\infty(\mR^n;\mR)$ and $L^\infty(\mR^n;\mR^{n\times n})$, as stated in lemma 4.16, page 80 of \cite{lindemann}. Their Frechet derivatives are $\dive (\beta)$ and $I-D\beta-(D\beta)^t$, respectively.

Therefore, composition with  $\delta \te  \mapsto \id+ \delta \te \circ \tau^{-1}$ yields two Frechet differentiable maps, whose derivatives at $0$, in direction $\delta \te \in \Te$ are exactly:

\begin{itemize}
	\item $\dive(\delta \te \circ \tau^{-1})$
	\item $A'(\delta \te \circ \tau^{-1})$
\end{itemize} 

These maps are:

\begin{itemize}
	\item $\delta \te_k \mapsto |\det(DT_k)|$
	\item $\delta \te_k \mapsto A_{T_k}$
\end{itemize}

Therefore:

\begin{itemize}
	\item $|\det(DT_k)|-1 = |\det(DT_k)|-1 - t_k\dive(\delta \te \circ \tau^{-1})+t_k\dive(\delta \te \circ \tau^{-1}) = o^1_k + t_k\dive(\delta \te \circ \tau^{-1})$
	\item $A_{T_k}-I = A_{T_k}-I - t_k A'(\delta \te \circ \tau^{-1}) + t_k A'(\delta \te \circ \tau^{-1}) = o_k^2 + t_k A'(\delta \te \circ \tau^{-1}) $
\end{itemize}

where $o_1^k \in L^\infty(\mR^n;\mR)$ and $o^2_k \in L^\infty(\mR^n;\mR^{n\times n})$ being higher order terms, in $L^\infty$ and with respect to $t_k$.

We can then write $(G(k,u^0,\pi^k)-G(0,u^0,\pi^k))/t_k = a_k + o_k$.

Here:

\begin{align*}
a_k :=\\
\frac{1}{2}\int_I \int_{T(U_r)}|v^\tau-w^\tau|^2\dive(\delta \te \circ \tau^{-1})+\\
\int_I ( w_t^\tau \dive(\delta \te \circ \tau^{-1}), q^k)_{H_T}+ (A'(\delta \te \circ \tau^{-1}) \nabla w^\tau, \nabla q^k)_{H_T}+\\
\int_I (v_t^\tau \dive(\delta \te \circ \tau^{-1}),p^k )_{H_T} + (A'(\delta \te \circ \tau^{-1})  \nabla v^\tau, \nabla p^k)_{H_T} \\
\end{align*}

Thanks to the assumed weak convergence, $a_k\rightarrow J'(\tau)[\delta \te]$.

So, we still have to show that:

\begin{align*}
o_k:=\\
\frac{1}{2}\int_I \int_{T(U_r)}|v^\tau-w^\tau|^2 o^1_k t_k^{-1}+\\
\int_I ( w_t^\tau o^1_kt_k^{-1}, q^k)_{H_T}+ (t_k^{-1}o^2_k\nabla w^\tau, \nabla q^k)_{H_T}+\\
\int_I (v_t^\tau o^1_k t_k^{-1},p^k )_{H_T} + (t_k^{-1}o^2_k \nabla v^\tau, \nabla p^k)_{H_T} 
\end{align*}

goes to zero. This is true because again we can write:

\begin{align*}
|o_k| \leq\\ \norm{ o^1_kt_k^{-1}}_{L^\infty(T(U_r))}\left (\int_I( \norm{v_t^\tau}_{H^T}\norm{p^k}_{H_T}+ \norm{v_t^\tau}_{H_T}\norm{p^k}_{H_T})+\frac{1}{2}\norm{v^\tau-w^\tau}^2_{L^2(I,H_T)}\right )+\\
\left(\sum_{ij} \norm{((t_k^{-1}o^2_k)_{ij}}_{L^\infty(T(U_r))}\right )\left (
\int_I \norm{\nabla v^\tau}_{H_T} \norm{\nabla p^k}_{H_T}+ \int_I \norm{\nabla w^\tau}_{H_T} \norm{\nabla q^k}_{H_T}\right )
\end{align*}

which goes to $0$, thanks to the boundedness of the averaged adjoint states, which stems from their weak convergence.

We assumed $p^k \weakc p^0$ in $Q(I,W_T)$ and $q^k \weakc q^0$ in $Q(I,V_T)$. We now prove these claims.

\underline{Weak convergence of states}

We show at first  $v_0^k \weakc v^0_0$ in $Q(I,W_T)$ and $w^k \weakc w^0$ in $Q(I,V_T)$.

We do this by showing a bound, uniform in $k$.

To do this, recall that $V_0^k:=v_0^k\circ T_k^{-1}$ and $W^k:=w^k\circ T_k^{-1}$ satisfy, as seen in \ref{thm:eq_pde}:

\begin{align*}
W^k \in Q_0(I, V_{T_k\circ T}), V_0^k \in Q_0(I,W_{T_k\circ T}) \\
\int_I  (W^k_t , Q)_{H_{T_k\circ T}}+ (\nabla W^k, \nabla Q)_{H_{T_k\circ T}} = \int_I(g,\tr_{{T_k\circ T}(U)} Q)_{L^2(\Gamma_f)}, \quad \forall Q \in Q^0(I, V_{T_k\circ T}) \\
\int_I (V^k_{0t},P)_{H_{T_k\circ T}} + (\nabla V_0^k, \nabla P)_{H_{T_k\circ T}}= -\int_I(U_k',P)_{H_{T_k\circ T}}+(U^k, \nabla P)_{H_{T_k\circ T}}, \quad \forall P \in Q^0(I, W_{T_k\circ T})
\end{align*}

where $U^k:=\bar{u}\circ T_k^{-1}$, where we used that pullbacks and time derivatives commute, see \cref{prop:change_boch}.

Thanks to \cref{prop:diri_wp} and \cref{prop:wp_neu} we obtain the stability estimates:

\begin{align*}
\norm{V^k}^2_{C([0;T],H_{T_k\circ T})}+\norm{V^k}_{L^2(I,H_{T_k\circ T})}^2+ \\\norm{\nabla V^k}_{L^2(I,H_{T_k\circ T})}^2 + \norm{(V^k)_t}^2_{L^2(I,H_{T_k\circ T})}\leq\\ C\norm{U^k}_{H^1(I,V_{T_k\circ T})}^2\\
\norm{W^k}^2_{C([0;T],H_{T_k\circ T})}+\norm{W^k}_{L^2(I,H_{T_k\circ T})}^2+ \norm{\nabla W^k}_{L^2(I,H_{T_k\circ T})}^2 +\\ \norm{W^k_t}^2_{L^2(I,H_{T_k\circ T})}\leq \\C\norm{g}_{H^1(I,L^2(\Gamma_f))}^2
\end{align*}


where $C$ is independent of $k$.

%But $\norm{U^k}_{H^1(I,V_{T_k\circ T})}^2 = \norm{\bar{u}\circ T_k^{-1}}_{H^1(I,V_{T_k\circ T})}^2\leq N_k\norm{\bar{u}}_{H^1(I,V_{ T})}^2$ by \cref{lemma:bochner_Hk_map}, where $N_k:=\norm{\circ T_k}_{L(V_{T_k\circ T},V_{T}))}$.

Now, consider \ref{thm:change}. It says that for almost every time:

\begin{align*}
\norm{U^k}_{V_{T_k\circ T}}\leq\\ \left ( 1+\norm{\det DT_k}_{L^\infty(\mR^n)}\right)^{1/2} \norm{(DT_k)^{-1}}_{L^\infty(\mR^n;\mR^{n\times n})}\norm{\bar{u}}_{H^1(T(U_r));\mR^n)}
\end{align*}

and the same goes for the first derivative. 


%The term $( \norm{\det DT_k}_{L^\infty(\mR^n)})^{1/2}$ is bounded with respect to $k$ as we already saw, and with analogous reasonings, so is $ \norm{(DT_k)^{-1}}$, thanks to the Frechet differentiability of $\delta \te_k \rightarrow  (DT_k)^{-1}$ established in lemme 4.3, page IV.8 \cite{murat}.

This bound is uniform on $k$ because of the continuity of the bound, with respect to $k$, as seen in 4.12, page IV.6, \cite{murat}.

We conclude that $\norm{U^k}_{H^1(I,V_{T_k\circ T})}^2$ is bounded and we thus have that $W^k \in Q_0(I, V_{T_k\circ T}), V_0^k \in Q_0(I,W_{T_k\circ T})$ are bounded.

Now, for almost all times, using 4.11, page IV.6 of \cite{murat}, we obtain that, for instance:

\begin{align*}
\norm{v_0^k}_{V_{ T}}\leq \\\left ( 1+\norm{\det (DT_k)^{-1}}_{L^\infty(\mR^n)}\right)^{1/2} \norm{DT_k}_{L^\infty(\mR^n;\mR^{n\times n})}\norm{V_0^k}_{H^1(T_K(T(U_r)))}
\end{align*}

where we remember that $H^1_0$ was chosen to be normed with the full $H^1$ norm.

The same goes for $w^k$ and the first derivatives in time, yielding that $w^k \in Q_0(I, V_{ T}), v_0^k \in Q_0(I,W_{T})$ are bounded.

We thus have $w^k\weakc w^? \in Q_0(I, V_{ T})$, $v_0^k \weakc v_0^? \in Q_0(I,W_{T})$, in the weak topologies of, respectively, $Q(I, V_{ T}), Q(I,W_{T})$, and modulo subsequences. The initial values are preserved becase $Q_0$ is closed and convex in the Hilbert space $Q$ (see \ref{prop:Q}). The closedness follows from the fact that the embedding into continuous function is linear bounded, and evaluation at $0$ is linear bounded from continuous functions.

We now prove that $w^?=w^0$, $v^?=v^0$, and this will yield the weak convergence of the whole sequence.

To prove e.g. that $v^?=v^0$, let us look at the weak formulations of $v_0^k$:

\begin{align*}
\int_I (v_{0t}^k,p |\det(DT_k)|)_{H_T} + (A_{T_k} \nabla v_0^k, \nabla p)_{H_T}+(\bar{u}',p|\det(DT_k)|)_{H_T}+(A_{T_k} \nabla \bar{u} , \nabla p)_{H_T} = 0
\end{align*}

for all $p \in Q_0(I,W_{T})$.

Let's analyize the first term, which is $\int_I (v_{0t}^k,p |\det(DT_k)|)_{H_T} ) =(v_{0t}^k,p |\det(DT_k)|)_{L^2(I,H_T)}$.

We can write:

\begin{align*}
(v_{0t}^k,p |\det(DT_k)|)_{L^2(I,H_T)} =\\ (v_{0t}^k,p )_{L^2(I,H_T)}- (v_{0t}^k,p )_{L^2(I,H_T)} + (v_{0t}^k,p |\det(DT_k)|)_{L^2(I,H_T)} =\\ (v_{0t}^k,p )_{L^2(I,H_T)} + (v_{0t}^k,p (|\det(DT_k)|-1))_{L^2(I,H_T)}
\end{align*}

Because $p \in  Q(I,W_{T})$, the first term converges to $(v_{0t}^?,p )_{L^2(I,H_T)}$, see \cref{prop:Q} for details on why we can write the time derivative of the limit. The other term can be estimated as follows:

\begin{align*}
|(v_{0t}^k,p (|\det(DT_k)|-1))_{L^2(I,H_T)}|\leq\\\norm{v_{0t}^k}_{L^2(I,H_T)}\norm{p (|\det(DT_k)|-1))}_{L^2(I,H_T)}\leq\norm{v_{0t}^k}_{L^2(I,H_T)}\norm{p }_{L^2(I,H_T)} \norm{|\det(DT_k)|-1}_{L^\infty}
\end{align*}

Where the first term in the product is bounded by the weak convergence property, and the last one goes to $0$ by continuity, see again 4.12, page IV.6 of \cite{murat}.

In a similar fashion for the other pieces, and by passing to the limit:
\begin{align*}
\int_I (v_{0t}^?,p)_{H_T} + (\nabla v_0^?, \nabla p)_{H_T}+(\bar{u}',p)_{H_T}+(\nabla \bar{u} , \nabla p)_{H_T} = 0
\end{align*}

By uniqueness, $v^?=v^0$.

\underline{Weak convergence of averages adjoint states}

So, $v_0^k \weakc v_0^0, w^k\weakc w^0$ in the sense of the $Q(I,W_T)$ and $Q(I,V_T)$ weak convergence.

We now claim that $p^k \weakc p^0, q^k\weakc q^0$, in a similar style as before. To do so, remember that $P^k:=p^k\circ T_k^{-1}$ and $Q^k:=q^k\circ T_k^{-1}$ solve:

\begin{align*}
-Q^k_t-\Delta Q^k =\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}+\bar{u}_T\circ T_k^{-1} \\
Q^k(T)=0\\
\partial_\nu Q^k = 0 \text{ on } \Sigma_f\\
Q^k = 0 \text{ on } \Sigma_m
\end{align*}

and

\begin{align*}
-P^k_t-\Delta P^k =-\frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}-\bar{u}_T\circ T_k^{-1} \\
P^k(T)=0\\
P^k = 0 \text{ on } \Sigma_m \sqcup \Sigma_f
\end{align*}

By \cref{thm:const_track}, we will obtain a bound in $Q$ of the tranported averaged adjoints as soon as we have a bound on $\ds \frac{v_0^k-w^k+v_0^0-w^0}{2}\circ T_k^{-1}$ in the $L^2(I,H)$ norm, and of $U^k:=\bar{u}_T\circ T_k^{-1}$. The latter was proven above.

So, by \cref{thm:change} and 4.12 of \cite{murat} at page IV.6, it suffices to have an $L^2(I,H)$ bound on $\ds \frac{v_0^k+w^k+v_0^0+w^0}{2}\circ T_k^{-1}\circ T_k = \frac{v_0^k+w^k+v_0^0+w^0}{2}$ which we have, since we just proved that $v_0^k, w^k$ are weakly convergent in e.g. $L^2(I,H)$.

We conclude that $Q^k,P^k$ are bounded in the $Q(I,V_{T_k\circ T})$ and $Q(I,W_{T_k\circ T})$ sense.

But what we want is a bound on $q^k, p^k$ in the $Q(I,V_{ T})$ and $Q(I,W_{ T})$ sense. This can be accomplished in exactly the same way as before.

We conclude that there exist $q^?, p^?$ in $Q^0(I,V_{ T})$, $Q^0(I,W_{ T})$, that are, modulo subsequences, the weak limits of $q^k, p^k$.

To show e.g. $q^?=q^0$ and conclude the convergence of the full sequence, we analyze the weak formulation of $q^k$, which reads, after going to the moving domain and applying integration by parts in time (see \ref{prop:Q}):

\begin{align*}
-\int_I \left (\frac{((v_0^k+\bar{u}_T - w^k)+(v_0^0+\bar{u}_T - w^0)}{2}\right )|\det(DT_k)|,\delta w)_{H_T}+\\
-\int_I (  q^k_t ,   \delta w |\det(DT_k)|)_{H_T}+ (A_{T_k}\nabla \delta w, \nabla q^k)_{H_T}
\end{align*}

for all $\delta w \in Q_0(I,V_{ T})$.

We show the convergence of e.g. the member: $\int_I( v_0^k|\det(DT_k)|,\delta w)_{H_T}$. By splitting the scalar product as we saw above, we are left with checking that $\int_I (v_0^k,\delta w)_{H_T}\rightarrow  \int_I (v_0^0,\delta w)_{H_T}$, which is true, since we proved that $v_0^k \weakc v_0^0$ in $Q(I,W_T)$.

We conclude upon convergence that:

\begin{align*}
-\int_I \left (\frac{((v_0^0+\bar{u}_T - w^0)+(v_0^0+\bar{u}_T - w^0)}{2}\right ),\delta w)_{H_T}+\\
-\int_I (  q^?_t ,   \delta w )_{H_T}+ (\nabla \delta w, \nabla q^?)_{H_T}
\end{align*}

which is satisfied also by $q^0$, therefore $q^? = q^0$ and we have weak convergence of the entire sequence.

\end{mproof}

\section{Star shaped reparametrization}

Here we reparametrize the problem assuming the optimization domain to be star-shaped with respect to the origin. We do this to justify the computer implementation of the solution algorithm.

\begin{prop}[Star shaped boundary]
Let $f \in C(\mS)$, $f>0$. Define $\Omega_f:=\{x, |x|<f(\xh)\}\cup\{0\}$, where $\xh=x/|x|$. Then:
\begin{itemize}
\item $\Omega_f$ is open
\item $\Omega_f$ has boundary $\{x, |x|=f(\xh)\}$
\item $\Omega_f$ is a bounded Lipschitz domain
\end{itemize}
\end{prop}

\begin{mproof}

For $x \in \partial \Omega_f$ (so, $x\neq 0$) we find $x_n, y_n \rightarrow x$ with $|x_n|<f(\widehat{x_n})$ and $|y_n|\geq f(\widehat{y_n})$. For large $n$ and by continuity, $|x| = f(\xh)$ and we have shown one inclusion.

For the reverse, and $x, |x|=f(\xh)$ (so, $x\neq 0$), we define $x_n = \frac{n}{n+1} x$ which satisfies $|x_n|<|x|=f(\xh)=f(\widehat{x_n})$, that is, $x_n \in \Omega_f$, and also $x_n\rightarrow x$. This shows that $x \in \partial \Omega_f$.

It is a bounded Lipschitz domain by lemma 2 at page 96 of \cite{burenkov}, and lemma 5 at page 151 also of \cite{burenkov}, a fact that was not discussed in \cite{deckelnick}. Note that the definition of Lipschitz domain of \cite{burenkov} is completely equivalent to that of \cite{bello} (and at least implies that of \cite{mclean}, \cite{grisvard}, \cite{leoni}, \cite{adams}, a fact which is needed in the sequel), by an application of the Lebesgue number lemma, whose statement can be found at e.g. page 179 of \cite{munkres}.

\end{mproof}

We now create functions taking a radial function into a star-shaped domain. We choose $0<\eps <f_D \in W^{1,\infty}(\mS)$, to parametrize the non moving part of the optimization domain. The reference domain is taken to be $\Omega_{f_D}\setminus \overline{B}_\eps$, and we call $D:=\Omega_{f_D}$

\begin{prop}[$H_f, A_f$]
Let $\eps <f_D \in W^{1,\infty}(\mS)$ and $0<f \in W^{1,\infty}(\mS), f<f_D$, and define:
\begin{itemize}
	\item $H_f(x):=\ds \left\{\begin{matrix}
\frac{x}{\epsilon}f(\hat{x}) &  x\neq 0\\ 
0 & x=0
\end{matrix}\right. $, as a function $\mR^n\rightarrow \mR^n$
	\item $A_f(x):=\left (  f(\xh)+\frac{f_D(\xh)-f(\xh)}{f_D(\xh)-\eps}(|x|-\eps) \right )\xh$, as a function $\mR^n\setminus\{0\}\rightarrow \mR^n$
\end{itemize}

They enjoy the following properties:

\begin{enumerate}
%	\item $H_f:\mR^n \rightarrow \mR^n$, $A_f:\mR^n \rightarrow \mR^n$ is Lipschitz, $A_f: \overline{D}\setminus B_\eps\rightarrow \mR^n$ is Lipschitz too
	\item $H_f(B_\eps)=\Omega_f$, $H_f(\eps \mS) = \partial \Omega_f$
	\item $A_f(D\setminus \overline{B_\eps}) = D\setminus \overline{\Omega_f}$, $A_f(\partial D) = \id$, $A_f(\eps \mS) = \partial \Omega_f$
	\item $A_f=H_f$ on $\eps\mS$
	\item $H_f^{-1}(y):=\ds \left\{\begin{matrix}
\epsilon \frac{y}{f(\hat{y})} &  y\neq 0\\ 
0 & y=0
\end{matrix}\right. $, as a function $\mR^n\rightarrow \mR^n$
	\item $A_f^{-1}(y):=\left (  \eps+\frac{f_D(\yh)-\eps}{f_D(\yh)-f(\yh)}(|y|-f(\yh)) \right )\yh$, as a function $\overline{D}\setminus \Omega_f \rightarrow \overline{D}\setminus B_\eps$
\end{enumerate}

\end{prop}

\begin{mproof}
All the properties are straightforward from the definitions. It helps to recognize that $A_f$ is just the linear map from the radial segment $[\eps, f_D(\xh)]$ to $[f(\xh), f_D(\xh)]$ and that $\overline{\Omega_{f_D}} \setminus \Omega_f = \{f(\xh)\leq|x|\leq f_D(\xh)\}$
\end{mproof}

They also satisfy a bi-Lipschitz condition.

\begin{prop}[Bi-Lipschitz condition]
We have that $A_f:  \overline{D}\setminus B_\eps\rightarrow \overline{D}\setminus \Omega_f $ is Lipschitz with Lipschitz inverse (bi-Lipschitz), and so is $H_f: \mR^n \rightarrow \mR^n$.
\end{prop}

\begin{mproof}

The second part of the proposition is contained in \cite{deckelnick} in a weaker for, we therefore proceed to prove all the statements.

\underline{$H_f$}

We can assume both $x,y\neq 0$. Then $|f(\xh)x-f(\yh)y|\leq |x||f(\xh)-f(\yh)|+f(\yh)|x-y|$. Employing direct and reverse triangle inequalities we get $|\xh-\yh|\leq \frac{2}{|x|}|x-y|$.

As $f$ is Lipschitz (see \cite{deckelnick}) we obtain:  $|f(\xh)x-f(\yh)y|\leq |x|C(f)\frac{2}{|x|}|x-y|+C(f)|x-y|$.

Now, $1/f$ is also Lipschitz and bounded, because $f>0$ and is continuous on a compact set. Thus the same proof shows the Lipschitz property also for $H_f^{-1}$.

\underline{$A_f$}

Call $A_f(x)=\left (  f(\xh)+\frac{f_D(\xh)-f(\xh)}{f_D(\xh)-\eps}(|x|-\eps) \right )\xh =:Q(x)\xh $. Because $|x|\geq\eps$, as before, we obtain $|A_f(x)-A_f(y)|\leq 2/\eps Q(x) |x-y|+|Q(x)-Q(y)|$, so that we need to show that $Q$ is bounded Lipschitz.

By continuity and compactness, $f_D(\xh)-\eps\geq \delta >0$ and boundedness follows. The Lipschitz property follows because $Q$ is sums of products of bounded Lipschitz functions. For instance, $f_D(\xh)$ is bounded and Lipschitz because $|x|\geq\eps$, as before, and so is $f_D(\xh)-\eps$. Is is a bounded Lipschitz function that is uniformly above $\delta$, so that its reciprocal is also a bounded Lipschitz function.

Analogous reasonings let us prove also the Lipschitz property of $A_f^{-1}$.

\end{mproof}

We now try to glue $H_f, A_f$ together and still obtain a bi-Lipschitz function. Even the Lipschitz property need not to hold in general, see page 7 of \cite{weaver} for a counterexample. We therefore proceed to the proof of this fact.

\begin{prop}[Gluing $H_f^{-1}, A_f^{-1}$]
\label{prop:gluing}
$H_f^{-1}, A_f^{-1}$, or also $A_f, H_f$ can be glued into a Lipschitz function $\overline{D}\rightarrow\overline{D}$.
\end{prop}
\begin{mproof}

Call $\tau_f^{-1}$ the gluing. It is Lipschitz $\overline{D}\rightarrow\overline{D}$ if and only if $\tau_f^{-1}\circ H_f$ is Lipschitz $H_f^{-1}(\overline{D})\rightarrow\mR^n$, because we proved that $H_f$ is bi-Lipschitz $\mR^n \rightarrow \mR^n$.

We are therefore left to prove that gluing Lipshitz function on $\mS$ produces a Lipschitz function, which would also yield the claim for $\tau_f$, the gluing of $A_f, H_f$. Note that by the preceding proposition, all the functions to be glued are Lipschitz and agree on their overlaps.

\underline{Gluing lemma for Lipschitz functions on $\mS$}

Let $A\supseteq \overline{B_\eps}$. Suppose $g:A\rightarrow\mR^n$ and $h:\overline{B_\eps}\rightarrow\mR^n$ are Lipschitz and agree on $\eps \mS$. Call $f$ their gluing.

For the proof we can assume that $x \in B_\eps$, $y \in A \setminus \overline{B_\eps}$.

Then, $|f(x)-f(y)|\leq |h(x)-h(\eps \yh)|+|g(\eps \yh)-g(y)|$.

We claim at first that $|y-\eps \yh|\leq  |x-y|$. To see this, choose $n:=\yh$. Then $|y-x|^2 \geq |(y-x)\cdot n n|^2$ by Pythagoras' theorem, so that $|y-x|\geq |(y-x)\cdot n| = |(y-\eps \yh)\cdot n + (\eps \yh -x)\cdot n|$. But $(y-\eps \yh)\cdot n=|y|-\eps \geq 0$, and $(\eps \yh -x)\cdot n = \eps - x\cdot n\geq 0 $ as $x\cdot n \leq |x|\leq \eps$.

Thus  $|y-x|\geq |(y-\eps \yh)\cdot n| + |(\eps \yh -x)\cdot n|\geq  |(y-\eps \yh)\cdot n|=|y-\eps \yh|$.

We also claim that $|x-\eps \yh|\leq |x-y|$. To do so, pick $n:=\frac{\eps\yh -x}{|\eps\yh-x|}$. By Pythagoras' theorem we obtain $|y-x|\geq |(y-x)\cdot n|=|(y-\eps \yh)\cdot n +(\eps \yh -x)\cdot n|$. The second summand is non-negative and for the first one, it is directly proportional to $(y-\eps \yh)\cdot(\eps \yh-x)=(|y|-\eps)(\eps-\yh\cdot x)\geq 0$. So, $|x-y|\geq |(\eps \yh -x)\cdot n|=|\eps \yh -x|$.

Thus $ |f(x)-f(y)|\leq C|x-y|$ as desired.


\end{mproof}

\begin{cor}[Radial to volumetric transformation]
Let again $\eps <f_D \in W^{1,\infty}(\mS)$ and $0<f \in W^{1,\infty}(\mS), f<f_D$. Define:

\begin{itemize}
	\item $\ds \tau_f(x):=\left\{\begin{matrix}
 x & |x|\geq f_D(\xh)\\ 
 \left (  f(\xh)+\frac{f_D(\xh)-f(\xh)}{f_D(\xh)-\eps}(|x|-\eps) \right )\xh & \eps \leq |x| \leq f_D(\xh) \\ 
 \frac{x}{\epsilon}f(\hat{x}) & 0<|x|\leq \eps\\ 
 0 & |x|=0
\end{matrix}\right.$

	\item $\ds \tau_f^{-1}(y):=\left\{\begin{matrix}
 x & |y|\geq f_D(\yh)\\ 
 \left (  \eps+\frac{f_D(\yh)-\eps}{f_D(\yh)-f(\yh)}(|y|-f(\yh)) \right )\yh & f(\yh) \leq |y| \leq f_D(\yh) \\ 
 \epsilon \frac{y}{f(\hat{y})}& 0<|y|\leq f(\yh)\\ 
 0 & |y|=0
\end{matrix}\right.$
\end{itemize}


Then $\tau_f \in \cT$.
\end{cor}
\begin{mproof}

The final gluing on the border of $D$ yields a Lipschitz function: we can see this by taking $\id -\tau_f^{\pm 1}$, which is Lipschitz and $0$ on $\partial D$, so that we are considering the zero extension outside $D$ of a Lipschitz function, null on $\partial D$. This extension is Lipschitz.

\end{mproof}

Note that, as long as $f<f_D$, $\tau_f(B_\eps)$ will always be bounded Lipschitz.

We finally have a look at shape derivatives in this radial framework. The cost functional will be $j(q):=J(\tau_{\eps+q})$, where $0<q+\eps < f_D$. We are interested, for $h\in W^{1, \infty}(\mS)$, in the limits $$\lim_{t\rightarrow 0}\frac{j(q+th)-j(q)}{t}$$

But this is:

$$\lim_{t\rightarrow 0}\frac{J(\tau_{\eps+q+th})-J(\tau_{q+\eps})}{t}$$

Now, we derive the expression of a displacement field $V_h$, to connect this difference quotient to the already computed shape derivative, see also \cite{deckelnick}. The ansatz $\tau_{q+th}=(\id + tV_h\circ \tau_q^{-1})\circ \tau_q$ brings us to $V_h = \ds \frac{\tau_q+th-\tau_q}{t}$, and by some computations, we obtain: 

$$V_h(x) = \tau_f(x):=\left\{\begin{matrix}
 0 & |x|\geq f_D(\xh)\\ 
 h(\xh)\frac{f_D(\xh)-|x|}{f_D(\xh)-\eps}\xh & \eps \leq |x| \leq f_D(\xh) \\ 
 \frac{x}{\epsilon}h(\hat{x}) & 0<|x|\leq \eps\\ 
 0 & |x|=0
\end{matrix}\right.$$

This expression only depends on $h$ and is the gluing of Lipschitz functions, that are either $0$ at the gluing points, or such that the gluing points lie in $\eps\mS$. Note, this vector field is just moving $\eps \mS$ by $h$ and radially damping this movement to $0$ close to $\partial D$. We can therefore conclude:

\begin{prop}[Shape derivative, star shaped case]
We have the following facts, for $h \in W^{1,\infty}(\mS)$:

\begin{itemize}
	\item $\tau_{q+th}=(\id + tV_h\circ \tau_q^{-1})\circ \tau_q$
	\item $V_h \in \Te$
	\item $j$ is Gateaux differentiable at every $0<q<f_D$, $q \in W^{1,\infty}(\mS)$, with $j'(q)[h] = J'(\tau_{\eps+q})[V_h]$
\end{itemize}

\end{prop}
\begin{mproof}

We only need to show that $h\mapsto V_j$ is linear bounded $W^{1,\infty}(\mS)\rightarrow \Te$. Linearity is immediate and for the boundedness: $\sup_x|V_h(x)| = \norm{h}_\infty$, and we only therefore need to bound the Lipschitz constant of $V_h$. 

We only need to restrict ourselves to $\overline{D}$, as extending to zero a Lipschitz function doesn't increase its Lipschitz constant.

The gluing lemma \cref{prop:gluing} shows that it is sufficient to bound the Lipschitz constants of the two branches, separately.

These bounds are respectively: $C(\eps)(\norm{h}_\infty + 2\norm{D_T h}_\infty)$ and $[2\eps^{-1}(\norm{D_T h}_\infty + \norm{h}_\infty)]C(f_D,\eps) + C(f_D,\eps)\norm{h}_\infty$, which concludes the proof.

\end{mproof}

\subsection{Smoother star shaped domains}

We want to increase the regularity of $f$ and see an increase in the regularity of $\partial \Omega_f$.

\begin{prop}[Smooth radial function yields smooth star shaped domain]
Let $f>0$ which is either $C^{1,1}(\mS)$ (that is, $C^1$ with all the components of $D_T f$ Lipschitz) ar $C^2(\mS)$. We say $f \in C^o(\mS)$. 

Then, $\Omega_f$ has boundary of class $C^o$.

\end{prop}

\begin{mproof}

\underline{A punctured diffeomorphism of class $C^o$}

We consider $H_f$, neglecting the $\eps$ factor. It has gradient (see \cite{deckelnick}) $D H_f(x) = f(\xh)I+\xh \otimes D_Tf(\xh)$, and  $D H_f^{-1}(y) =1/f(\yh)I-1/f(\yh)^2 \yh \otimes D_Tf(\yh)$. They are $C^o$ away from the origin. In particular $H_f$ is $C^o$  outside of $B_\delta(0)$, $\delta < 1$. $H_f(B_\delta)$ also contains a ball around the origin, and the complement contains $\Omega_f$.

We conclude that $H_f: \overline{B_\delta(0)}^c \rightarrow \overline{H_f(B_\delta(0))}^c$ is a $C^o$ diffeomorphism, where the right set is open by $H_f$ being a homeomorphism of $\mR^n$. The Lischitz regularity of the gradients follows from the Lipschitz and boundedness of every factor, and the fact that we are setting ourselves away from the origin. In particular, $D_T f$ is Lipschitz, therefore continuous, on the sphere, and so bounded too.

We have therefore obtained a homeomorphism $\mR^n \rightarrow \mR^n$, which is $C^o$ as $\overline{B_\delta(0)}^c \rightarrow \overline{H_f(B_\delta(0))}^c$, so, in a neighbourhood of $\partial \Omega_f$.

For simplicity let's refer to such maps as $C^o$ punctured diffeomorphisms for $\Omega_f$.

\underline{Punctured diffeomorphism and $C^o$ domains}

Let $\Omega$ be of class $C^o$ (always locally) and bounded. Assume we have $F$, a punctured diffeomorphism for $\Omega$, so, $F:\mR^n\rightarrow \mR^n$ is a homeomorphism, and $F: U\rightarrow F(U)$ is $C^o$, $\partial \Omega \cc U$. Then, by analyzing the composition of $F$ with (small enough) charts of $\Omega$ we see that $F(\Omega)$ is another $C^o$ domain (local sense). 

\underline{From diffeomorphisms to graphs}

Let $\Omega$ be any $C^o$ domain, $x\in \partial \Omega$. We obtain $A\ni x, B$ open, and $\phi: A\rightarrow B$ a $C^o$ diffeomorphism, with $\phi^{-1}(B\cap \mR^n_+)=A\cap \Omega$, and $\phi(x)=0$.

$\phi$ is a $C^1$ diffeomorphism, so $D\phi_n(x)\neq 0$, and we can assume $D\phi_n(x)$ to be proportional to $-e_n$ by a rotation of the axis.

Thus $\partial_n\phi_n(z)<0$ in some $B(x)\subseteq A$. $B(x)$ is chosen small that $\phi$ is Lipschitz on $B(x)$.

Apply the implicit function theorem to obtain $V',I$ open with $x \in V'\times I\subseteq B(x)$ and a function $\eta:V'\rightarrow I$ that is $C^o$ and Lipschtiz, with $\phi_n(z',z_n)=0 \iff z_n = \eta(z')$, for $z \in V'\times I$.

$V'$ is open around $x'$, so let's restrict it to a square centered at $x'$. Relabel $\eta$ as the restriction to this new $V'$ and restrict $I$ to be the connected component of $G$ hosting $\eta(V')$, which is now an interval, as continuous image of a connected set. Because $x_n \in I$, and by continuity, $V'$ can be shrunk such that $\eta(V')\cc J \cc I$ for some open interval $J$. 

All these shrinkings don't change the character of being the implicit function, i.e. $\eta$ still satisfies $\phi_n(z',z_n)=0 \iff z_n = \eta(z')$, for $z \in V'\times I$, and also,  $x \in V'\times I\subseteq B(x)$ and $\eta:V'\rightarrow I$ is still $C^o$ and Lipschitz.

Now, the choice of $B(x)$ makes $z_n\mapsto \phi(z',z_n)$ strictly decreasing, for $(z',z_n) \in B(x)$.  So, for $z \in V'\times I$, we have $\phi_n(z', z_n) = \phi_n(z)>0=\phi_n(z',\eta(z')) \iff z_n<\eta(z')$ (by basic properties of strictly decreasing functions).

But also, $\phi_n(z) >0 \iff \phi(z) \in B\cap \mR^n_+ \iff z \in \phi^{-1}(\mR^n_+\cap B)=A\cap \Omega$.

Therefore, $z \in V'\times I, z_n<\eta_n(z) \iff z \in V'\times I, \phi_n(z) >0 \iff z \in A\cap \Omega \cap (V'\times I) = (V'\times I)\cap \Omega$.

Summing up we have the following:

\begin{itemize}
	\item a square and an interval $V', I$ with $V'\times I \ni x$
	\item $\eta: V'\rightarrow I$, Lipschitz, of class $C^o$
	\item $\phi(V') \cc J \cc I$
	\item $z \in V'\times I, z_n<\eta_n(z) \iff z \in (V'\times I)\cap \Omega$
	\item (and consequently, $z \in V'\times I, z_n=\eta_n(z) \iff z \in (V'\times I)\cap \partial \Omega$)
\end{itemize}

\underline{Conclusion}

Let a radial function $f>0$ be of class $C^o$. Thanks to $H_f$, a punctured diffeomorphism of class $C^o$, we we have that $\partial \Omega_f$ is the image of $\eps\mS$, a domain of class $C^o$ as well, locally. So $\Omega_f $ is of class $C^o$ locally, in the sense of diffeomorphisms, and by what we showed, also in the sense of graphs.

So, for $x \in \partial \Omega_f$ we can find a change of coordinates and a parallelepiped $V = V'\times I$ with $\phi: V'\rightarrow I$, $\phi$ of class $C^o$ and also Lipschitz, and $V\cap 	\Omega_f = V\cap \{x_n<\phi(x')\}$. We have moreover that $\phi \in J \cc I$ for some open interval $J$. By a compactness argument, finitely many $V_j = V_j'\times (a_n^j, b_n^j) $ are necessary to cover $\partial \Omega_f$. 

So, we have $V_j \cap \Omega_f = V_j\cap \{x_n<\phi_j(x')\} = V\cap \{a_n^j<x_n<\phi_j(x'), x' \in V_j'\}$. Choose $d>0$ to be the minimum gap between $\phi_j$ and $I_j$. $d>0$ by the existence of $J_j \cc I_j$. We call $L$ the maximum Lipschitz constant of $\phi_j$. 

We have therefore a Lipschitz and $C^o$ domain in the style of \cite{burenkov}, which yields, modulo an application of the Lebesgue number lemma, a $C^o$ and Lipschitz domain in the style of \cite{grisvard}.

\underline{Remarks about the usage of the implicit function theorem}

Examining the proofs of the inverse and implicit function theorems as given e.g. at pages 310, 311 of \cite{gilardi2}, we see that solving $f=0$ for $f$ Lipschitz and $C^o$, yields a Lipschitz and $C^o$ implicit function.

\end{mproof}

\appendix

\chapter{Functional spaces}
\section{Sobolev spaces}

\begin{thm}[Integration by parts]
\label{thm:ibp}
Let $\Omega$ be a bounded Lipschitz domain. Let $1<p<\infty$ and $f,g \in W^{1,p}(\Omega), W^{1,q}(\Omega)$, $q=p'$. Then:

$$\int_\Omega f \partial_i g = -\int_\Omega g \partial_i f+\int_{\partial \Omega} \tr u \nu_i d\pazocal{H}^{n-1}$$
\end{thm}
\begin{mproof}

This follows from \cite{leoni}, theorem 18.1 at page 592, where $g$ needs to be $C^1_c(\mR^n)$. But \cite{adams}, theorem 3.18 at page 54, says that (thanks to the smoothness of the boundary) the set of the restriction of such functions is dense in $W^{1,q}(\Omega)$, so that we can conclude by a density argument \textcolor{red}{\href{https://www.math.kit.edu/iana2/lehre/sobolevspaces2021s/media/lec15.pdf}{developed here}}.

\end{mproof}

\begin{lemma}
$f \in L^\infty(\Omega; \mR^N) \iff f_i \in L^\infty$, and two equivalent norms are $\norm{f}_a:=\norm{|f|}_\infty$, $\norm{f}_b:=\max_i\norm{f_i}_\infty$, for $|\cdot |$ any finite dimensional norm.
\end{lemma}
\begin{mproof}

We choose $|\cdot |=|\cdot|_1$.

Consider $f_n \in X_a = \{[f], f: \Omega \rightarrow \mR^n \text{ measurable }, \norm{f}_a\}$, Cauchy. Then every component is Cauchy in the scalar $L^\infty$, so that $f_n^i \rightarrow f^i $ in $L^\infty$. The limit $f$ is in $X_a$ because the functions $|f_i|$ are essentially bounded, and so is $|f|$. 

Then $\norm{f_n-f}_a\leq \norm{f_n-f_m}_a+\sum_i\norm{f_m^i-f^i}_\infty$ for all $n,m$. Choose $m\geq n$ with $\norm{f_m^i-f^i}\leq 1/(Nn)$ and conclude $X_a$ is Banach.

We know from \cite{leoni}, theorem B.88 at page 671, and page 669, we know that $X_b = \{[f], f: \Omega \rightarrow \mR^n \text{ measurable }, \norm{f}_b\}$ is Banach.

Moreover $X_a=X_b$ as sets, so that the thesis follows.


%We have that $\norm{f}_\infty = \sup_{\Omega\setminus X}f$ for all $X$ null sets on which $f \leq \norm{f}_\infty$ on $\Omega \setminus X$.
%
%In fact, that  $\norm{f}_\infty \geq \sup_{\Omega\setminus X}f$ is clear, whereas suppose there is $\epsilon >0$ with $\norm{f}_\infty -\epsilon \geq f$ on $\Omega \setminus X$. Then we contradict the definition of essential supremum and therefore $\norm{f}_\infty = \sup_{\Omega\setminus X}f$.
%
%Next up: for some $X,Y \subseteq \Omega$ of measure $0$, $f,g\leq \norm{f}_\infty, \norm{g}_\infty$ in $\Omega\setminus X, \Omega \setminus Y$, therefore, for some $N$ of null measure, $f,g\leq \norm{f}_\infty, \norm{g}_\infty$ in $\Omega \setminus N$. Therefore, $\norm{f}_\infty = \sup_{\Omega \setminus N}f, \norm{g}_\infty = \sup_{\Omega \setminus N}g$. 
%
%Therefore $ \max(\norm{f}_\infty, \norm{g}_\infty) = \max(\sup_{\Omega \setminus N}f,  \sup_{\Omega \setminus N}g) = \sup_{\Omega\setminus N}\max(f,g)$.
%
%So, $N$ is a null set and $\max(f,g)\leq \max(\norm{f}_\infty, \norm{g}_\infty)$, which by the reasoning of before.
%
%

\end{mproof}

\begin{prop}[Characterization of $W^{1,\infty}$]
\label{prop:lip}
Let $\Omega$ be a bounded Lipschitz domain, or $\mathbb{R}^n$. Then $W^{1,\infty}(\Omega) = C^{0,1}\cap L^\infty(\Omega)$.

This means that $u\in W^{1,\infty}(\Omega)$ if and only if $u$ has a (unique) representative that is bounded, Lipschitz continuous. Weak and classical derivatives coincide a.e.
\end{prop}
\begin{mproof}

%\underline{ACL characterization}
%
%Let $\Omega$ be just a domain.
%
%Consider a line $\gamma$ intersecting $\Omega$. Then, the intersection is a disjoint union of open segments $\gamma_i$. We say $u\in AC_\gamma(\Omega)$ if and only if $u$ is $AC[a,b]$ for every $[a,b]\cc\eta_i$ for all $i$, for almost all lines $\eta$ parallel to $\gamma$ and intersecting $\Omega$.
%
%We say $u \in ACL(\Omega)$ if $u$ is $AC_{e_i}(\Omega)$ for all coordinate axis $e_i$. We also call $BL(\Omega)$ the set of $u$ with a representative $\tilde{u}$, with $\tilde{u}\in ACL(\Omega), \tilde{u}, \nabla \tilde{u} \in L^\infty$, $\nabla u$ being the classical (a.e.) gradient.
%
%We have the following result (see \cite{kufner}, page 276, theorem 5.6.5.): $u \in W^{1,\infty}(\Omega)$ if and only if $u$ has a representative $\tilde{u} \in BL(\Omega)$. Classical and weak derivatives then coincide a.e..

\underline{Extension}

In the case $\Omega$ is bounded Lipschitz, then $\Omega$ is an extension domain for $W^{1,\infty}(\Omega)$, meaning that there is $E: W^{1,\infty}(\Omega)\rightarrow W^{1,\infty}(\mathbb{R}^n)$ linear bounded with $Eu=u$ a.e. on $\Omega$ (see \cite{leoni}, theorem 13.17 at page 425, 13.13 at page 424, and definition 9.57 at page 273).

\underline{The proof}

Let $u \in  W^{1,\infty}(\Omega)$. By \cite{leoni}, 11.50 at page 339, because $\Omega$ is an extension domain, we obtain that $u$ has a representative $\bar{u}$ that is bounded Lipschitz. Let $\phi \in C_c^\infty(\Omega)$. By The Kirszbraun theorem (see e.g. \cite{kirszbraun}), we can extend $\bar{u}$ to a Lipschitz function $e$ on $\mathbb{R}^n$. Then, for a large enough cube $Q$ containing $\Omega$, $\ds \int_\Omega\bar{u}\partial_i\phi = \int_Q e \partial_i \phi  = -\int_Q \partial_i e \phi $, by Fubini's theorem and integration by parts for AC functions.

Because $e=\bar{u}$	on $\Omega$, we conclude $\ds \int_\Omega\bar{u}\partial_i\phi =-\int_{\Omega} \partial_i \bar{u} \phi $, so that $\nabla \bar{u} = \nabla u$ almost everywhere.

Conversely, let $u$ be bounded Lipschitz. The above reasoning shows that $u$ has essentially bounded weak derivatives equal to the a.e. classical derivatives.

\end{mproof}

\begin{cor}[$W^{k,\infty}=C^{k,1}_B$]
\label{prop:lipk}
For a bounded Lipschitz domain $\Omega$, or for $\Omega = \mR^n$, then $W^{k,\infty}=C^{k,1}_B$ ($C^{k,1}$ bounded functions with bounded classical derivatives up to order $k+1$).
\end{cor}
\begin{mproof}

We have already proved the case $k=1$. We prove, for instance, the case $k=2$. Then, $u \in W^{k,2} \implies u, \partial_i u \in W^{k,1}$ (\cite{leoni}, 11.7 at page 321), so that by \cref{prop:lip}, we find bounded Lipschitz $h, g_i$ with $u=h$ a.e., $\partial_i u = \partial_i h$ a.e., $g_i = \partial_i u$ a.e..

Therefore $h$ is continuous, with continuous weak derivatives $g_i$, which implies that $h \in C^1(\Omega)$ (see \textcolor{red}{\href{https://math.stackexchange.com/questions/497708/is-a-continuous-function-with-continuous-weak-derivatives-of-class-c1}{here} and \href{https://math.stackexchange.com/questions/1787716/u-continuous-and-the-weak-derivative-du-continuous-rightarrow-u-in-c1}{here}}).

Now, $\partial_i h =g_i$ a.e., so everywhere, so that:

\begin{itemize}
\item $h$ is bounded Lipschitz and $C^1$
\item $\partial_i h$ are bounded Lipschitz
\end{itemize}

%Therefore, for $\phi \in C_c^\infty(\Omega)$ we get $\ds -\int_\Omega u \phi_{,i}\ds = \int_\Omega \partial_i u\phi =  \int_\Omega g_i \phi$.
%
%Pick a cube $Q = [-M,M]^n$, $\Omega \cc Q$. So, upon extending in a bounded Lipschitz manner $g_i$ to $G_i$ with $G_i(\partial Q)=0$ (see \cite{kirszbraun} and multiply by a suitable cut-off function), and $\phi$ to $0$, we get $\ds ...=\int_\Omega G_i \phi$. Call $h_i^x(t)=G_i(...,x_{i-1},t,x_{i+1},...)$ which is $AC[-M,M]$. Because $\eta_i^x(s):= \int_{-M}^s h_i^x(z)dz$ is $AC[-M,M]$ too because $h_i^x$ is bounded, and $h_i^x(t) =  \eta_i^{x'}(t)$. Employing then Fubini:
%
%\begin{align*}
%...= \int_{-M}^M... \int_{-M}^M \int_{-M}^M G_i(...,x_{i-1},x_i,x_{i+1},...)\phi dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n  \\
%= \int_{-M}^M... \int_{-M}^M \int_{-M}^M h_i^x(x_i) \phi dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n \\
%= \int_{-M}^M... \int_{-M}^M \int_{-M}^M \eta_i^{x'}(x_i)  \phi dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n \\
%= \int_{-M}^M... \int_{-M}^M \int_{-M}^M \eta_i^{x'}(x_i)  \phi dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n \\
%= -\int_{-M}^M... \int_{-M}^M \int_{-M}^M \eta_i^x(x_i)  \phi_{,i} dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n \\
%=- \int_{-M}^M... \int_{-M}^M \int_{-M}^M \int_{-M}^{x_i} G_i(...,x_{i-1},z,x_{i+1},...) dz\phi_{,i} dx_i dx_1...dx_{i-1}dx_{i+1}...dx_n \\
%= -\int_Q k_i\phi_{,i}
%\end{align*}
%
%where in the last passage we have used again Fubini and the fact that 
%
%$$k_i(x):=\int_{-M}^{x_i} G_i(...,x_{i-1},z,x_{i+1},...) dz$$
%
% is measurable and bounded on $Q$.

\end{mproof}

\section{Bochner spaces}

Here are some useful results about Bochner spaces.

\begin{prop}[Bochner integral and bounded operators]
\label{prop:bochner_bound}
Let $X,Y$ be separable Banach, let $T \in L(X,T)$ be a linear bounded operator. For $f \in L^1(I,X)$ define $Tf (t):= T(f(t))$. Then $Tf \in L^1(I,Y)$ with $T\int_I f = \int_I Tf$.
\end{prop}
\begin{mproof}

First of all, a clarification on the definition. What is really happening is that from the time equivalence class $f$, we select a $g$, and then $Tf(t):=T(g(t))$. $Tf$ is then the equivalence class of $t\mapsto Tf(t)$. The definition is well posed, because $g_1(t)=g_2(t)\implies T(g_1(t))=T(g_2(t))$.

Let $f_n$ be simple, $f_n\rightarrow f $ a.e., with $\lim_n \int_I f_n = \int_I f$ and $\norm{f_n}_X \leq C \norm{f}_X$ (see page 6, and corollary 2.7 at page 8 of \cite{kreuter}).

\underline{Measurability}

For almost all $t$, $T(f_n(t)) \rightarrow T(f(t))=Tf(t)$ in $Y$, so that $Tf$ is measurable (strongly).

\underline{Integrability}

By the assumptions, $\norm{Tf_n}\leq \norm{T}\norm{f_n}\leq C\norm{f}\in L^1(I)$, so that by dominated convergence (corollary 2.6 of \cite{kreuter}) $Tf$ is integrable too. Thus $\int_T Tf = \lim_n \int_I  Tf_n = \lim_n T\int_I  f_n$, because $f_n$ is simple. And now, by the choice of $f_n$, $\int_T Tf = \lim_n T\int_I  f_n = T \lim_n \int_I  f_n = T \int_I f$.

\end{mproof}

\begin{prop}	[Derivations and bounded operators]
\label{lemma:bochner_Hk_map}
As before, let $X,Y$ be separable Banach, let $T \in L(X,T)$ be a linear bounded operator.

For $k\geq 0$, $f \in H^k(I,X)\implies Tf \in H^k(I,Y)$, with weak derivatives $\partial_{t^i}Tf = T\partial_{t^i}f$, $0\leq i \leq k$.

The map $f \mapsto Tf$, $H^k(I,X)\rightarrow H^k(I,Y)$ is linear, and bounded by $\norm{T}$.
\end{prop}
\begin{mproof}
The case $k=0$ is proved above.

We prove now that $\partial_{t^i}Tf = T\partial_{t^i}f$ for $i=1$. Note that $T\partial_t f \in L^2(I,Y)$, which qualifies as weak derivative.

In fact, for $\phi \in C_c^\infty(I)$, we have $\int_I \phi T\partial_i f = \int_I T(\phi\partial_t f) = T \int_I\phi\partial_t f = -T\int_I\phi'f=-\int_I\phi'Tf$.

Higher weak derivatives are treated analogously and the rest of the claims follow from the time stationarity of $T$ and by $\norm{\partial_{t^i}Tf}=\norm{T\partial_{t^i}f}\leq \norm{T}\norm{\partial_{t^i}f}$.

\end{mproof}

\begin{prop}[Continuous representatives]
\label{prop:cts_repr}
Let $X$ be separable Banach. $f \in L^1(I,X)$ has at most a continuous representative on $[0,T]$.
\end{prop}
\begin{mproof}
Assume there exists two such continuous representatives, so that we get a function $\delta: [0,T] \rightarrow X$ that is zero almost everywhere and continuous. Hence, $[0,T] \ni t \mapsto \norm{\delta(t)}$ is continuous in $\mR$ and zero a.e., so that it must be zero everywhere.
\end{mproof}

%\begin{prop}[Weak derivatives and Gelfand triples]
%\label{prop:sob_implies_W}
%Let $H\subseteq V$ be separable Hilbert spaces, $H$ densely embedded in $V$.
%
%Then $y \in L^2(I,V)\cap H^1(I,H) \subseteq W(I,V)$.
%\end{prop}
%\begin{mproof}
%We note that $V$ is Hilbert separable, so, reflexive Banach and separable, so that $V^*$ is separable too. Then, call $i$ the embedding $H \emb V^*$.
%
%For $\phi \in C^\infty_c(I)$ we obtain $\int_I i(y_t)\phi=\int_I i(y_t\phi)= i \left ( \int_I y_t\phi \right )$ by \cref{prop:bochner_bound}. Therefore $\int_I i(y_t)\phi=-i \left ( \int_I y\phi' \right ) =\int_I i(y)\phi'  $ , proving that $y \in W(I,V)$.
%
%\end{mproof}

We now check that a vector valued test function has weak derivatives of all orders.

\begin{prop}[Weak derivatives of test functions]
\label{prop:weak_class}
Let $\phi \in C^1([0,T],X)$, for $X$ separable Banach. It means that the limit of the difference quotients exists for all points of $I$, that $t\mapsto \phi(t), \phi'(t)$ are continuous, and that they can be continuously extended to $[0,T]$.

Then these classical derivatives coincide a.e. with the weak derivatives of $u$.

\end{prop}
\begin{mproof}


We rely on proposition 3.8 of \cite{kreuter} at page 26.

\underline{Absolute continuity}

Consider $\epsilon >0$. Divide $[a,b] \cc (0,T)$ into a uniform partition $t_i$. By theorem 6 at page 146 of \cite{mvt}, we get that $\ds \norm{\phi(t_i)-\phi(t_{i-1})}_X \leq (t_i-t_{i-1})\norm{\phi(\xi_i)}_X\leq (b-a) \norm{\phi'}_{\infty}/n$, and by choosing $n$ small enough, we conclude that $\phi$ is (locally) absolutely continuous.

\underline{Weak derivative}

Therefore, $\phi$ is locally $AC$, differentialble everywhere and $\phi'$ is bounded, so that $\phi \in H^1(I,X)$ and weak and classical derivatives coincide. 

\end{mproof}

And now, introduce a time dependent version of the trace operator which is useful for our computations.

\begin{defn}[Time dependent trace]
Let $\Omega$ be a bounded Lipschitz domain. For $k\geq 0$ we define $\tr: H^k(I,H^1(\Omega))\rightarrow H^k(I, H^{1/2} (\partial \Omega))$ by $\tr(u)(t):=\tr(u(t))$
\end{defn}

Below are some properties of this operator.

\begin{prop}[Properties of trace operator]
\label{prop:trace}
The trace operator just defined:
\begin{enumerate}
\item is well posed
\item is linear bounded
\item admits a linear bounded right inverse, for instance, $E(g)(t):=E(g(t))$ (for $E$ a right inverse of the static trace)
\item $\tr$ and $E$, in the case of $k \in \mathbb{N}_0$, coincide (in the time a.e. sense) for the case $l\geq k$
\item for $k\geq 1$, $\tr u(0)=0 \iff u(0)=0$ (in the sense of continuous representatives)
\item it coincides with the trace treated for instance in \cite{lions}
\end{enumerate}
\end{prop}
\begin{mproof}

\underline{Proof of the proposition}

We recall that the trace operator is bounded surjective onto $H^{1/2}(\partial \Omega)$, with a right inverse $E$ (see theorem 3.37 at page 102 of \cite{mclean}).

The first three points are consequences of this fact and of \cref{prop:bochner_bound}.

The fourth property follows by the definition of $\tr, E$ and the fact that $H^l\subseteq H^k$, for $k\leq l$.

Let now $k\geq 1$. We know that $H^1, H^{1/2}$ are separable and Banach (the latter is separable because the continuos image of $H^1$ separable, and Banach (see \cite{grisvard}, page 20). Therefore, by \cite{evans}, theorem 2 of page 286, we obtain the embeddings $H^k(I,H^1)\emb C([0,T],H^1)$ and the same goes for $H^k(I,H^{1/2})$. The embedding is $U$, the unique continuous representative of a certain time equivalence class (\cref{prop:cts_repr}). We also introduce brackets to indicate equivalence classes in time, so, $u = [Uu]$.

We want to prove $(Uu)(0)=0 \iff U(\tr u)(0)=0$. But we have $[t \mapsto U(\tr u )(t)]=tru:=[t \mapsto \tr((Uu)(t))]$. So, $U(\tr u )(t)=\tr((Uu)(t))$ for all $t\in[0,T]$ by continuity. 

For the last point, let $k=0$. We have:

\begin{enumerate}
\item $H^1(\Omega)\cap C^1(\overline{\Omega})$ is dense in $H^1(\Omega)$ (see \cite{adams}, theorem 3.18 at page 54, where being $\Omega$ bounded Lipschitz is important)
\item functions $\sum_{i\leq m} \phi_i(t)f_i$ for $\phi_i \in C_c^\infty(I), f_i \in H^1(\Omega)\cap C^1(\overline{\Omega})$ are dense in $L^2(I,H^1)$ (see \cite{hinze}, page 39, lemma 1.9)
\end{enumerate}

It follows by the third point that $C^1(\overline{\Omega\times I})$ is dense in $L^2(I,H^1)$, so that $u\mapsto u|_{I\times \partial \Omega}$ admits a unique extension by continuity to $L^2(I,H^1)$, so that this definition of trace coincides with the one from the literature in the case of the space $H^{1,0}:=L^2(I,H^1)$ (see \cite{lions}, theorem 4.1), we expand this argument below.

\underline{Proof of leftover facts}

We call $C^k(\overline{\Omega}):=\{u \in C^k(\Omega) \text{ with }\partial_\alpha f \text{ extendable by continuity to } \overline{\Omega} \}$. 

Consider $u(x,t):=\phi(t)v(x)$, for $\phi \in C^1([0,T]), v \in C^1(\overline{\Omega})$. Then, it has partial derivatives $u_t = \phi_t v, u_i = \phi u_i$. $u$ and all its partial derivatives are continuous on $I\times \Omega$, meaning that $u \in C^1(\Omega \times I)$.

Moreover, $u, u_i, u_t \in C([0,T], C(\overline{\Omega}))$. We claim $ C([0,T], C(\overline{\Omega})) = C(\overline{\Omega\times I})$. In fact, one direction is trivial, and so, let $f \in C([0,T], C(\overline{\Omega})) = C(\overline{\Omega})$. Fix $(t,x) \in \overline{\Omega\times I}$. Then, $|f(s,y)-f(t,x)|\leq |f(t,y)-f(t,x)|+|f(t,y)-f(s,y)|\leq  |f(t,y)-f(t,x)|+\norm{f(t, \cdot)-f(s,\cdot)}_{\infty}$. If now $s$ is close to $t$, and $y$ is close to $x$, then $|f(s,y)-f(t,x)|$ is small.

This shows $u, u_i, u_t \in C([0,T], C(\overline{\Omega})) \in C(\overline{\Omega\times I}) $, i.e. $u \in C^1(\overline{Q\times I})$.

To conclude, let $u \in L^2(I,H^1)$. Approximate $u$ by $u_k:=\sum_{i\leq m_k} \phi_i^k(t)f_i^k$ as in point 2, and approximate $f_i^k$ by suitable $g_i^k \in H^1(\Omega)\cap C^1(\overline{\Omega})$, to obtain $u_k:=\sum_{i\leq m_k} \phi_i^k(t)g_i^k$

Then $\norm{u-w_k}_{L^2(I,H^1)}\leq \norm{u_k-w_k}_{L^2(I,H^1)}+\norm{u_k-u}_{L^2(I,H^1)}$. We only need to estimate $ \norm{u_k-w_k}_{L^2(I,H^1)}\leq\ds  T \sum_{i\leq m_k} \norm{\phi_i^k}_\infty\norm{f_i^k-g_i^k}_{H^1}$. By the first point, $\norm{f_i^k-g_i^k}_{H^1}$ can be made as small as it is necessary to conclude.

\underline{Last remarks}

Again with reference to \cite{lions}, consider the anisotropic spaces $H^{r,s}:=L^2(I,H^r)\cap H^s(I,L^2)$. We restrict to the case $r = 1$, $s\geq 0$. Denote the traces $\tr_s$ defined in theorem 4.1, mapping $H^{1,s}(\Omega \times I)\rightarrow H^{1/2, s/2}(\partial \Omega \times I)$. For $\partial \Omega$ Lipschitz this theorem is still valid, as $1/2\leq 1$, see the discussion above lemma 2.4 in \cite{costabel}. As stated in \cite{lions}, $\tr_s$ is an extension of  $u\mapsto u|_{I\times \partial \Omega}$, defined on the dense suspace $C^\infty(\overline{Q\times I})$ of $H^{1,s}$ (that this space is dense can be proved as in lemma 2.22 of \cite{costabel}). So, let $C^\infty(\overline{Q\times I})\ni u_n \rightarrow_{H^{r,s}} u \in H^{1,s}$.
 
We have $\tr_s u_n = \tr_0 u_n$. Then, $u_n \rightarrow_{H^{1,s}} u$, $u_n \rightarrow_{H^{1,0}} u$, so that $\tr_s u_n \rightarrow_{H^{1/2,s/2}}\tr_s u$ (hence $\tr_0 u_n \rightarrow_{H^{1/2,0}}\tr_s u$) and $\tr_0 u_n  \rightarrow_{H^{1/2,0}} \tr_\sigma u$.

Thus $\tr_0 u = \tr_s u$.

Using what we derived before, we can conclude the characterization of the traces in the anisotropic settign define 

\end{mproof}

And now some sanity checks in the case of Gelfand triples. 

\begin{prop}[Sanity checks for Gelfand triples]
\label{prop:sanity}

Consider the following Gelfand triples (the diagram commutes):

\[\begin{tikzcd}
	{V} &&& {V^*} \\
	& H & {H^*} \\
	{W} &&& {W^*}
	\arrow["c", hook, from=3-1, to=1-1]
	\arrow["a", hook, from=1-1, to=2-2]
	\arrow["b"', hook, from=3-1, to=2-2]
	\arrow["{a^*}", hook, from=2-3, to=1-4]
	\arrow["r", from=2-2, to=2-3]
	\arrow["{b^*}"', hook, from=2-3, to=3-4]
	\arrow["{c^*}", hook, from=1-4, to=3-4]
\end{tikzcd}\]

Here $W\subseteq V \subseteq H$ are all separable Hilbert spaces, $a,b,c$ the trivial injections, $r$ the Riesz isomorphism of $H$. We denote by $i_V$ the Gelfand triple embedding $V\emb V^*$, so, $i_V=a^*ra$.

Then:

\begin{enumerate}
	\item $H^1(I,V)\subseteq W(I,V)$ with continuous embedding. The $W(I,V)$ derivative of $u \in H^1(I,V)$ is $i_V u_t$.
	\item for $u \in W(I,W)$ with $(i_W u)'\in L^2(I,H)$ (i.e. $(i_W u)_t = b^*r h$ for $h$ in $L^2(I,H)$) we obtain $u \in W(I,V)$ (i.e. $cu \in W(I,V)$), with derivative $(i_V cu)'=a^*r h$, so that also $(i_V cu)' \in L^2(I,H)$. It also holds $(i_V cu)'|_W = (i_W u)'$. $h$ is also the weak derivative $L^2(I,H)$ of $bu$.
	\item let $u, v \in W(I,V)$ with $u-v \in W$. Then $u-v \in W(I,W)$ with derivative $(i_W(u-v))'=(i_V u)'|_W-(i_V v)'|_W$.
\end{enumerate}

\end{prop}
\begin{mproof}

We use several times that time integrals and bounded linear static operators commute, see \cref{prop:bochner_bound}. $\phi$ denotes $\phi \in C^\infty_c(I)$.

\underline{First point}

We need to check that $a^* r a u \in H^1(I, V^*)$. This follows from \cref{lemma:bochner_Hk_map}, so that $(a^* r a u)_t = a^* r a u_t$.

\underline{Second point}

At first we claim that $h$ is a weak derivative of $bu \in L^2(I,H)$. In fact, $b^* r \int_I bu \phi' = \int_I (i_W u)\phi' = \ind{\mind{u \in W(I,W)}} =-\int_I(i_Wu)'\phi=-\int_I b^*r h\phi = b^*r (-\int_I h \phi)$. By density (definition of Gelfand triple), $b^*$ is injective, $r$ is too, and thus $\int_I bu \phi' = -\int_I h \phi$, which shows that $bu$ has weak derivative $h$, in the $H^1(I,H)$ sense.

And now $\int_I i_V c u \phi'= \int_I a^*racu \phi' = a^*r\int_I bu\phi' = \ind{by what we just proved}=-a^*r \int_I h \phi$, proving that $(i_V cu)'=a^*r h$.

Morevoer $(i_V cu)'|_W = c^*a^*r h=b^*rh=\ind{assumption} = (i_W u)'$.

\underline{Third point}

We check the derivative. We have $\int_i i_W(u-v)\phi' =\ind{\mind{u-v \in W\subseteq V}} = \int_I b^* r a (u-v) = c^*\int_I(i_Vu - i_Vv)\phi' = -\int c^*((i_V u)'- (i_V v)')\phi$.

\end{mproof}

\chapter{Parabolic equations}
\label{chap:parab_eq}

\section{Abstract theory}

\begin{ass}[Basic assumption for parabolic problems]
\label{ass:basic_par}

Let $V\subseteq H$ be real separable Hilbert spaces, $V$ dense in $H$. Then $H\hookrightarrow V^*$ is also dense, as stated in \cite{trol} at page 147. This embedding is $H \ni f \mapsto (f, \cdot )_H$. We thus obtain a Gelfand triple, and we have $W(I,V)\subseteq C(I,H)$.

Let $A:V\rightarrow V^* $ be linear bounded, $u \in W(I;V)$, $f \in L^2(I,V^*)$ and $u_0 \in H$.

We also assume that $\langle Av, v \rangle_{V^*,V}+ \lambda \HN{v}^2\geq \alpha \VN{v}^2$ for $\lambda \geq 0, \alpha >0$.
\end{ass}

We are interested in the following problem:

\begin{pb}[Abstract parabolic equation]
\label{eqn:general_parabolic}
\begin{align}
	u_t+Au=f \text{ in }V^* \text{ and for a.e. } t \in (0,T)\\
	u(0)=u_0
\end{align}
\end{pb}

\begin{thm}[Basic well posedness of \cref{eqn:general_parabolic}]
\label{thm:well_pos_parabolic}
Under \cref{ass:basic_par}, \cref{eqn:general_parabolic} has a unique solution $u$. Moreover $u$ satisfies the energy estimate:
\begin{equation}
	\label{eqn:en_est}
	\norm{u}_{W(I,V)} + \norm{u}_{C([0,T],H)}\leq c(\lambda, \alpha, \VSN{A}, T)(\HN{u_0}+\norm{f}_{L^2(I,V^*)})
\end{equation} 
\end{thm}
\begin{mproof}
See \cite{gilardi} at page 19, theorem 26.
\end{mproof}

We can also obtain additional regularity. Here are further assumptions to make this possible.

\begin{ass}[Assumptions for additional regularity]
\label{ass:reg_par}
We assume $u_0 \in V$, $f = f_1+f_2 \in L^2(I,H)+H^1(I,V^*)$. We also need $A$ to be symmetric (i.e. $\langle Au,v \rangle_{V^*,V} = \langle Av,u \rangle_{V^*,V}$).
\end{ass}

\begin{thm}[Regularity of time derivative]
\label{thm:reg_time}
Suppose \cref{ass:basic_par} and \cref{ass:reg_par}. Then $u_t \in L^2(I, H)$ with the estimate:
\begin{align}
	\norm{u}_{W(I,V)} + \norm{u}_{C(I,H)} + \norm{u_t}_{L^2(I,H)} \leq\\ c(\lambda, \alpha, \VSN{A}, T)(\VN{u_0}+\norm{f_1}_{L^2(I,H)} + \norm{f_2}_{H^1(I,V^*)})
\end{align}

That $u_t \in L^2(I, H)$ means precisely that there is $h \in L^2(I,H)$ with $a^* r h = (i_V u)'$, with the notation introduced in \cref{prop:sanity}.

\end{thm}
\begin{mproof}
We refer to page 26 of \cite{gilardi}, theorem 28, and only prove the necessary modifications.

\underline{Product rule for $A$}

We have 

\begin{align*}
\int_0^t \langle Au_n,u_n' \rangle_{V^*,V} = \sum_{k,l\leq n} \langle Aw^n_k,w^n_l \rangle_{V^*,V} \int_0^t g_k^n g_l^{n '} = \\
\sum_{k,l\leq n} \langle Aw^n_k,w^n_l \rangle_{V^*,V} \left (-\int_0^t g_k^{n'} g_l^n + g_k^n(t) g_l^n(t)-g_k^n(0) g_l^n(0) \right )
\end{align*}

By linearity at first and then symmetry we get:

\begin{align*}
	= \langle Au_n,u_n \rangle_{V^*,V}(t)-\langle Au_n,u_n' \rangle_{V^*,V}(0)-\int_0^t\langle Au_n',u_n \rangle_{V^*,V}=\\
	= \langle Au_n,u_n \rangle_{V^*,V}(t)-\langle Au_n,u_n' \rangle_{V^*,V}(0)-\int_0^t\langle Au_n,u_n' \rangle_{V^*,V}
\end{align*}

so that:

\begin{align*}
	\int_0^t \langle Au_n,u_n' \rangle_{V^*,V} = \frac{1}{2}\left( \langle Au_n,u_n \rangle_{V^*,V}(t)-\langle Au_n,u_n' \rangle_{V^*,V}(0) \right )
\end{align*}

\underline{Estimate for right hand side}

We have:

\begin{align*}
	\int_0^t \langle f_2,u_n' \rangle_{V^*,V} = \sum_{k\leq n}\int_0^tg_k^{n'}\langle f_2,w_k^n \rangle_{V^*,V}
\end{align*}

By the smoothness of $f_2$ we have that $t \mapsto \langle f_2(t),w_k^n \rangle_{V^*,V}$ is $H^1(0,T)$, in particular $AC[0,t]$, so that we can integrate by parts:

\begin{align*}
	 = - \sum_{k\leq n}\int_0^tg_k^{n}\langle f_2',w_k^n \rangle_{V^*,V} + \sum_{k\leq n} g_k^{n}(t)\langle f_2(t),w_k^n \rangle_{V^*,V} - \sum_{k\leq n} g_k^{n}(0)\langle f_2(0),w_k^n \rangle_{V^*,V} = \\
	 -\int_0^t \langle f_2',u_n \rangle_{V^*,V} + \langle f_2,u_n \rangle_{V^*,V}(t)-\langle f_2,u_n \rangle_{V^*,V}(0)
\end{align*}

Here we have used \cref{lemma:bochner_Hk_map} to take the derivative inside the bracket.

Note that by the smoothness of $f_2$, we can write, for instance, $\langle f_2,u_n \rangle_{V^*,V}(0) = \langle f_2(0),u_n \rangle_{V^*,V}$.

\tred{NB: here I need $f_2(0) \in V$ probably, but I'm not yet using the compatibility condition!}.

Going to the absolute values:

\begin{align*}
	\left | \int_0^t \langle f_2,u_n' \rangle_{V^*,V}\right | \leq 
	\int_0^T |\langle f_2',u_n \rangle_{V^*,V}|+ \VSN{f_2(t)}\VN{u_n(t)}+\VSN{f_2(0)}\VN{u_n(0)} \leq \\
	\frac{1}{2}\norm{f_2'}_{L^2(I,V^*)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 + \frac{\alpha}{4}\VN{u_n(t)}^2 +\\
	+ \frac{4}{\alpha}\norm{f_2}_{L^\infty(I,V^*)}^2+ \frac{1}{2}\norm{f_2}_{L^\infty(I,V^*)}^2+\frac{1}{2}\VN{u_{n0}}^2
\end{align*}

Now, $u_n$ converges weakly in $L^2(I,V)$ by estimate (59) of \cite{gilardi} and thus $\frac{1}{2}\norm{u_n}_{L^2(I,V)}$ is bounded. The term $\frac{\alpha}{4}\VN{u_n(t)}$ can be pulled to the left hand side, $u_{0n}$ is $V$ convergent hence bounded. Therefore as in \cite{gilardi} we are able to conclude that $u_n'$ is bounded in $L^2(I,H)$. We want to conclude $u_t \in L^2(I,H)$. We know for sure that $\langle u_m',w_j\rangle_{V^*,V}=\langle f-Au_m,w_j\rangle_{V^*,V}$, so that muliplication by a test function and integration yields $\int_I \langle u_m',w_j\phi\rangle_{V^*,V}=\int_I \langle f-Au_m,w_j\phi\rangle_{V^*,V}$. Because $u_m\rightharpoonup u$ in $L^2(I,V)$ we observe that, by \cref{prop:bochner_bound} applied on $A \in L(V,V^*)$, it holds $\int_I \langle u_m',w_j\phi\rangle_{V^*,V}\rightarrow \int_I \langle u',w_j\phi\rangle_{V^*,V}$.

What's more, is that $u_m' \rightharpoonup h$ in $L^2(I,H)$, so that $\int_I \langle h ,w_j\rangle_{V^*,V}\phi = \int_I \langle u',w_j\rangle_{V^*,V}\phi$. It means that for almost all $t$, $\langle h ,w_j\rangle_{V^*,V} = \langle u',w_j\rangle_{V^*,V}$. And now we can really say that $u' \in L^2(I,H)$, which even more precisely means $(i_Vu)' = a^* r h$ almost everywhere.

We also obtain that $u_t$ is bounded by $c(\alpha)(\norm{f_2}_{L^\infty(I,V^*)}+\norm{f_2}_{L^2(I,V^*)}+\VN{u_0}+\norm{u}_{L^2(I,V)})$.

Note that, by \cite{evans}, theorem 2 of page 286, we can estimate $\norm{f_2}_{L^\infty(I,V^*)}$ by $c(T)\norm{f_2}_{H^1(I,V^*)}$, so that the claim for the time derivative $u_t$ is proven.

\end{mproof}

For the case where $H=L^2$, $H^1\supseteq V\supseteq H^1_0$,  $f_2|_{H^1_0}=0$ we have even more regularity available.

\begin{thm}[Additional regularity]
\label{thm:par_reg}
Suppose \cref{ass:basic_par} and \cref{ass:reg_par}. 

Let additionally $H=L^2$, $H^1\supseteq V\supseteq H^1_0$,  $f_2|_{H^1_0}=0$. Then $Au|_{H^1_0}$ extends to $\overline{Au_{H^1_0}} \in L^2(I,H)$ with:
\begin{align}
	\norm{u}_{W(I,V)} + \norm{u}_{C([0,T],H)} + \norm{u_t}_{L^2(I,H)} +\norm{\overline{Au|_{H^1_0}}}_{L^2(I,H)}\leq\\ c(\lambda, \alpha, \VSN{A}, T)(\VN{u_0}+\norm{f_1}_{L^2(I,H)} + \norm{f_2}_{H^1(I,V^*)})
\end{align}

Moreover $u_t+\overline{Au_{H^1_0}}=f_1$ in $L^2(0,T,L^2)\cong L^2(Q)$ and $\overline{Au|_{H^1_0}}=Au$ on $H^1_0$.

\end{thm}
\begin{mproof}

For $v \in H^1_0$ we get $ \langle Au,v \rangle_{V^*,V} =  \langle f_1-u_t,v \rangle_{V^*,V} = ( f_1-u_t,v )_H$, for almost all $t \in (0,T)$. From here we conclude that $Au(t)$ extends for a.a. $t$ to an element of $H$ with $(\overline{Au}-f_1+u_t,v)_{L^2}=0$ for all $v \in H^1_0$, almost all $t$. By density, $\overline{Au}-f_1+u_t=0$ in $H$ for almost all $t$, so that $\overline{Au}=f_1-u_t$ in $L^2(0,T,L^2)\cong L^2(Q)$.

This isometric isomorphism is stated in \cite{trol}, page 144. 

\end{mproof}

For our applications we also need to track the constants more precisely, which is accomplished in the next proposition.

\begin{prop}[Tracking the costants]
\label{thm:const_track}
With \cref{ass:basic_par} there holds:
\begin{align}
\norm{u}^2_{C([0;T],H)}+\alpha\norm{u}_{L^2(I,V)}^2\leq \exp(2\lambda T)(\HN{u_0}^2+\alpha^{-1}\norm{f}^2_{L^2(I,V^*)})\\
\norm{u'}_{L^2(I,V^*)}\leq \norm{A}_{L(V,V^*)}\alpha^{-1/2}\sqrt{\exp(2\lambda T)}\HN{u_0} +\\\left (\norm{A}_{L(V,V^*)}\alpha^{-1}\sqrt{\exp(2\lambda T)}+1\right ) \norm{f}_{L^2(I,V^*)}
\end{align}

With additionally \cref{ass:reg_par} we obtain:

\begin{align}
C\norm{u'}^2_{L^2(I,H)}\leq 
(1+(1+C_0)\alpha^{-1})\norm{f_2}_{H^1(I,V^*)}^2+\\
(1+\norm{A}_{L(V,V^*)})\VN{u_{0}}^2+C_0\HN{u_0}^2+\\
\norm{f_1}_{L^2(I,H)}^2+C_0\alpha^{-1}\norm{f_1}^2_{L^2(I,V^*)}
\end{align}

with $C>0$ a number independent of the problem.

Here $C_0 = \ds 2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)$.

\end{prop}
\begin{mproof}

\underline{No regularity}

From page 21 of \cite{gilardi} we obtain that $\norm{u}^2_{C([0;T],H)}+\alpha\norm{u}_{L^2(I,V)}^2\leq \exp(2\lambda T)(\HN{u_0}^2+\alpha^{-1}\norm{f}^2_{L^2(I,V^*)})$.

In particular, $\sqrt{\alpha}\norm{u}_{L^2(I,V)}\leq 	\sqrt{\exp(2\lambda T)}(\HN{u_0}+\alpha^{-1/2}\norm{f}_{L^2(I,V^*)})$, or $\norm{u}_{L^2(I,V)}\leq 	\alpha^{-1/2}\sqrt{\exp(2\lambda T)}(\HN{u_0}+\alpha^{-1/2}\norm{f}_{L^2(I,V^*)})$.

Moreover $\norm{u'}_{L^2(I,V^*)}\leq \norm{Au}_{L^2(I,V^*)}+\norm{f}_{L^2(I,V^*)}\leq \norm{A}\norm{u}_{L^2(I,V)}+\norm{f}_{L^2(I,V^*)}$.

All in all, we obtain:

$$\norm{u}^2_{C([0;T],H)}+\alpha\norm{u}_{L^2(I,V)}^2\leq \exp(2\lambda T)(\HN{u_0}^2+\alpha^{-1}\norm{f}^2_{L^2(I,V^*)})$$

and:

$$\norm{u'}_{L^2(I,V^*)}\leq \norm{A}_{L(V,V^*)}	\alpha^{-1/2}\sqrt{\exp(2\lambda T)}(\HN{u_0}+\alpha^{-1/2}\norm{f}_{L^2(I,V^*)})+\norm{f}_{L^2(I,V^*)}$$

\underline{More regularity}

We tie back to page 25 of \cite{gilardi}. In particular:

\begin{align*}
\int_0^t\HN{u_n'}^2+\int_0^t\langle A u_n, u_n'\rangle_{V^*,V}=\int_0^t(f_1,u_n')_H+\int_0^t \langle f_2, u_n'\rangle_{V^*,V}
\end{align*}

%Now, taking $u_{n0}$ to be the orthogonal projection of $u_0$ onto $V_n$ with the scalar product of $V$, we can assume $\VN{u_{n0}}\leq\VN{u_0}$.

Then:
\begin{align*}
\int_0^t\langle A u_n, u_n'\rangle_{V^*,V}\geq \frac{\alpha}{2}\VN{u_n(t)}^2-\frac{\lambda}{2}\HN{u_n(t)}^2-\frac{\norm{A}}{2}\VN{u_{n0}}
\end{align*}

whereas, as in the proof of \cref{thm:reg_time}:
\begin{align*}
	\left | \int_0^t \langle f_2,u_n' \rangle_{V^*,V}\right | \leq
	\frac{1}{2}\norm{f_2'}_{L^2(I,V^*)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 + \frac{\alpha}{4}\VN{u_n(t)}^2 +\\
	+ \frac{4}{\alpha}\norm{f_2}_{L^\infty(I,V^*)}^2+ \frac{1}{2}\norm{f_2}_{L^\infty(I,V^*)}^2+\frac{1}{2}\VN{u_{n0}}^2
\end{align*}

Also:
\begin{align*}
\int_0^t(f_1,u_n')_H\leq \frac{1}{2}\norm{f_1}_{L^2(I,H)}^2+\frac{1}{2}\int_0^t\HN{u_n'}^2
\end{align*}

Putting all together:

\begin{align*}
\int_0^t\HN{u_n'}^2+\frac{\alpha}{2}\VN{u_n(t)}^2-\frac{\lambda}{2}\HN{u_n(t)}^2-\frac{\norm{A}}{2}\VN{u_{n0}} \\
\frac{1}{2}\norm{f_2'}_{L^2(I,V^*)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 + \frac{\alpha}{4}\VN{u_n(t)}^2 +\\
+ \frac{4}{\alpha}\norm{f_2}_{L^\infty(I,V^*)}^2+ \frac{1}{2}\norm{f_2}_{L^\infty(I,V^*)}^2+\frac{1}{2}\VN{u_{n0}}^2+\\
+ \frac{1}{2}\norm{f_1}_{L^2(I,H)}^2+\frac{1}{2}\int_0^t\HN{u_n'}^2
\end{align*}

which brings us to:

\begin{align}
\label{eqn:weak_der_bound}
\frac{1}{2}\int_0^t\HN{u_n'}^2+\frac{\alpha}{4}\VN{u_n(t)}^2-\frac{\lambda}{2}\HN{u_n(t)}^2\leq \\
\frac{1}{2}\norm{f_2'}_{L^2(I,V^*)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 +\\
+ \frac{8+\alpha}{2\alpha}\norm{f_2}_{L^\infty(I,V^*)}^2+\frac{1+\norm{A}}{2}\VN{u_{n0}}^2+\\
+\frac{1}{2}\norm{f_1}_{L^2(I,H)}^2
\end{align}

and thus, because norms are lower semicontinuous and because we have weak convergence of the time derivative, and $V$-strong convergence of the initial data:

\begin{align*}
\frac{1}{2}\int_0^T\HN{u'}^2\leq 
\frac{1}{2}\norm{f_2'}_{L^2(I,V^*)}^2 
+ \frac{8+\alpha}{2\alpha}\norm{f_2}_{L^\infty(I,V^*)}^2+\frac{1+\norm{A}}{2}\VN{u_{0}}^2+
\frac{1}{2}\norm{f_1}_{L^2(I,H)}^2+\\
\text{limsup}_n \left ( \frac{\lambda}{2}\norm{u_n}_{C([0,T],H)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )
\end{align*}

Using a purely numeric constant $C$  without dependences on the problem we can write:

\begin{align*}
\int_0^T\HN{u'}^2\leq 
\norm{f_2'}_{L^2(I,V^*)}^2+C(1+\alpha^{-1})\norm{f_2}_{L^\infty(I,V^*)}^2+C(1+\norm{A})\VN{u_{0}}^2+\norm{f_1}_{L^2(I,H)}^2+\\
C\text{limsup}_n \left ( \frac{\lambda}{2}\norm{u_n}_{C([0,T],H)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )
\end{align*}


For the last term, employing the exact argument as in the first part of the proof:

\begin{align}
\label{eqn:limsup}
\text{limsup}_n \left ( \frac{\lambda}{2}\norm{u_n}_{C([0,T],H)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )\leq\\
2^{-1}\max(1,\lambda)\max(1,\alpha^{-1}) \text{limsup}_n \left ( \norm{u_n}_{C([0,T],H)}^2 + {\alpha}\norm{u_n}_{L^2(I,V)}^2 \right )\leq\\
2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)(\HN{u_0}^2+\alpha^{-1}\norm{f_1+f_2}^2_{L^2(I,V^*)}) \leq \\
2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)(\HN{u_0}^2+2\alpha^{-1}\norm{f_1}^2_{L^2(I,V^*)}+2\alpha^{-1}\norm{f_2}^2_{L^2(I,V^*)}) \leq \\
C C_0(\HN{u_0}^2+\alpha^{-1}\norm{f_1}^2_{L^2(I,V^*)}+\alpha^{-1}\norm{f_2}^2_{L^2(I,V^*)})
\end{align}


where $C_0 = \ds 2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)$ and $C$ is a purely numeric constant without dependences on the problem.

Therefore:

\begin{align*}
C\int_0^T\HN{u'}^2\leq 
\norm{f_2'}_{L^2(I,V^*)}^2+(1+\alpha^{-1})\norm{f_2}_{L^\infty(I,V^*)}^2+(1+\norm{A})\VN{u_{0}}^2+\norm{f_1}_{L^2(I,H)}^2+\\
C_0(\HN{u_0}^2+\alpha^{-1}\norm{f_1}^2_{L^2(I,V^*)}+\alpha^{-1}\norm{f_2}^2_{L^2(I,V^*)})
\end{align*}


The embedding $H^1(I,V^*)\emb C([0,T],V^*)$ has norm that only depends on $T$, which follows from the equality $f_2(t)=f_2(s)+\int_s^tf_2'$, for $0\leq s \leq t \leq T$, a bound being $1+T$.

Thus:

\begin{align*}
C\int_0^T\HN{u'}^2\leq 
(1+(1+C_0)\alpha^{-1})\norm{f_2}_{H^1(I,V^*)}^2+\\
(1+\norm{A})\VN{u_{0}}^2+C_0\HN{u_0}^2+\\
\norm{f_1}_{L^2(I,H)}^2+C_0\alpha^{-1}\norm{f_1}^2_{L^2(I,V^*)}
\end{align*}


\end{mproof}

\begin{ass}[Even more assumptions for even more regularity]
\label{ass:zero_comp}
We make the hypothesis $u_0=0$, which is the only case that is of interest for us, together with $A$ symmetric. Moreover, we require that the source term is a generic $f\in H^1(I,V^*)$ (in particular, the split $f=f_1 +f_2 \in L^2(I,H)+H^1(I,V^*)$ is not sufficient anymore), so that it is continuous  (\cite{evans}, page 286, theorem 2), and we can therefore ask the additional condition $f(0) \in H$.
\end{ass}

\begin{prop}[More smoothness from zero-order compatibility]
Let \cref{ass:basic_par} and \cref{ass:zero_comp} hold. Then $u \in H^1(I,V)$ (in particular, $u \in C([0,T];V)$), and  $u' \in L^\infty(I,H)$ with the estimates:

\begin{align*}
\norm{u'}^2_{L^\infty(I,H)} \leq \exp(2\lambda T) \left (  \HN{f(0)}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2\right )
\end{align*}

and:

\begin{align*}
\int_0^T \VN{u'}^2 \leq  \frac{1}{\alpha } \HN{f(0)}^2 + C_1\norm{f}_{H^1(I,V^*)}^2  + 2\lambda\frac{8+\alpha}{\alpha^2}\norm{f}_{L^\infty(I,V^*)}^2
\end{align*}

with $C_0 = \ds 2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)$, $C$ is a purely numeric constant without dependences on the problem, $C_1:=\alpha^{-2} + 4 \lambda C C_0 \alpha^{-2} + 2\lambda\alpha ^{-1} $.


\end{prop}

\begin{mproof}

We consider again the functions $u_n$ as defined in \cite{gilardi}, page 22, equation (54).

Thanks to the smoothness of $u_n$ and $f$, which are both $H^1$ in time, we can conclude that $u_n \in H^2(I,V_n)$, due to a bootstrapping argument from equation (56) of \cite{gilardi}.

So, upon differentiation, we get that $\langle u_n'', v_n\rangle_{V^*,V} + \langle A u_n', v_n\rangle_{V^*,V} = \langle f', v_n \rangle_{V^*,V}$ for almost every $t$ (actually, for all $t$). Anyhow, thanks to the smoothness of $u_n'$, we can substitute it as $v_n \in V_n$ and integrate from $0$ to $t$ to obtain:

\begin{align*}
\int_0^t \langle u_n'', u_n'\rangle_{V^*,V} + \int_0^t\langle A u_n',u_n'\rangle_{V^*,V} = \int_0^t \langle f', u_n' \rangle_{V^*,V}
\end{align*}

Equivalently, being $u_n'(t) \in H$, we can write:

\begin{align*}
\int_0^t (u_n'', u_n')_H + \int_0^t\langle A u_n',u_n'\rangle_{V^*,V} = \int_0^t \langle f', u_n' \rangle_{V^*,V}
\end{align*}

Using the assumptions on $A$:

\begin{align*}
\int_0^t (u_n'', u_n')_H + \alpha \int_0^t \VN{u_n'}^2 - \lambda \int_0^t \HN{u_n'}^2 \leq \int_0^t \langle f', u_n' \rangle_{V^*,V}
\end{align*}

Therefore:

\begin{align*}
\frac{1}{2} \HN{u_n'(t)}^2 + \alpha \int_0^t \VN{u_n'}^2 \leq \frac{1}{2} \HN{u_n'(0)}^2+ \lambda \int_0^t \HN{u_n'}^2 +\frac{1}{2\alpha} \int_0^t \VSN{ f'}^2+ \frac{\alpha}{2}\int_0^t \VN{u_n'}^2
\end{align*}

We need to estimate the $H$ norm of $u_n'(0)$, for which the compatibility condition on $f(0)$ is essential.

In fact, because the ODE for $u_n$ held a.e., and now that $u_n' \in H^1(I,V)$, the ODE holds for all times and we can conclude that $(u_n'(0),u_n'(0))_H + \langle A u_n(0), u_n'(0)\rangle_{V^*,V} = ( f(0), u_n'(0))_H$. Here comes in handy the fact that $u_0=0$, so that $u_n(0)=0$ too and therefore $\HN{u_n'(0)}^2  \leq 2^{-1}\HN{f(0)}^2 + 2^{-1} \HN{u_n'(0)}^2$ and therefore, $\HN{u_n'(0)}^2\leq \HN{f(0)}$.

With this bound:

\begin{align*}
\HN{u_n'(t)}^2 + \alpha \int_0^t \VN{u_n'}^2 \leq \HN{f(0)}^2+ 2\lambda \int_0^t \HN{u_n'}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2
\end{align*}

\underline{The $L^\infty$ estimate}

Gronwall's lemma (in the form of \cite{gilardi} at page 19) yields:

\begin{align*}
\HN{u_n'(t)}^2 \leq \exp(2\lambda T) \left (  \HN{f(0)}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2\right )
\end{align*}

This alone doesn't show that $u'\in L^\infty(I,H)$, but if this was true, and is $u_n'(t)\rightarrow_H u'(t)$ for a.e. $t$ modulo subsequences, then this would yield the required estimate on the norm.

Now, $u_n, u_n' \rightharpoonup_H u, u'$ (where $u'$ is the $L^2(I,H)$ representative of the derivative of $u$ in the distributional sense, see the proof of \cref{thm:reg_time}). This is true modulo a common subsequence

%, but since we also know the boundedness of $u_n, u_n' $ in $L^2(I,H)$ (cfr the proof of \cref{thm:reg_time} and page 23 of \cite{gilardi}), we conclude the convergence of the full sequences.

Because $u_n', u'$ are the $L^2(I,H)$ sense derivatives of $u_n, u$ (thanks to the injectivity of $H^* \emb V^*$), then, by the compactness theorem 2.1 at page 271 of \cite{navier_stokes} with $X_0=X=X_1=H$ we conclude that $u_n \rightarrow u$ strongly in $L^2(I,H)$. Thanks to proposition 2.13 at page 10 of \cite{kreuter}, $u_n\rightarrow_H u$ for a.e. $t$, modulo a further subsequence.

The bound shown above implies that $u' \in L^\infty(I,H)$ as we wished. 

\underline{$u' \in L^2(I,V)$}


We know:


\begin{align*}
\HN{u_n'(t)}^2 + \alpha \int_0^t \VN{u_n'}^2 \leq \frac{1}{2} \HN{f(0)}^2+ 2\lambda \int_0^t \HN{u_n'}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2
\end{align*}

so that:


\begin{align*}
\alpha \int_0^T \VN{u_n'}^2 \leq \frac{1}{2} \HN{f(0)}^2+ 2\lambda \int_0^T \HN{u_n'}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2
\end{align*}

But the proof of \cref{thm:const_track} says (cfr. \cref{eqn:weak_der_bound}):

\begin{align*}
\frac{1}{2}\int_0^t\HN{u_n'}^2+\frac{\alpha}{4}\VN{u_n(t)}^2\leq \\
\frac{\lambda}{2}\HN{u_n(t)}^2 + \frac{1}{2}\norm{f'}_{L^2(I,V^*)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 + \frac{8+\alpha}{2\alpha}\norm{f}_{L^\infty(I,V^*)}^2\\
\end{align*}

In particular:

\begin{align*}
2\lambda\int_0^T\HN{u_n'}^2\leq \\
4 \lambda \left (\frac{\lambda}{2} \norm{u_n}^2_{C([0,T];H)} + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )+ 2\lambda \norm{f'}_{L^2(I,V^*)}^2  + 2\lambda\frac{8+\alpha}{\alpha}\norm{f}_{L^\infty(I,V^*)}^2\\
\end{align*}

so that:

\begin{align*}
\alpha \int_0^T \VN{u_n'}^2 \leq \frac{1}{2} \HN{f(0)}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2+\\
4 \lambda \left (\frac{\lambda}{2} \norm{u_n}^2_{C([0,T];H)} + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )+ 2\lambda \norm{f'}_{L^2(I,V^*)}^2  + 2\lambda\frac{8+\alpha}{\alpha}\norm{f}_{L^\infty(I,V^*)}^2
\end{align*}

As we have already seen (or as it is explained at page 23 of \cite{gilardi}), the term in the brackets is bounded above.

%Now, remember that $u_n$ was bounded in $L^2(I,V)$, and that any weakly convergent subsequence would solve the parabolic problem. Thus, $u_n \rightharpoonup u$ in $L^2(I,V)$ (cfr. page 23 in \cite{gilardi}).

Morevoer, we showed in the proof of \cref{thm:reg_time} that $u_n'$ is bounded in $L^2(I,H)$, and that any weakly convergent subsequence would reach $u'$, thus yielding the weak convergence of the full sequence.


Also we now have that $u_n'$ is bounded in $L^2(I,V)$, thus admitting a weakly convergent subsequence to $w$, in $L^2(I,V)$. Because it is implied the weak convergence in $L^2(I,H)$, to $w$, we obtain that $w=u' $. Reiterating the argument and thanks to the boundedness of the full sequence, the full sequence must converge weakly in $L^2(I,V)$ to $u'$.

By lower semicontinuity of the norm:

\begin{align*}
\alpha \int_0^T \VN{u'}^2 \leq \HN{f(0)}^2 +\frac{1}{\alpha} \int_0^T \VSN{ f'}^2+\\
4 \lambda \limsup_n\left (\frac{\lambda}{2} \norm{u_n}^2_{C([0,T];H)} + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )+ 2\lambda \norm{f'}_{L^2(I,V^*)}^2  + 2\lambda\frac{8+\alpha}{\alpha}\norm{f}_{L^\infty(I,V^*)}^2
\end{align*}

Remembering \cref{eqn:limsup}:

\begin{align*}
\text{limsup}_n \left ( \frac{\lambda}{2}\norm{u_n}_{C([0,T],H)}^2 + \frac{1}{2}\norm{u_n}_{L^2(I,V)}^2 \right )\leq\\
C C_0 \alpha^{-1}\norm{f}^2_{L^2(I,V^*)}
\end{align*}


where $C_0 = \ds 2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)$ and $C$ is a purely numeric constant without dependences on the problem, so that:

\begin{align*}
\int_0^T \VN{u'}^2 \leq \\ \frac{1}{\alpha } \HN{f(0)}^2 + C_1\norm{f}_{H^1(I,V^*)}^2  + 2\lambda\frac{8+\alpha}{\alpha^2}\norm{f}_{L^\infty(I,V^*)}^2
\end{align*}

for $C_1:=\alpha^{-2} + 4 \lambda C C_0 \alpha^{-2} + 2\lambda\alpha ^{-1} $.

Because the embedding $H\emb V$ is injective, $u'$ is also the weak derivative, $L^2(I,V)$ sense, of $u \in L^2(I,V)$, so that $u \in H^1(I,V)$. And thus, thanks to theorem 2 at page 286 of \cite{evans}, we obtain $u \in C([0,T]; V)$.

\end{mproof}


\section{Application to inhomogeneous parabolic problems}

\subsection{Inhomogeneous Dirichlet problem}
\label{subs:inh_diri}

We make the following assumption.

\begin{ass}[Assumptions for \cref{pb:diri}]
\label{ass:diri}
We assume $\Omega \cc D $ to be bounded Lipschitz domains, so that $U:=D\setminus \Omega$ is bounded Lipschitz too and  the trace operator is bounded surjective onto $H^{1/2}(\partial U)$, with a right inverse $E$ (see theorem 3.37 at page 102 of \cite{mclean}). For such a choice we also have $H^1_0=H^1\cap \text{ker }\tr$, see \cite{leoni}, page 595, theorem 18.7.

Moreover, we select $f \in H^1(I, H^{1/2}(\Gamma_f))$, $f(0)=0$.
\end{ass}

Note that, given a bounded extension operator $E: H^{1/2}(\partial U) \rightarrow H^1(U)$, we obtain by \cref{lemma:bochner_Hk_map} that $Ef \in H^2(I, H^1(U))$. We have defined $\tr u (t):= tr(u(t))$ and analogously $Eu(t):=E(u(t))$ (see \cref{prop:trace}).

Call $H=L^2(U)$, $V=\{ v \in H^1(U), \tr u = 0 \text{ on } \Gamma_m\}=:H^1_c$. $V$ is a closed subspace of $H^1$, which is Hilbert separable, hence also Hilbert separable. We norm it with the full $H^1$ norm. Because $H^1_0(U)$ is dense in $H$, so is $V$ and we obtain a Gelfand triple. That $V$ is a closed subspace of $H^1$ follows from the observation that if $u_n\rightarrow u$ in the $V$ norm, then $\tr u_n \rightarrow \tr u$ in $L^2(\partial U)$. We can take an almost everywhere pointwise convergent sequence, so that $\tr u_n \rightarrow \tr u$ a.e., and by the fact that $\Gamma_m$ has positive Hausdorff measure, we conclude $\tr u = 0$ on $\Gamma_m$.

We define $A:= H^1 \rightarrow H^{1*}$ by $(Au)v:=\int_u\nabla u \nabla v$. This operator can be the recast to $V\rightarrow H^{-1}$ and $V\rightarrow V^*$.

The problem under consideration is the following. For $U = D\setminus \Omega$ we have:

\begin{pb}[Inhomogeneous heat equation, Dirichlet conditions]
\label{pb:diri}
\begin{align}
u_t - \Delta u = 0 \text{ in } (0,T)\times U\\
u(\Sigma_f)=f\\
u(\Sigma_m)=0\\
u(0)=0
\end{align}

By this we mean:

\begin{align}
u \in W(I,H^1_c) \\
u_t|_{H^{-1}} + A u = 0 \text{ in }H^{-1} \text{ and for a.e. } t \in (0,T) \\
\tr u = f \text{ on } \Sigma_f\\
u(0)=0
\end{align}

\end{pb}

\begin{thm}[Well posedness and regularity for \cref{pb:diri}]
\label{prop:diri_wp}
Given \cref{ass:diri}, the solution $u$ to \cref{pb:diri} is unique with $u_t \in L^2(I,H)$. 

%The uniqueness holds in more generally in $L^2(I,V)\cap H^1(I, H^{-1})$.

The problem is equivalent to:

\begin{pb}[Equivalent formulation with extension]
\label{pb:diri_ext}
\begin{align}
u_0 \in W(I,H^1_0) \\
u_0' + A u_0 = -((\bar{u}',\cdot)_H+A \bar{u}) \text{ in }H^{-1} \text{ and for a.e. } t \in (0,T) \\
u_0(0)=0
\end{align}
\end{pb}

with $\bar{u}$ any given $\bar{u}\in H^1(I,H^1_c(U))$ such that $\tr \bar{u} =f$ on $\Sigma_f$, and with $\bar{u}(0)=0$. This means that $u$ solves \cref{pb:diri} $\implies$ $u-\bar{u}$ solves \cref{pb:diri_ext}, and if $u_0(\bar{u})$ solves  \cref{pb:diri_ext}, then $\bar{u}+u_0(\bar{u})$ solves \cref{pb:diri}.

Furthermore: 

\begin{align}
\norm{u}^2_{C([0;T],H)}+\norm{u}_{L^2(I,H)}^2+ \norm{\nabla u}_{L^2(I,H)}^2 + \norm{u'}^2_{L^2(I,H)}\leq C(T)\norm{\bar{u}}_{H^1(I,V)}^2
\end{align}

with $C>1$, only dependent on $T$, smoothly, exploding for large $T$.

\end{thm}
\begin{mproof}

\underline{Extension of the boundary data}

Let $\bar{u}\in H^1(I,H^1_c(U))$ be such that $\tr \bar{u} =f$ on $\Sigma_f$, and with $\bar{u}(0)=0$. We can choose for instance $E\tilde{f}$, see \cref{prop:trace}, where $\tilde{f}=0$ on $\Sigma_m$, $\tilde{f}=f$ on $\Sigma_f$. $\tilde{f} \in H^1(I,H^{1/2}(\partial U))$, because $\Gamma_f$ and $\Gamma_m$ have positive distance (see the definition of the norm in \cite{grisvard}, page 20).  

\underline{Reformulation (first part)}

Consider the following commutative diagram, where $V = H^1_c$, $W=H^1_0$:

\[\begin{tikzcd}
	{H^1_c} &&& {(H^1_c)^*} \\
	& H & {H^*} \\
	{H^1_0} &&& {H^{-1}}
	\arrow["c", hook, from=3-1, to=1-1]
	\arrow["a", hook, from=1-1, to=2-2]
	\arrow["b"', hook, from=3-1, to=2-2]
	\arrow["{a^*}", hook, from=2-3, to=1-4]
	\arrow["r", from=2-2, to=2-3]
	\arrow["{b^*}"', hook, from=2-3, to=3-4]
	\arrow["{c^*}", hook, from=1-4, to=3-4]
\end{tikzcd}\]

Here, $a,b,c$ are the trivial injections, $r$ the Riesz isomorphism $h\mapsto(h,\cdot)_H$. 

Now $(i_W (u-\bar{u}) )'+A(u - \bar{u}) = (i_Vu)'|_{H^{-1}}-(i_V\bar{u})'|_{H^{-1}}+Au - A\bar{u} = \ind{\cref{prop:sanity}}  = (i_Vu)'|_{H^{-1}}-(i_V\bar{u}_t)|_{H^{-1}}+Au - A\bar{u} = -(i_V\bar{u}_t)|_{H^{-1}}- A\bar{u}$ if $u$ solves \cref{pb:diri}, where $\bar{u}_t$ is the weak derivative of $\bar{u}$ in the $H^1(I,V)$ sense. Call $u_0 = u-\bar{u}$. By again \cref{prop:sanity}, $u_0 \in W(I,H^1_0)$.

%That $\tr E \tilde{f}=\tilde{f}$ is easily seen for a.a. $t$, and by \cref{lemma:bochner_Hk_map}, we get $\bar{u} \in H^1(I,H^1_c(U))$. The last result could be applied since $H^{1/2}(\partial U)$ is the continuous image of a separable space, hence it is separable, and it is also Banach (again by \cite{grisvard}, page 20).
%
%
%The initial value of $\bar{u}$ is null. To see this, we know that the unique time-continuous representative $U\tilde{f}$ of $\tilde{f}$ (\cite{evans}, page 286, theorem 2, and \cref{prop:cts_repr}) satisfies $\lim_{t\rightarrow 0^+}U\tilde{f}(t)=0$, the limit being in $H^{1/2}(\partial U)$. We also know that $\bar{u}$ has a unique continuous representative $U\bar{u}$ by similar arguments, and $U\bar{u}(t) \rightarrow U\bar{u}(0)$ for $t\rightarrow 0^+$. Now, $ [U\tilde{f}] = \tilde{f} = \tr \bar{u} =[ \tr U\bar{u} ]$, where the square brackets are equivalence classes in time. Thus $U\tilde{f} =  \tr U\bar{u}$ for all $t$, and thus $\tr U\bar{u}\rightarrow 0$ for small times. Applying $E$ we get $U\bar{u}\rightarrow 0$ which is what we wanted to show.

This motivates us to consider the problem: 

\begin{align}
u_0 \in W(I,H^1_0) \\
u_0' + A u_0 = -(f_1+f_2) \text{ in }H^{-1} \text{ and for a.e. } t \in (0,T) \\
u_0(0)=0
\end{align}

Here, $f_1:=(i_V\bar{u}_t)|_{H^{-1}}=c^*a^*ra\bar{u}_t = b^*r (a\bar{u}_t) \in L^2(I,H)$.

Moreover, $A \in L(V, H^{-1})$, so, by \cref{lemma:bochner_Hk_map}, $f_2:=A\bar{u} \in H^1(I, H^{-1})$.

\underline{Existence}

By \cref{thm:par_reg} we get a solution of the above problem with $u_0' \in L^2(I, H)$.

And now, let $u:=\bar{u}+c u_0 =\bar{u}+ u_0 $. We claim it is a solution. The initial and boundary conditions are surely satisfied. We check it is in $W(I,V)$ and is satisfies the partial differential equation.

By \cref{prop:sanity}, we have both $\bar{u}, c u_0 \in W(I,V)$. The derivative of $\bar{u}$ becomes $i_V \bar{u}_t$, see \cref{prop:sanity}. Therefore $(i_V(\bar{u}+c u_0))'|_{H^1_0} = c^* (i_V(\bar{u}+c u_0))' = c^*i_V \bar{u}_t + c^*i_V(c u_0)' = b^*r (a\bar{u}_t) + i_W(u_0)'$ by \cref{prop:sanity}.

Using the pde of $u_0$, $... = b^*r (a\bar{u}_t) - Au_0 -f_1 -f_2 = -A(u_0+\bar{u})$.

\underline{Uniqueness}

For two solutions $u_1, u_2$ of $\ref{pb:diri}$ we can form $d:=u_1-u_2\in W(I,H^1_0)$ by \cref{prop:sanity}. Clearly, $d(0)=0$. Moreover, $(i_{H^1_0} d)' = \ind{\cref{prop:sanity}}=(i_V u_1)'|_{H^1_0}-(i_V u_2)'|_{H^1_0} = A(u_1-u_2)$.

By uniqueness stated in \cref{thm:well_pos_parabolic} we obtain $d=0$ in $L^2(I,H)$, so that the solution is unique and doesn't depend on the choice of the extension of the Dirichlet datum.

\underline{Reformulation (part 2)}

Therefore $u=\bar{u}+u_0$ above is the unique solution of \cref{pb:diri}. So, given any $\bar{u}\in H^1(I,H^1_c(U))$ such that $\tr \bar{u} =f$ on $\Sigma_f$, and with $\bar{u}(0)=0$, we can construct $u_0$ as above and get $u=\bar{u}+u_0$ solving \cref{pb:diri}.

Viceversa, let $u$ solve \cref{pb:diri}. Call $u_0 = u- \bar{u}$. Then, as seen above, $u_0 \in W(I,H^1_0)$ and $(i_V (u-\bar{u}) )'|_{H^{-1}}+A(u - \bar{u}) = (i_Vu)'|_{H^{-1}}-(i_V\bar{u})'|_{H^{-1}}+Au - A\bar{u} = \ind{\cref{prop:sanity}}  = (i_Vu)'|_{H^{-1}}-(i_V\bar{u}_t)|_{H^{-1}}+Au - A\bar{u} = -(i_V\bar{u}_t)|_{H^{-1}}- A\bar{u}$ if $u$ solves \cref{pb:diri}, where $\bar{u}_t$ is the weak derivative of $\bar{u}$ in the $H^1(I,V)$ sense. Call $u_0 = u-\bar{u}$. By again \cref{prop:sanity}, $(i_W (u-\bar{u}) )'+A(u - \bar{u}) = (i_Vu)'|_{H^{-1}}-(i_V\bar{u})'|_{H^{-1}}+Au - A\bar{u} = (i_Vu)'|_{H^{-1}}-(i_V\bar{u}_t)|_{H^{-1}}+Au - A\bar{u} = -(i_V\bar{u}_t)|_{H^{-1}}- A\bar{u} = -b^*r(a\bar{u}_t)-A\bar{u}$. Moreover, $u_0(0)=0$, so that $u_0$ solves \cref{pb:diri_ext}.

%\begin{itemize}
%\item $u_0 \in L^2(I,H^1_0)$
%\item $u_0' \in L^2(I,V^*)+L^2(I,H)\subseteq L^2(I,H^{-1})$
%\item $u_0(0)=0$ in $H$
%\item $u_0$ solves $u_0' + A u_0 = -((\bar{u}',\cdot)_H+\langle A \bar{u},\cdot\rangle_{H^{-1},H^1_0})$
%\end{itemize}

\underline{Regularity}

Let $u=\bar{u}+u_0$ be the unique solution, as before, of \cref{pb:diri}. From \cref{prop:sanity} we know $(i_V(\bar{u}))'=i_V(\bar{u}_t)=a^*r(a\bar{u}_t)$, and $i_V(cu_0)'=a^*r (u_0')$, for $u_0' \in L^2(I,H)$ the representative of $(i_W(u_0))'$, equivalently, the weak derivative of $u_0$ in the $H^1(I,H)$ sense. It follows that $(i_Vu)' = a^*r(a\bar{u}_t+u_0')$, proving the additional time smoothness claim.

\underline{Stability}

Let $\bar{u}\in H^1(I,H^1_c(U))$ such that $\tr \bar{u} =f$ on $\Sigma_f$, and with $\bar{u}(0)=0$. Consider $u_0$. Then, by \ref{thm:const_track}:


\begin{align*}
\norm{u_0}^2_{C([0;T],H)}+\alpha\norm{u_0}_{L^2(I,H^1_0)}^2\leq \exp(2\lambda T)\alpha^{-1}\norm{(\bar{u}',\cdot)_H+ A \bar{u}}^2_{L^2(I,H^{-1})}
\end{align*}

\begin{align*}
C\norm{u_0'}^2_{L^2(I,H)}\leq 
(1+(1+C_0)\alpha^{-1})\norm{A \bar{u}}^2_{H^1(I, H^{-1})}+\\
\norm{(\bar{u}',\cdot)_H}_{L^2(I,H)}^2+C_0\alpha^{-1}\norm{(\bar{u}',\cdot)_H}^2_{L^2(I,H^{-1})}
\end{align*}

$C_0 = \ds 2^{-1}\max(1,\lambda)\max(1,\alpha^{-1})\exp(2\lambda T)$.

We norm $H^1_0$ with the full $H^1$ norm too. Then:
\begin{align*}
\norm{(\bar{u}',\cdot)_H+ A \bar{u}}_{L^2(I,H^{-1})}\leq \\
\sup_{\norm{v}_{L^2(I,H^{1}_0)}=1}\norm{\bar{u}'}_{L^2(I,H)}\norm{v}_{L^2(I,H)}+\norm{\nabla \bar{u}}_{L^2(I,H)}\norm{\nabla v}_{L^2(I,H)}\leq \\C(\norm{\bar{u}'}_{L^2(I,H)}+\norm{\nabla \bar{u}}_{L^2(I,H)})
\end{align*}

By \cref{lemma:bochner_Hk_map}, $\norm{A \bar{u}}_{H^1(I, H^{-1})}\leq \norm{A}_{L(V,H^{-1})}\norm{\bar{u}}_{H^1(I,V)}$ (we could apply it since $H^{-1}$ is separable, as a dual of a reflexive Banach space).

Finally, $\norm{(\bar{u}',\cdot)_H}^2_{L^2(I,H^{-1})}\leq \norm{\bar{u}'}_{L^2(I,H)}^2$.

We can then say:

\begin{align*}
\norm{u_0}^2_{C([0;T],H)}+C\alpha\norm{u_0}_{L^2(I,H^1_0)}^2\leq \exp(2\lambda T)\alpha^{-1}\norm{\bar{u}}^2_{H^1(I,V)}\\
C\norm{u_0'}^2_{L^2(I,H)}\leq 
((1+(1+C_0)\alpha^{-1})\norm{A}_{L(V,H^{-1})}^2 +1 +C_0\alpha^{-1})\norm{\bar{u}}^2_{H^1(I,V)}
\end{align*}

Now, $\langle Av, v\rangle_{H^{-1}, H^1_0} + 1\cdot  \HN{v}^2 = 1\cdot \norm{v}_{H^1_0}^2$, so that $\alpha=\lambda=1$. Moreover, $\langle Au, v\rangle_{H^{-1}, H^1_0}\leq \VN{u}\norm{v}_{H^1_0}$, i.e. $\norm{A}_{L(V,H^{-1})}\leq 1$.

Therefore $\norm{u_0}^2_{C([0;T],H)}+\norm{u_0}_{L^2(I,H^1_0)}^2 + \norm{u_0'}^2_{L^2(I,H)}\leq C(T)\norm{\bar{u}}_{H^1(I,V)}^2$ with $C>1$, only dependent on $T$, smoothly, exploding for large $T$.

Now, let's analyse the norms of $\bar{u}$. Because $\bar{u}\in H^1(I,V)$, then, $\bar{u} \in C([0,T],V)\emb C([0,T],H)$, where the embedding is non-expansive by the choice of the norm of $V$. Therefore $\norm{\bar{u}}_{C([0;T],H)}\leq \norm{\bar{u}}_{C([0;T],V)}\leq (1+T)\norm{\bar{u}}_{H^1(I,V)}$. We can therefore conclude that $\norm{u}^2_{C([0;T],H)}+\norm{u}_{L^2(I,H^1_0)}^2 + \norm{u'}^2_{L^2(I,H)}\leq C(T)\norm{\bar{u}}_{H^1(I,V)}^2$ with $C>1$, only dependent on $T$, smoothly, exploding for large $T$.



\end{mproof}

\subsection{Inhomogeneous Neumann-Dirichlet problem}

We make the following assumption.

\begin{ass}[Assumptions for \cref{pb:diri}]
\label{ass:neu}
We keep \cref{ass:diri} (apart from the Dirichlet datum). We consired $g \in H^1(I, L^2(\Gamma_f))$, $g(0)=0$.
\end{ass}

Again, call $H=L^2(U)$, $V=\{ v \in H^1(U), \tr u = 0 \text{ on } \Gamma_m\}=:H^1_c$. $H,V$ induce a Gelfand triple as seen before. 


The problem under consideration is:

\begin{pb}[Inhomogeneous heat equation, Neumann conditions]
\label{pb:neu}
\begin{align}
u_t - \Delta u = 0 \text{ in } (0,T)\times U\\
\partial_\nu u(\Sigma_f)=g\\
u(\Sigma_m)=0\\
u(0)=0
\end{align}

By this we mean:

\begin{align}
u \in W(I,H^1_c) \\
u_t + A u = G \text{ in } V^* \text{ and for a.e. } t \in (0,T) \\
u(0)=0
\end{align}

where $\langle G(t), v \rangle_{V^*,V}:=\int_{\Gamma_f} g(t)\tr v d\sigma$, $\sigma$ the $1$-codimensional Hausdorff measure, and $A$ was introduced before in $L(V,H^{-1})$.

\end{pb}

By \cref{lemma:bochner_Hk_map}, $G \in H^1(I,V^*)$. In fact, define $T: L^2(\Sigma_f)\rightarrow V^*$ by $\langle Tg,v \rangle_{V^*,V}:=\int_{\Gamma_f} g\tr v d\sigma$. Then, $\langle Tg,v \rangle_{V^*,V} \leq \norm{g}_{L^2(\Gamma_f)} \VN{v}$ by trace theory. Now, $G(t)=Tg(t)$.

Moreover, $\langle A v, v \rangle_{V^*,V}+ 1 \cdot \HN{v} = 1\cdot \norm{V}$, so that we can immediately conclude:

\begin{thm}[Well posedness and regularity for \cref{pb:neu}]
\label{prop:wp_neu}
Given \cref{ass:neu}, the solution $u$ to \cref{pb:neu} is unique with $u_t \in L^2(I,H)$.

Furthermore: 

\begin{align}
\norm{u}^2_{C([0;T],H)}+\norm{u}_{L^2(I,H)}^2+ \norm{\nabla u}_{L^2(I,H)}^2 + \norm{u'}^2_{L^2(I,H)}\leq C(T)\norm{g}_{H^1(I,L^2(\Gamma_f))}^2
\end{align}

with $C>1$, only dependent on $T$, smoothly, exploding for large $T$.
\end{thm}
\begin{mproof}

It is an application of \cref{thm:well_pos_parabolic}, \cref{thm:reg_time} and \cref{thm:const_track}.
\end{mproof}

\section{Reformulation of parabolic equations}

We just saw that the two parabolic equations of interest can be recasted into the problem of finding $u\in W(I,V)$, $u(0)=0$, $u_t+Au=f$ for a.e. $t$ in $V^*$, with notation from preceding sections.

In particular, $f \in L^2(I, V^*)$ and so is $Au$ (because $A\in L(V,V^*)$, and by \ref{lemma:bochner_Hk_map}).

Call then $E(u):=u_t+Au-f \in L^2(I,V^*)$ and $W_0(I,V)$ the $W(I,V)$ functions with zero initial value. Then, the differential equation reads $\langle E(u)(t),v\rangle_{V^*,V}=0$ for all $v\in V$, for a.a. $t$, equivalently, $E(u)=0$ for a.a. $t$. Thus, we are interested in the abstract problem:

\begin{pb}[Even more abstract parabolic equation]
\label{pb:more_abstr_par}
Given a function $E: W(I,V)\rightarrow L^2(I,V^*)$, find $u\in W_0(I,V)$, such that $E(u)=0$ for a.a. $t$.
\end{pb}
 
We can view $L^2(I,V^*)\cong L^2(I,V)^*$.

Hence $\langle E(u), v\rangle_{L^2(I,V)^*, L^2(I,V)}=\int_I \langle E(u)(t),v(t) \rangle_{V^*,V} dt$ (see \cite{hinze}, theorem 1.31 at page 39).

\color{black}


We are now ready to restric both state and adjoint space.

\begin{defn}[$Q(I,V)$]
We define $Q(I,V)=H^{1,1}=L^2(I,V)\cap H^1(I,H)$, with the norm $\norm{v}_Q^2=\norm{v}_{L^2(I,V)}^2 + \norm{v_t}_{L^2(I,H)}^2$.
\end{defn}

\begin{prop}[Properties of $Q$]
\label{prop:Q}
There holds:
\begin{itemize}
	\item $Q=Q(I,V)$ is Hilbert with $(v,w)_{L^2(I,V)} + (v_t,w_t)_{L^2(I,H)}$ 
	\item $Q(I,V)$ is dense in $L^2(I,V)$
	\item $Q(I,V)\emb C([0,T],H)$
	\item $Q_0(I,V)$ is dense in $L^2(I,V)$, $Q_0(I,V)$ the space of $Q(I,V)$ function with zero initial value
	\item $Q(I,V) = W(I,V)\cap H^1(I,H)$, $Q_0(I,V) =  W_0(I,V)\cap H^1(I,H)$ as sets. There holds that the $W(I,V)$ derivative is represented by the $H^1(I,H)$ derivative and $\langle u', v\rangle_{V^*,V} = (u',v)_H$, with the suitable interpretations of $u'$ (on the left, we have $i_V(u)'$, $i_V$ the Gelfand triple embedding; on the right we have $u$, seen in $H$, and then weakly differentiated in the $H^1(I,H)$ sense)
	\item integration by parts in time holds: $\int_I(v_t,w)_H = -\int_I(w_t,v)_H +(v(T),w(T))_H-(v(0),w(0))_H$
	\item if $q_n$ is bounded in $Q(I,V)$, then there exists a weakly convergent subsequence $q_k$ such that $q_k\weakc q$ in $L^2(I,H)$, $\partial_i q_k\weakc \partial_i q$ in $L^2(I,H)$ and $q_k'\weakc q'$ in $L^2(I,H)$
\end{itemize}
\end{prop}
\begin{mproof}

\underline{Completeness}

We have the inclusions $L^2(I,H)\subseteq L^2(I,V)\cap H^1(I,H)\subseteq H^1(I,V)$.

If $q_n$ is Cauchy in $Q$, then it is Cauchy in the individual norms of $ L^2(I,V), H^1(I,H)$, so that $q_n$ convergens to two limits, one in $L^2(I,V)$ and one in $H^1(I,H)$. The convergence is common in $L^2(I,H)$, which implies that the two limits coincide at $q \in Q(I,V)$. The convergence in $Q(I,V)$ of $q_n$ to $Q$ follows from the individual convergences of $q_n, \nabla q_n, q_{nt}$ in $ L^2(I,H), L^2(I,H),L^2(I,H)$.

\underline{Density}

We have $C_c^\infty(I,V) \subseteq Q(I,V) \subseteq L^2(I,V)$. The first inclusion holds because of \cref{prop:weak_class}, so that $C_c^\infty(I,V)\subseteq H^1(I,V)$. Moreover $H^1(I,V)\subseteq  Q(I,V) $ trivially, where the $H^1(I,H)$ derivative is the $H^1(I,V)$ derivative. $C_c^\infty(I,V)$ is dense in $ L^2(I,V)$ by \cite{hinze}, page 39, lemma 1.9.

\underline{Continuity}

Follows from the embedding $H^1(I,H)\emb C([0,T],H)$, as seen in \cite{evans}, theorem 2 of page 286.

\underline{More density}

We can therefore speak of initial values. In particular,  $C_c^\infty(I,V) \subseteq Q_0(I,V)\subseteq L^2(I,V)$, and as before, the density result follows.

\underline{Relationship with $W(I,V)$}

Consider the chain:

\[\begin{tikzcd}
	V & H & {H^*} & {V^*}
	\arrow["a", hook, from=1-1, to=1-2]
	\arrow["r", from=1-2, to=1-3]
	\arrow["{a^*}", hook, from=1-3, to=1-4]
\end{tikzcd}\]

where $a$ is the trivial embedding and $r$ the Riesz isomorphism.

We claim that for $v \in Q(I,V)$, then $(a^*ra v)' = a^*r (av)'$, where $av \in H^1(I,H)$. In fact, for $\phi \in C^\infty_c(I)$, we get $\int_I a^*ra v \phi' = \ind{\ref{prop:bochner_bound}} = a^*r\int_I av\phi' = -a^*r\int_I(av)'\phi =-\int_I a^*r(av)' \phi$.

Now, let $u \in W(I,V)$, with $(a^*ra u)' = a^*r h$, $h \in L^2(I,H)$. Then $ a^*r \int_I h \phi = \ind{\ref{prop:bochner_bound}} = \int_I a^*r h \phi  = \int_I (a^*ra u)' \phi =  a^*r (-\int au \phi')$.

We know that $a^*$ is injective and so is $r$, so that $ \int_I h \phi  = -\int_I au \phi'$ as we wanted.

\underline{Integration by parts}

We note that for $v,w \in Q(I,V)\subseteq W(I,V)$, we have $\int_I \langle (a^*ra v)', w\rangle_{V^*,V} = \int_I \langle a^*r(a v)', w\rangle_{V^*,V} = \int_I((a v)', aw)_H$. We can now apply theorem 3.11 at page 148 of \cite{trol} to conclude that  $\int_I(v_t,w)_H = -\int_I((aw)_t,av)_H +((av)(T),(aw)(T))_H-((av)(0),(aw)(0))_H$

\underline{Weak convergence}

At first we note that $\partial_i, \partial_t$ are linear bounded operators from $Q(I,V)$ to $L^2(I,H)$.

Remember that in any case, $V$ is a closed subspace of $H^1$. Then, $\partial_i : V\rightarrow H$ is linear and bounded, because $V$ is bounded by the full $H^1$ norm, as we declared already.

Therefore, by \cref{lemma:bochner_Hk_map}, $\partial_i$ extends to a linear bounded map from $L^2(I,V)$ to $L^2(I,H)$, therefore, to a linear bounded map on $Q(I,V)	$, in the sense of:

\[\begin{tikzcd}
	{Q(I,V)} & {L^2(I,V)} & {L^2(I,H)}
	\arrow["i", hook, from=1-1, to=1-2]
	\arrow["{\partial_i}", from=1-2, to=1-3]
\end{tikzcd}\]

Because $q_n$ is bounded in the Hilbert space $Q(I,V)$, it has a weakly convergent subsequence $q_k\weakc q \in Q(I,V)$. Therefore, $\partial_i (i(q_k))\weakc \partial_i (i(q))$ in $L^2(I,H)$. By the Hilbert space property of $L^2(I,H)$ we conclude that $(\partial_i q_k,p)_{L^2(I,H)}\rightarrow (\partial_i q,p)_{L^2(I,H)}$ for all $p \in L^2(I,H)$.

For the time derivative we can draw a similar diagram:

\[\begin{tikzcd}
	{Q(I,V)} & {H^1(I,H)} & {L^2(I,H)}
	\arrow["j", hook, from=1-1, to=1-2]
	\arrow["{\partial_t}", from=1-2, to=1-3]
\end{tikzcd}\]

We therefore obtain $(\partial_t q_k,p)_{L^2(I,H)}\rightarrow (\partial_t q,p)_{L^2(I,H)}$ for all $p \in L^2(I,H)$.

The convergence $(q_k,p)_{L^2(I,H)}\rightarrow (q,p)_{L^2(I,H)}$ for all $p \in L^2(I,H)$ follows analogously.

\end{mproof}

We can therefore restrict the testing space.

\begin{prop}[Equivalent testing]
\label{prop:eq_test}
Let $E: W(I,V)\rightarrow L^2(I,V^*)$, and $u\in W_0(I,V)$.

Then:

\begin{align*}
E(u)=0 \\
\iff \\
\langle E(u), v\rangle_{L^2(I,V)^*, L^2(I,V)}=0 \quad \forall v \in L^2(I,V)\\
\iff \\
\langle E(u), v\rangle_{L^2(I,V)^*, L^2(I,V)}=0 \quad \forall v \in W^0(I,V)\\
\iff \\
\langle E(u), v\rangle_{L^2(I,V)^*, L^2(I,V)}=0 \quad \forall v \in Q^0(I,V)
\end{align*}

\end{prop}


We have also seen that with smoothness assumption on data (\cref{ass:diri} and \cref{ass:neu}) we obtain that the solutions of \cref{pb:diri}, \cref{pb:neu} have $Q_0(I,V)$ smoothness. 

We can therefore formulate the two partial differential equations directly on $Q_0(I,V)$ as follows.

\begin{align*}
w \in W_0(I, H^1_c),\bar{u}+v_0 \in W_0(I,H^1_c), v_0 \in W_0(I,H^1_0)\\
w' + A w = (g,\cdot)_{L^2(\Gamma_f)} \text{ in }H^{1*}_c \text{ and for a.e. } t \in (0,T) \\
v_0' + A v_0 = -((\bar{u}',\cdot)_H+A \bar{u}) \text{ in }H^{-1} \text{ and for a.e. } t \in (0,T) 
\end{align*}

with $\bar{u}$ any given $\bar{u}\in H^1(I,H^1_c)$ such that $\tr \bar{u} =f$ on $\Sigma_f$, and with $\bar{u}(0)=0$.

We are working under \ref{ass:diri}, \ref{ass:neu}.

Thanks to \cref{prop:eq_form}, this is equivalent to:

\begin{align*}
w \in W_0(I, H^1_c), \bar{u}+v_0 \in W_0(I,H^1_c), v_0 \in W_0(I,H^1_0) \\
\int_I \langle w' , q\rangle_{H^{1*}_c,H^1_c}+ (\nabla w, \nabla q)_H = \int_I(g,\tr q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, H^1_c) \\
\int_I \langle v_0',p\rangle_{H^{-1},H^1_0} + (\nabla v_0, \nabla p)_H= -\int_I(\bar{u}',p)_H+(\nabla \bar{u}, \nabla p)_H, \quad \forall p \in Q^0(I, H^1_0) 
\end{align*}

By regularity, see \cref{prop:diri_wp}, \cref{prop:wp_neu}, and thanks to \cref{prop:Q} this implies:
\begin{align*}
w \in Q_0(I, H^1_c), \bar{u}+v_0 \in Q_0(I,H^1_c), v_0 \in Q_0(I,H^1_0) \\
\int_I ( w' , q)_H+ (\nabla w, \nabla q)_H = \int_I(g,\tr q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, H^1_c) \\
\int_I (v_0',p)_H + (\nabla v_0, \nabla p)_H= -\int_I(\bar{u}',p)_H+(\nabla \bar{u}, \nabla p)_H, \quad \forall p \in Q^0(I, H^1_0) 
\end{align*}

where now the derivatives are in the $H^1(I,H)$ sense. Indeed we have proved in \cref{prop:Q} that $u \in W(I,V)$ with $L^2(I,H)$ derivative, is actually $Q(I,V)$, with weak derivative in the $H^1(I,H)$ sense equal to the $L^2(I,H)$ representative of $u'$ in the $W(I,V)$ sense. There, we also proved the representation of the duality bracket.

Conversely, a solution $w \in Q_0(I, H^1_c), \bar{u}+v_0 \in Q_0(I,H^1_c), v_0 \in Q_0(I,H^1_0) $ to the above problem satisfies $w \in W_0(I, H^1_c), \bar{u}+v_0 \in W_0(I,H^1_c), v_0 \in W_0(I,H^1_0)$, see \cref{prop:Q}, and the proof of \cref{prop:diri_wp} . And by \cref{prop:Q} we can get to:

\begin{align*}
w \in W_0(I, H^1_c), \bar{u}+v_0 \in W_0(I,H^1_c), v_0 \in W_0(I,H^1_0) \\
\int_I \langle w' , q\rangle_{H^{1*}_c,H^1_c}+ (\nabla w, \nabla q)_H = \int_I(g,\tr q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, H^1_c) \\
\int_I \langle v_0',p\rangle_{H^{-1},H^1_0} + (\nabla v_0, \nabla p)_H= -\int_I(\bar{u}',p)_H+(\nabla \bar{u}, \nabla p)_H, \quad \forall p \in Q^0(I, H^1_0) 
\end{align*}

By \cref{prop:eq_test} we obtain back:

\begin{align*}
w \in W_0(I, H^1_c),\bar{u}+v_0 \in W_0(I,H^1_c), v_0 \in W_0(I,H^1_0)\\
w' + A w = (g,\cdot)_{L^2(\Gamma_f)} \text{ in }H^{1*}_c \text{ and for a.e. } t \in (0,T) \\
v_0' + A v_0 = -((\bar{u}',\cdot)_H+A \bar{u}) \text{ in }H^{-1} \text{ and for a.e. } t \in (0,T) 
\end{align*}

Therefore:

\begin{prop}[Equivalent formulation]
\label{prop:eq_form}

Under \cref{ass:diri}, \cref{ass:neu}, \cref{pb:diri}, \cref{pb:neu} can be equivalently formulated as:

\begin{align*}
w \in Q_0(I, H^1_c), \bar{u}+v_0 \in Q_0(I,H^1_c), v_0 \in Q_0(I,H^1_0) \\
\int_I ( w' , q)_H+ (\nabla w, \nabla q)_H = \int_I(g,\tr q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, H^1_c) \\
\int_I (v_0',p)_H + (\nabla v_0, \nabla p)_H= -\int_I(\bar{u}',p)_H+(\nabla \bar{u}, \nabla p)_H, \quad \forall p \in Q^0(I, H^1_0) 
\end{align*}

Existence, uniqueness and stability proved already in  \cref{prop:diri_wp}, \cref{prop:wp_neu} carry over to this new formulation.

\end{prop}

\chapter{Domains transformations}

\section{Transforming domains}

\begin{prop}[Measurability of composition]
\label{prop:circ_wd}

Define $\pazocal{M}:=\{\tau: \mR^n \rightarrow \mR^n \text{ Lebesgue measurable } \}/\sim$, the quotient being the almost everywhere equal relation (according to the Lebesgue measure).

Consider also $U$ from $\pazocal M_c :=\{\tau: \mR^n \rightarrow \mR^n \text{ continuous } \}/\sim$, the application "unique continuous representative", and $\pazocal{M}_{BL} :=\{\tau: \mR^n \rightarrow \mR^n \text{ Lipschitz homeomorphism} \}/\sim \subseteq \pazocal{M}_c$.

We can then define $\circ:  \pazocal{M} \times \pazocal{M}_{BL}, \pazocal{M}_c \times \pazocal{M} \rightarrow \pazocal{M}$ by, respectively, $[f]\circ g := [f\circ U(g)], f \circ [g]:= [U(f)\circ g]$. These definitions are well posed.

\end{prop}
\begin{mproof}

\underline{$\pazocal{M}_c$}

$U(f)$ is Borel measurable, so the preimage of a Borel set is Borel measurable, and $g$ is Lebesgue measurable, so his preimage of such Borel set is Lebesgue measurable (\textcolor{red}{see \href{https://math.stackexchange.com/questions/283443/is-composition-of-measurable-functions-measurable}{here} for the different notions of measurability}).

This shows that $U(f)\circ g$ is measurable.

To complete the well posedness, if $h=g$ a.e., then clearly $U(f)\circ g= U(f)\circ  h$ a.e..

\underline{$\pazocal{M}_{BL}$}

Consider $f\circ U(g)$. We need to prove it is measurable and that is only depends on $[f]$.

For the measurability: the preimage of a Borel set, by $f$, is Lebesgue measurable $L$. $U(g)$ has a Lipschitz inverse, which will map this set to a Lebesgue set. Indeed, $L = B \cup N$, with $B$ Borel and $N$ Lebesgue measurable and null (\textcolor{red}{see \href{https://math.stackexchange.com/questions/3420145/lebesgue-measurable-set-union-of-borel-set-and-null-set}{here}}). Image and unions commute, so, $U(g)^{-1}(L) = U(g)^{-1}(B) \cup U(g)^{-1}(N)$. The first set is Lebesgue measurable by measurability of $U(g)$, the second one is null, because Lipschitz maps map null sets into null sets, see 9.54 at page 271 of \cite{leoni}. 

%Suppose $f,g \in [f]$. Then $f=g$ everywhere but on the null set $E$. Because $\psi \in \cT^1$ we know that $U(\psi)$ is a Lipschitz homeomorphism, so that $U(\psi)^{-1}(E)$ has zero measure by the lemma of Vitali. For the same reason, the composition is measurable, see \cite{murat}, remarque 2.2, page II-7.

\end{mproof}


Throughout, $D$ is a bounded Lipschitz domain. We define as in \cite{murat} the following spaces of transformations:

\begin{defn}[Spaces of transformations]
We define:
\begin{itemize}	
	\item $\cV^k=\{\tau \in \pazocal{M}, \tau-\id \in W^{k,\infty}(\mR^n,\mR^n)\}$, $k\geq 1$
%	\item $\circ: \cV^1 \times \cV^1 \rightarrow \cV^1$ and $\circ:W^{1,\infty}(\mR^n,\mR^n) \times \cV^1 \rightarrow W^{1,\infty}(\mR^n,\mR^n)$ by $\tau_1\circ\tau_2 = [U(\tau_1)\circ \tau]$, for any $[\tau]=\tau_2$, $[]$ being an equivalence class according to $\sim$.
	\item $\cT^k=\{\tau \in \cV^k \text{ with an } \eta \in \cV^k, \tau \circ \eta = \eta \circ \tau = \id\}$. Any such $\eta$ is unique, we denote it by $\tau^{-1}$ and we have that $U(\tau)$ is a Lipschitz homeomorphism with $U(\tau^{-1})=U(\tau)^{-1}$
\end{itemize} 
\end{defn}

\begin{obs}[A technicality]

Technically, in the original definition of \cite{murat}, $\tau$ need not to be a continuous function, although this is suggested e.g. in remarque 2.1 at page II-4. 

Going to equivalence classes of $\tau$ makes the identification with continuous functions more precise, as we now show.

\underline{One implication}

Let $\tau: \mR^n\rightarrow\mR^n$ with $[\tau-\id] \in W^{k,\infty}$. Then $\tau$ is equal a.e. to a (Lebesgue) measurable function, hence also (Lebesgue) measurable, and thus $[\tau] \in \cV^k$ as we have defined it (\textcolor{red}{this is proved \href{https://heil.math.gatech.edu/6337/spring11/section3.4.pdf}{here}; note that $\{g\neq f\}$ is measurable as the Lebesgue measure is complete}).

Now, suppose $\tau$ is a bijection, and $[\tau^{-1}-\id] \in W^{k,\infty}$ too. Then $\tau = \id + g = G, \tau^{-1} = \id + h = H$ almost everywhere. Here, $G,H$ are at least Lipschitz.
But then $\tau \circ H = \id $ a.e., and since $H$ is Lipschitz, we can conclude also $G\circ H = \id$ a.e., so, everywhere. With a symmetric reasoning, we are lead to $G=H^{-1}$, so that $G$ is bi-Lipschitz.

Thus, $[\tau]\circ [\tau^{-1}]:=[U(\tau)\circ U(\tau^{-1})] = [G\circ G^{-1}] = \id$ and an analogous reasoning leads to $[\tau] \in \cT^k$ as we have defined it.

\underline{The other implication}

It is immediate for $\cV^k$ and for $\cT^k$, in the equivalence class of $\tau \in \cT^k$ there is a unique $U(\tau)$ at least bi-Lipschitz, hence invertible, with $[U(\tau)]=\tau$.

This shows that:

\begin{enumerate}
\item $\{\tau: \mR^n\rightarrow\mR^n$ with $[\tau-\id] \in W^{k,\infty}\} / \sim = \cV^k$
\item $\{\tau: \mR^n\rightarrow\mR^n$ bijection with $[\tau^{\pm 1}-\id] \in W^{k,\infty}\}/\sim = \cT^k$
\end{enumerate}

\end{obs}

We need to check the well-posedness of $\circ$.

\begin{prop}
\label{prop:circ_wd_V}
$\circ: \cV^1 \times \cV^1 \rightarrow \cV^1$ and $\circ:W^{1,\infty}(\mR^n,\mR^n) \times \cV^1 \rightarrow W^{1,\infty}(\mR^n,\mR^n)$ are well defined.
\end{prop}
\begin{mproof}

We start by $\circ:W^{1,\infty}(\mR^n,\mR^n) \times \cV^1 \rightarrow \cV^1$. We have $\te\circ \tau =[ U(\te)\circ U(\tau)]$ for instance (see \cref{prop:circ_wd}); the latter is a bounded Lipschitz map, so it remains in $W^{1,\infty}$.

For the second claim, just write $\eta \circ \tau -\id = (\eta - \id)\circ \tau + \tau -\id$ and use the first part. 

\end{mproof}


\begin{prop}[Chain rule for $k=1$]
\label{prop:chain}
Let $f \in W^{1,\infty}(\mR^n,\mR^n)$ or $\cV^1$, together with $\psi \in \cT^1$.  Then:

\begin{itemize}

\item $f \circ \psi$ has essentially bounded weak derivatives, and $D(f \circ \psi) = Df \circ \psi D\psi$. The equality holds a.e. also for the classical derivatives.

\item  $D(\psi^{-1}) = (D\psi)^{-1} \circ \psi^{-1}$, where $(D(\psi^{-1}))^{-1}:=[(DU(\psi^{-1}))^{-1}]$, the representative being a.e. invertible. The equality holds a.e. also for the classical derivatives.

\item $|\det(D\psi)|$ is an essentially bounded measurable function with $|\det(D\psi)|\geq \delta>0$ a.e.. 
\end{itemize} 

\end{prop}
\begin{mproof}

\underline{Weak derivatives}

We notice that $f \circ \phi$ has a unique Lipschitz representative, that is $U(f)\circ U(\phi)$. The desired formula follows as in \cite{murat}, lemme 2.1 at page II-6, for the classical derivatives, because Lipschitz function are almost everywhere differentiable by the Rademacher theorem (\tred{see \href{https://abel.math.harvard.edu/archive/212b_spring_05/handouts/Rademacher.pdf}{here}}). The chain rule holds for functions differentiable only at one point. 

% (or from \cite{ziemer}, page 53, theorem 2.2.2 in the case of left composition by $ W^{1,\infty}(\mR^n,\mR^n)$ vector fields) (	\tred{this needs the Rademacher theorem, see \href{https://abel.math.harvard.edu/archive/212b_spring_05/handouts/Rademacher.pdf}{here}. The set of differentiability is measurable, see \cite{leoni}, 9.17}).

Now, to identify the weak derivatives:

\begin{itemize}
	\item $U(f)$ is Lipschitz, so that $DU(f)$, the classical derivative, is also the weak derivative $Df$ (note that $f$ need not to be essentially bounded to state this). The latter is a measurable function, as a.e. limit of difference quotients.
%	\item $DU(f)\circ U(\psi)$,  as pointed out in \cite{murat}, remarque 2.2, page II-7, is measurable. It is also essentially bounded.
	\item $DU(f)\circ U(\psi)$, is measurable, see \cref{prop:circ_wd}. It is also essentially bounded.
	\item By \cref{prop:circ_wd} we observe that $DU(f)\circ U(\psi)$ represents $Df \circ \psi$
	\item $D\psi = [DU(\psi)]$ as seen above
	\item the product of equivalence classes is always defined as the product of their representatives
\end{itemize}

Therefore $ Df \circ \psi D\psi = [DU(f)\circ U(\psi) DU(\psi)]$.

And now, because $f \circ \phi$ is Lipschitz, it has weak derivatives, $D(f \circ \phi)$, equal to the classical derivatives $DU(f\circ \phi) = D (U(f)\circ U(\psi)) = DU(f)\circ U(\psi) DU(\psi)$, where the last equality holds a.e., as mentioned at the beginning of the proof.

This let us conclude the first claim.

\underline{Inverse Jacobian}

For the second one, put $f = \psi^{-1}$. Then, for the classical derivatives, $I = DU(\psi)\circ U(\psi)^{-1} DU(\psi^{-1})$ a.e., so that both $DU(\psi)\circ U(\psi)^{-1}, DU((\psi)^{-1})$ are invertible as matrices, a.e.. 

\underline{Determinant}

We have defined $|\det(D\psi)|:=[|\det DU(\psi)|]$, see \cref{prop:circ_wd}. The claim follows as in lemme 4.2, pag. IV-7 of \cite{murat}, and because $\det$ is a polynomial of essentially bounded functions.

\end{mproof}

We go on to define the space of admissible transformations.

\begin{defn}[Admissible transformations]
\label{def:adm}
We define $\Theta:=\{\theta \in W^{1,\infty}(\mR^n,\mR^n) \text{ with } \theta=0 \text{ on } \mR^n \setminus D\}$, a Banach subspace of $ W^{1,\infty}(\mR^n,\mR^n)$.


We also define $\cT:=\{\tau \in \cT^1, \tau^{\pm 1}|_{\mR^n\setminus D}=\id\}$. 

\end{defn}

\begin{prop}[Some group properties of $\cT$]
\label{prop:group}
Let $\eta, \tau \in \cT, \te \in \Te$. Then:

\begin{itemize}
	\item $\eta \circ \tau \in \cT$
	\item $\te \circ \tau \in \Te$
	\item $\id$ is the neutral element
	\item $\eta^{-1} \in \cT$
\end{itemize}

\end{prop}
\begin{mproof}

%\underline{Stability under composition (regularity)}
%
%We start by showing that $\tau \circ \eta |_D \in W^{2,\infty}$.
%
%%By $\tau \in \cV^1$, we sure have that $\tau \circ \eta \in \cV^1$ by \cref{prop:circ_wd_V}. So, 
%
%$U(\tau)\circ U(\eta)$, is a bounded Lipschitz function. Morevoer $ D(U(\tau)\circ U(\eta)) = D(U(\tau))\circ U(\eta) DU(\eta) $ everywhere in $D$, because $\eta, \tau$ happen to be in $W^{2,\infty}(D)$, so that $U(\eta), U(\tau) \in C^{1,1}(D)$, see \cref{prop:lip}.
%
%This is a product of a bounded Lipschitz function and a bounded Lipschitz function, so it is also bounded Lipschitz. Therefore, $D(U(\tau)\circ U(\eta))\in C^{0,1}(D)$ and thus $U(\tau)\circ U(\eta) \in C^{1,1}_B(D)$, so that by $\ref{prop:lipk}$, $[U(\tau)\circ U(\eta)|_D] = \tau \circ \eta|_D \in W^{2,\infty}(D)$.
%
%This same proof shows that for $\te \in \Te$, $\tau \in \cT$, $\te \circ \tau \in \Te$, because $\te \circ \tau$ was already a $W^{1,\infty}$ function by \cref{prop:circ_wd}, and because $\tau$ fixes $\mR^n \setminus D$.

\underline{Stability under inversion}

It is trivial, because the definition of $\cT$ is symmetric with respect to inversion.

\underline{Stability under composition ($\cT^1$)}

$\eta \circ \tau$ is surely in $\cV^1$ by \cref{prop:circ_wd}. Now, by the above point, $\tau^{-1} \circ \eta^{-1}$ is in $\cV^1$ too, and the composition yields: $(\eta \circ \tau)\circ (\tau^{-1} \circ \eta^{-1}) = [U(\eta)\circ U(\tau)]\circ [(U\tau)^{-1} \circ (U\eta)^{-1}] = \id$.

\end{mproof}

\begin{prop}[Small perturbations of $\cT$]
\label{prop:ptb_id}
Let $\te \in \Te$ with small enough $\norm{\te}_{W^{1,\infty}(\mR^n;\mR^n)}$. Then, $\id+\te\in \cT$.

Let $\delta \te \in \Te$ with small enough $\norm{\delta\te}_{W^{1,\infty}(\mR^n;\mR^n)}$, and $\tau \in \cT$. Then, $\tau + \delta \te\in \cT$.

\end{prop}
\begin{mproof}

\underline{Perturbation of identity}

We only need to check the properties of the inverse map.

$U(\tau)^{-1}$ exists and is Lipschitz, see the proof of lemme 2.4 of \cite{murat}, page II-16. We can therefore define $\tau^{-1}$ and we obtain that it is $\cV^1$. So, $\tau \in \cT^1$. The fact that $\tau = \id$ outside of $D$ automatically implies $\tau^{-1}=\id$ outside of $D$, which can be seen more precisely by going to the smooth representatives of $\tau, \tau^{-1}$.

%Moreover, $D\tau$ is a function in $W^{1,\infty}(D;\mR^{n\times n})$. Because of the Banach algebra properties listed in proposition 2.1 of \cite{murat}, page II-5 (which apply to $D$, just by extending $W^{1,\infty}(D)$ functions to $0$), the theorem of Neumann series holds (for $D\te$!), and by the assumptions on the norm of $\te$ we observe that $D\te$ has a small norm $W^{1,\infty}(D;\mR^{n\times n})$: by $D\tau   = I + D\te$ , we conclude that there is $ S \in W^{1,\infty}(D;\mR^{n\times n})$ with $SD\tau = D\tau S = I$, in the sense of matrix multiplication.
%
%This shows $(D\tau)^{-1} \in W^{1,\infty}(D;\mR^{n\times n})$.
%
%Because $\tau \in \cT^1$, we have from \cref{prop:chain}, that $D\tau^{-1} = (D\tau)^{-1}\circ \tau^{-1}$, so that $D\tau^{-1} $ is the composition of a $W^{1,\infty}(D;\mR^{n\times n})$ by a $\cT$ function. This implies that $\tau^{-1}$ is $W^{2,\infty}(D)$, because $\tau^{-1}$ maps $D$ into $D$.

\underline{Perturbation, not of identity}

We solve the equation $\tau + \delta \te =\eta \circ \tau$, i.e., we define $\eta:=\id + \delta \te \circ \tau^{-1}$. Because $\tau^{-1} \in \cT$ and $\delta \te \in \Te$ we observe that $\delta \te \circ \tau^{-1} \in \Te $, thanks to \cref{prop:group}.

We only need to prove that $\delta \te \circ \tau^{-1}$ is small, and then use the first part. 

But by \cref{prop:chain} this follows immediately. One can alternatively apply point i) of lemme 2.2, \cite{murat}.

\end{mproof}

\begin{thm}{Small perturbations of identity, Lipschitz property}
\label{thm:ptb_id_lip}
Let $U\cc D$ be Lipschitz bounded. There exists $0<C(U)<1$ such that, for $\tau \in W^{1,\infty}(\mR^n;\mR^n)$ and $\norm{\tau - \id}_{W^{1,\infty}(\mR^n;\mR^n)}\leq C(U)$, then $T(U)$ is also bounded Lipschitz, where $T$ is $U(\tau)$, the unique Lipschitz continuous representative of $\tau$ (see \cref{prop:lip}).

This result can be applied to, e.g., $\tau \in \cT$ which is a small perturbation of identity in the $W^{1,\infty}$ topology.
\end{thm}

\begin{mproof}
It is done in \cite{bello}, lemma 3, page 629.
\end{mproof}

%\begin{prop}[Gateaux differentiability]
%Consider $J:\cT \rightarrow E$ for $E$ some Banach space.
%
%Let $\tau \in \cT$. Then:
%
%$$ \forall \delta\te \in \Te \text{ exists } \lim_{t\rightarrow 0}\frac{J(\tau + t \delta\te)-J(\tau)}{t} \iff  \forall \delta\te \in \Te  \text{ exists }\lim_{t\rightarrow 0}\frac{J((\id +t \delta \te)\circ \tau)-J(\tau)}{t}$$
%
%In case of existence, we have:
%
%$$ \lim_{t\rightarrow 0}\frac{J((\id +t \delta \te)\circ \tau)-J(\tau)}{t} = \lim_{t\rightarrow 0}\frac{J(\tau + t \delta \te\circ \tau)-J(\tau)}{t}$$
%
%Note that $\id + t \delta \te \in \cT$ for small $t$.
%
%\end{prop}
%
%\begin{mproof}
%
%It suffices to show that $\Te \circ \tau = \Te$.
%
%In fact, $\delta \te \circ \tau \in \Te$ for $\te \in \Te$, as we verified in \cref{prop:group}. Using the same result, $\tau^{-1} \in \cT$, $(\delta \te \circ \tau ) \circ \tau^{-1}  \in \Te$ and $(\delta \te \circ \tau ) \circ \tau^{-1} = [U(\delta \te)\circ U(\tau)]\circ[U(\tau)^{-1}] = [(U(\delta \te)\circ U(\tau))\circ(U(\tau)^{-1})]=\delta \te$.
%
%\end{mproof}
%

\section{Transforming Sobolev spaces}

\begin{thm}[Change of variables]
\label{thm:change}

Let $U$ be open and $T = U(\tau)$ for $\tau \in \cT^1$, and let $p \in [ 1,\infty]$. Then:

\begin{enumerate}
	\item $f \in L^p(T(U)) \iff f\circ T \in L^p(U)$ and there holds, for $f \in L^p(T(U))$:
	$$ \norm{f}_{L^p(T(Q))}\leq \left ( \norm{\det DT}_{L^\infty(\mR^n)}\right)^{1/p} \norm{f\circ T}_{L^p(Q)}$$
	\item $f \in W^{1,p}(T(U)) \iff f\circ T \in W^{1,p}(U)$ and there holds, for $f\in W^{1,p}(T(U))$:
	$$Df \circ T = (Df)^{-t}D(f\circ T)$$
	$$ \norm{Df}_{L^p(T(Q);\mR^n)}\leq \left ( \norm{\det DT}_{L^\infty(\mR^n)}\right)^{1/p} \norm{(DT)^{-1}}_{L^\infty(\mR^n;\mR^{n\times n})}\norm{D(f\circ T)}_{L^p(Q;\mR^n)}$$
	\item \tred{add the rest of this proposition}
	\item if $p \in (1, \infty)$, $f \in W^{1,p}_0(T(U)) \iff f\circ T \in W^{1,p}_0(U)$
	\item therefore, composition by $T$ is a linear isomorphism between $W^{k,p}(T(U))\rightarrow W^{k,p}(U)$ for $k=0,1$, and between $W^{1,p}_0(T(U))\rightarrow W^{1,p}_0(U)$ for $k=0,1$, $p \in (1, \infty)$
	\item for $D$ a bounded Lipschitz domain and $\cT, \Te$ defined before, we get, for $f \in H^1(D)$, that $\tr f = \tr(f\circ T)$
	\item if moreover, $\Omega, T(\Omega) \cc D$ are also bounded Lipschitz domains, letting $U:=D\setminus \Omega$, another bounded Lipschitz domain, for $f \in H^1(T(U))$ and $\tr_{T(U)} f =0 $ on $ \partial T(\Omega) $, then $\tr_{U} f\circ T=0$ on $\partial \Omega$ and $\tr_{T(U)} f = \tr_{U} f\circ T$ on $\partial D$
	\item so, $\circ T$ is a linear isomorphism of $H^1_c(U)$ and $H^1_c(T(U))$ ($H^1_c$ is defined in \cref{subs:inh_diri})
\end{enumerate}

\end{thm}

\begin{mproof}

We need to prove only the last points, for the other are proved in \cite{murat}, pages IV.4, IV.5, IV.6.

\underline{Static strace}

To do so, let $f_n \in C(\overline{D})\cap H^1(D)$ converging in $H^1(D)$ to $f$. By point 4, we have $f_n \circ T\rightarrow f\circ T$ in $H^1(D)$ (rememeber, $T(D)=D$ by invertibility of $T$ and the fact that $T(x)=x$ outside of $D$). Therefore we have:

$$\tr f \leftarrow_{L^2(\partial D)}\tr(f_n) = f_n|_{\partial D} = (f_n\circ T)|_{\partial D}= \tr(f_n \circ T)\rightarrow_{L^2(\partial D)} \tr(f \circ T)$$

\underline{Zero moving trace}

First of all, as $T$ is a homeomorphism of $\mR^{n}$, $TU=D\setminus T(\Omega)$, $T\partial U = \partial D \sqcup \partial \Omega$, $T\partial \Omega = \partial T \Omega$.

Now, an application of \cref{thm:ibp} yields that the extension to $0$ in $T\Omega$ of $f$, call it $\bar{f}$, is $H^1(D)$, with $\partial_i \bar{f}=\partial_i f$ in $TU$, $0$ in $T(\Omega)$.

We claim that $\tr_D \bar{f} = \tr_{T(U)} f|_{\partial D}$. In fact, approximate $\bar{f}$ by restrictions to $D$ of $C^\infty_c(\mR^n)$ functions $f_n$ (see theorem 3.18 of \cite{adams}, page 54), which also approximate $f$ on ${T(U)}$, by the observation that $\norm{f_n|_{T(U)}}_{H^1({T(U)})}\leq \norm{f_n|_D}_{H^1(D)}$. Then:

$$\tr_{T(U)}( f_n|_{T(U)})|_{\partial D} = (f_n|_{T(U)})|_{\partial {T(U)}}|_{\partial D} = f_n|_{\partial D} = \tr_D ( f_n|_D ) $$

Now, by what we observed before, $\tr_{T(U)}( f_n|_{T(U)})\rightarrow \tr_{T(U)}(f) $ in $L^2(\partial {T(U)})$, so that $\tr_{T(U)}( f_n|_{T(U)})|_{\partial D} \rightarrow \tr_{T(U)}( f)|_{\partial D}$. On the other hand $\tr_D ( f_n|_D ) \rightarrow \tr_D \bar{f}$, which yields the claim.

Using this: $ \tr_{T(U)}( f)|_{\partial D} = \tr_D \bar{f} = \ind{point 5} = \tr_D(\bar{f}\circ T) = \tr_D(\overline{f \circ T}) = \tr_U (f\circ T)|_{\partial D}$, where we used that $\bar{f}\circ T$ is zero in $T^{-1}T\Omega = \Omega$ (because again $T$ maps null sets into null sets), so it is the zero extension $\overline{f \circ T}$ of $f\circ T$, and applied the same reasoning as above to conclude $\tr_D(\overline{f \circ T}) = \tr_U (f\circ T)|_{\partial D}$. Both $\bar{f}\circ T$ and $f\circ T$ are $H^1$ functions by point 2.

We can now also say that $\tr_U f\circ T=0 $ on $\partial \Omega$.

%In fact, let $\phi \in C^\infty_c(D)$. Then $ \int_D \bar{f}\circ T \phi_{,i} = \int_U  f\circ T \phi_{,i} = \ind{using \cref{thm:ibp}} = \int_{\partial \Omega}\tr_U(f\circ T) \phi \nu_i d\sigma -\int_U \partial_i(f\circ T)\phi =  \int_{\partial \Omega}\tr_U(f\circ T) \phi \nu_i d\sigma -\int_D \partial_i(\bar{f}\circ T)\phi  =  \int_{\partial \Omega}\tr_U(f\circ T) \phi \nu_i d\sigma +\int_D \bar{f}\circ T \phi_{,i}  $.
%
%It follows that $\int_{\partial \Omega}\tr_U(f\circ T) \phi \nu_i d\sigma = 0$ for all $\phi \in C^\infty_c(D)$. Let now $\phi_n \in C^\infty_c(\mR^n)$ approximate $f\circ T$ in $H^1(U)$ as seen above. Choose a cut-off function $\eta$ that is $1$ in a small neighbourhood of $ \Omega$ and $0$ in the complement of $D$ and a small neighbourhood of $\partial_D$. Then $\eta \phi_n$ is in $C^\infty_c(D)$ and:

$$(\eta \phi_n)|_{\partial \Omega} = \tr_U( \phi_n|_U)_{\partial \Omega} \rightarrow \tr_U(f \circ T)_{\partial \Omega}$$
%
%the limit being in $L^2(\partial \Omega)$. Because  $\eta \phi_n$ is in $C^\infty_c(D)$ we can choose it $\phi$ in $\int_{\partial \Omega}\tr_U(f\circ T) \phi \nu_i d\sigma = 0$, yielding:
%
%$$\int_{\partial \Omega}\tr_U(f\circ T) \phi_n \eta \nu_i d\sigma = 0$$ 
%
%This implies, thanks to the boundedness and measurability of $\nu_i$, that:
%
%$$\int_{\partial \Omega}\tr_U(f\circ T)^2\nu_i d\sigma = 0$$

\underline{Multiplication by a $W^{1,\infty}$ function}

We claim that, for $\psi \in W^{1,\infty}(\mR^n;\mR)$ and $f \in H^1(U)$, then $f\psi$ has the same trace as $f$ as long as $\psi = 1$ in a neighbourhood of $\partial U$.

Note that $f\psi \in H^1(U)$ still. Now: approximate $f$ by restriction of test functions $f_n$. Then $f_n \psi$ is $C(\overline{U})\cap H^1(U)$ (thanks also to \cref{prop:lipk}), so that $\tr_U(f_n\psi) = \tr_U(f_n)$. Because $f_n \psi \rightarrow f \psi$ is $H^1(U)$ the claim is valid.

This last convergence follows from $\norm{(f_n-f)\psi}_{L^2}\leq \norm{(f_n-f)}_{L^2}\norm{\psi}_{L^\infty}$, the chain rule $\partial_i(f_n\psi)=\partial_i f_n \psi + \partial_i \psi f_n$ (see \textcolor{red}{corollary 4.1.18 \href{https://www.math.stonybrook.edu/~joa/PUBLICATIONS/SOBOLEV.pdf}{here}}) and again $\norm{\partial_i(f_n-f)\psi}_{L^2}\leq \norm{\partial_i(f_n-f)}_{L^2}\norm{\psi}_{L^\infty}$, $\norm{(f_n-f)\partial_i\psi}_{L^2}\leq \norm{(f_n-f)}_{L^2}\norm{\partial_i\psi}_{L^\infty}$.

\underline{Reducing to a function of $0$ trace}

Let $\eta$ be a smooth cut-off function which is $1$ close to $\partial D$ and $0$ close to $\partial T\Omega$, $\beta=0$ close to $\partial D$ and $1$ close to $\partial T\Omega$. This can be accomplished by e.g. building a suitable partition of unity of the compact sets $\partial \Omega$ and $\partial D$. (\textcolor{red}{can I do this? Yes, see bachelor's thesis, take $K =\partial \Omega$ etc. Also, be careful with all of these equalities...}).

%Then $\beta + \eta = 1$ on $\partial T(U)$ and thus $\tr_{T(U)} f = \tr_{T(U)} (f(\eta+\beta)) = \tr_{T(U)} f\eta+\tr_{T(U)} f\beta$.

$f\beta$ has zero trace, as it can be verified by approximating $f$ by smooth functions again: 

$$\tr_{T(U)} f\beta \leftarrow_{L^2(\partial T(U))} \tr_{T(U)} f_n \beta $$

where the latter quantity is $\tr_{T(U)} f_n $ on $\partial T(U)$ and $0$ on $\partial D$. By restricting the convergence  to first $\partial D$ and then to $\partial T(U)$, and using almost everywhere convergent subsequences, we conclude that $\tr_{T(U)} f \beta = \tr_{T(U)} f $ on $\partial T(U)$ and  $\tr_{T(U)} f \beta = 0 $ on $\partial D$, i.e.  $f\beta$ has zero trace.

%The same argument yields that $\tr_{T(U)} f \eta = \tr_{T(U)} f $ on $\partial D$ and  $\tr_{T(U)} f \eta = 0 $ on $\partial T(U)$.
%
%Hence $\tr_{T(U)} f |_{\partial T(U)}= \tr_{T(U)} f\beta |_{\partial T(U)}$, with $f\beta$ of zero trace on $T(U)$. 

\underline{Domain transformation}

But zero trace functions in $H^1(T(U))$, since $T(U)$ is assumed to be bounded Lipschitz, are exactly the functions $H^1_0(T(U))$ (theorem 18.7 at page 595 of \cite{leoni}).

By then point 4, $(f\beta)\circ T \in H^1_0(U)$.

Because $T$ is bi-Lipschitz, we can write $(f\beta)\circ T = f \circ T \beta \circ T$ almost everywhere.

We have that $\beta \circ T +  \eta \circ T$ is $W^{1,\infty}$ and $1$ near $\partial U$. 

So, $\tr_U f\circ T = \tr_U f\circ T(\beta \circ T +  \eta \circ T) = \tr_U (f\circ T\beta \circ T) + \tr_U (f\circ T  \eta \circ T)$.

Approximate $f\circ T$ by $g_n$ smooth as seen above.  Then, $\tr_U (g_n \eta \circ T)$ is $0$ on $\partial \Omega$ and $\tr_U g_n$ on $\partial D$. By selecting an almost everywhere convergent subsequence, we conclude $\tr_U (f\circ T \eta \circ T) = 0$ on $\partial \Omega$. 

Hence  $\tr_U f\circ T|_{\partial \Omega} = tr_U f\circ T(\beta \circ T)|_{\partial \Omega} = 0$.

\end{mproof}

%We need to define the pullback of functionals. 
%
%\begin{ass}[Defining pullbacks]
%\label{ass:pull}
%
%Throughout, $\Omega\cc D$ is another bounded Lipschitz domain, and we assume $\tau \in \cT$ preserves this property, i.e., that $T (\Omega) $ is also bounded Lipschitz, $T=U(\tau)$.
%
%We denote by $V$ either $H^1_0(U)$ or $H^1_c(U)$ (see \cref{subs:inh_diri} for the definition of this space, and by $V_T$ either  $H^1_0(T(U))$ or $H^1_c(T(U))$.
%\end{ass}
%
%\begin{prop}[Pullback]
%\label{prop:pull}
%
%Under \cref{ass:pull}, let $F \in V_T^*$. We define $F\circ T \in V^*$ by:
%
%$$\langle F, v\rangle_{V^*_T,V_T} = \langle F\circ T , |\det(DT)| v\circ T\rangle_{V^*,V}$$
%
%The definition is well posed.
%
%Moreover:
%\begin{itemize}
%\item the maps $V\rightarrow V$, $w\mapsto w|\det(DT)|$, and $S_T: V_T\rightarrow V$, $v \mapsto |\det(DT)| v\circ T$ are linear isomorphisms
%\item taking pullbacks, seen as a map $P_T: V_T^*\rightarrow V^*$, is linear and bounded
%\item we have $P_T = S_T^{-*}$, so that taking pullbacks is also a linear isomorphism
%
%\end{itemize}
%
%
%\end{prop}
%\begin{mproof}
%
%\underline{Existence by density}
%
%Let $H_T \ni f_n \rightarrow F$ in $V_T^*$, possible by density of $H_T=L^2(T(U))$ in $V_T^*$.
%
%By \cref{thm:change} we observe that $g_n:=f_n\circ T \in H$ is Cauchy in $V^*$. In fact:
%
%\begin{align*}
%\langle g_n-g_m ,  w \rangle_{V^*,V}  = \int_U (g_n-g_m)w =\ind{change of variables} = \\
%\int_{T(U)} (f_n-f_m)w\circ T^{-1} |\det(D(T^{-1}))| = \\
%\langle f_n-f_m ,  w\circ T^{-1} |\det(D(T^{-1}))| \rangle_{V^*_T,V_T} 
%\end{align*}
%
%We have to prove that $w\circ T^{-1} |\det(D(T^{-1}))| \in V_T$. We start by showing that $|\det(D(T^{-1}))| \in W^{1,\infty}(D)$. Because $\tau \in \cT$, then $\det(D(T^{-1}))\in W^{1,\infty}(D)$, as a product of $W^{1,\infty}(D)$ functions, because we have $\tau^{-1}|_D \in W^{2,\infty}(D)$ (i.e. a product of bounded Lipschitz functions, hence, still bounded Lipschitz, see \cref{prop:lip}). And now, the absolute value of a $W^{1,\infty}(D)$ function, is still $W^{1,\infty}(D)$, because the absolute value preserve the Lipschitz continuity, and the boundedness.
%
%Also, $W^{1,\infty}\subseteq H^1$, so that $w\circ T^{-1} |\det(D(T^{-1}))| \in H^1(T(U))$. For the traces, we know by \cref{thm:change} that $w\circ T^{-1} \in V_T$. Suppose e.g. that $\tr(w\circ T^{-1})=0$ on $\partial T(U)$. Approximate $w\circ T^{-1}$ by $v_n$ smooth to conclude that  $\tr (w\circ T^{-1} |\det(D(T^{-1}))|) = \tr(w\circ T^{-1})\cdot  |\det(D(T^{-1}))|$. Here we have used that a $C^{0,1}_B$ function can be extended by continuity to the boundary, in view of its uniform continuity. This shows that $w\circ T^{-1} |\det(D(T^{-1}))| \in V_T$.
%
%Thus:
%
%\begin{align*}
%\langle g_n-g_m ,  w \rangle_{V^*,V} \leq \\
%\norm{f_n-f_m }_{V^*_T}\norm{  w\circ T^{-1} |\det(D(T^{-1}))| }_{V_T} 
%\end{align*}
%
%Call $d:=|\det(D(T^{-1}))| \in W^{1,\infty}(D)$. By the product rule we get $\norm{D( w\circ T^{-1} d)}_{L^2(T(U))}^2\leq \sum_i \left( \norm{d}_{L^\infty(D)}^2 +\norm{\partial_i d}_{L^\infty(D)}^2\right )^2 \norm{D(w\circ T^{-1})}_{V_T}^2$, which means that:
%
%\begin{align*}
%\langle g_n-g_m ,  w \rangle_{V^*,V} \leq \\
%C(T)\norm{f_n-f_m }_{V^*_T}\norm{w\circ T^{-1} }_{V_T} \leq\\
%C(T)\norm{f_n-f_m }_{V^*_T}\norm{w}_{V}
%\end{align*}
%
%where we used \cref{thm:change} in the last passage. Hence also $g_n$ is Cauchy in the Banach space $V^*$ and we can thus conclude the existence of $G \in V^*$ such that $g_n\rightarrow G$ in $V^*$.
%
%And now:
%
%\begin{align*}
%\langle f,  v \rangle_{V^*_T,V_T} = \lim \langle f_n,  v \rangle_{V^*_T,V_T} = \\
%\lim( f_n,v)_{H_T} =\ind{change of variables} =\\
%\lim( g_n,v\circ T |\det(DT)|)_{H} = \\
%\lim\langle g_n, v\circ T |\det(DT)| \rangle_{V^*,V} = \\
%\langle G, v\circ T |\det(DT)| \rangle_{V^*,V}
%\end{align*}
%
%where we used the fact that $v\circ T |\det(DT)| \in V_T$, in complete analogy with the above reasonings.
%
%\underline{Well posedness}
%
%So, $\langle F,  v \rangle_{V^*_T,V_T} = \langle G, v\circ T |\det(DT)| \rangle_{V^*,V}$.
%
%$|\det(DT)|$ is represented by $d \in C^{0,1}_B(D)$. In \cref{prop:chain} we saw $C\geq d\geq \delta >0$ almost everywhere in $\mR^n$. The inequality holds everywhere on $D$, by continuity of $d$. Then $1/d$ is bounded and Lipschitz, as we can verify by:
%
%$$\left | \frac{1}{d(x)}-\frac{1}{d(y)}\right |=\left| \frac{d(x)-d(y)}{d(x)d(y)}\right |\leq \delta^{-2}C|x-y|$$
%
%Therefore, multiplication by $d$ is a bijection of $V$ (a linear isomorphism actually, we already proved the boundedness, and the boundedness of the inverse follows from the bounded inverse theorem).
%
%Assume there exists another $G_2$ satisfying $\langle F,  v \rangle_{V^*_T,V_T} = \langle G_2, v\circ T |\det(DT)| \rangle_{V^*,V}$.
%
%Then  $\langle G_2-G, v\circ T |\det(DT)| \rangle_{V^*,V} = 0$ for all $v \in V_T$. Because $\circ T$ is another bijection, we can conclude  $\langle G_2-G, w \rangle_{V^*,V} = 0$ for all $w \in V$, which yields the uniqueness.
%
%\underline{Boundedness}
%
%Also, $S_T: V_T \rightarrow V$ defined by $S_Tv = |\det(DT)|v\circ T$ is a linear isomorphism, as a composition of linear isomorphism (see also \cref{prop:chain}). 
%
%Therefore:
%
%$$\langle F, v\rangle_{V^*_T,V_T} = \langle F\circ T , S_Tv\rangle_{V^*,V} =  \langle S_T^*(F\circ T), v\rangle_{V^*,V}$$
%
%This shows that $S_T^{-*}F=F\circ T = P_T F$, and this concludes the proof.
%		
%%Now, $w\circ T^{-1} \in V_T$ by \cref{thm:change}. We can also say that $|w \circ T^{-1} |\in V_T$, with $\norm{|w \circ T^{-1}|}_{V_T}\leq \norm{w \circ T^{-1}}_{V_T}$ (\tred{see \href{https://math.stackexchange.com/questions/2578760/if-u-in-h1-omega-then-u-in-h1-omega}{here} for the bound on the gradient, or \href{https://www.math.ucdavis.edu/~hunter/pdes/ch3.pdf}{here, prop. 3.22}}).
%%
%%In fact, absolute value preserves zero traces. To see this, suppose that $\tr f = 0$ on $\partial \Omega$. Then, as in the proof of \cref{thm:change}, $\tr |f| |_{\partial \Omega} = \tr(|f|\beta)|_{\partial \Omega}$, $\beta$ smooth, $1$ close to $\partial \Omega$ and $0$ close to $\partial D$. Approximating $|f_n|$ by smooth functions we see that: $\tr(|f|\beta)$
%
%\end{mproof}

\section{Transforming Bochner spaces}

\begin{prop}[Isomorphism between $Q$ spaces]
\label{prop:change_boch}

$$\circ T : Q(I,V_T)\rightarrow Q(I,V)$$

is a linear isomorphism, and so is:

$$\circ T : Q_0(I,V_T)\rightarrow Q_0(I,V)$$

In particular, $(u\circ T)' = u'\circ T$ (under suitable identifications, see the proof).

\end{prop}

\begin{mproof}

\underline{Existence of derivative}

Consider the following commutative diagram:

\[\begin{tikzcd}
	{V_T} & {H_T} & {H_T^*} & {V^*_T} \\
	V & H & {H^*} & {V^*}
	\arrow["{a_T}", hook, from=1-1, to=1-2]
	\arrow["{r_T}", from=1-2, to=1-3]
	\arrow["{a_T^*}", hook, from=1-3, to=1-4]
	\arrow["r", from=2-2, to=2-3]
	\arrow["a^*", hook, from=2-3, to=2-4]
	\arrow["a", hook, from=2-1, to=2-2]
	\arrow["{\circ T_H=:t_V}"', from=1-1, to=2-1]
	\arrow["{\circ T_H=:t_H}", from=1-2, to=2-2]
\end{tikzcd}\]

We know that $f\in Q(I,V_T)$ satisfies $a_Tf \in H^1(I,H_T)$. Therefore, by \cref{lemma:bochner_Hk_map}, $t_H a_T f =a t_V f \in H^1(I,H)$, and $t_v  \in L^2(I,V)$, so that $t_V : Q(I,V_T)\rightarrow Q(I,V)$ is well defined.

\underline{Boundedness}

We have that $t_V: V_T \rightarrow V$ is linear bounded, so that $t_V: L^2(I,V_T)\rightarrow L^2(I,V)$ is also linear and bounded. Still by \cref{lemma:bochner_Hk_map}, we have $(a t_V f )' = (t_H a_T f)' = t_H(a_T f)'$.

Thus $\norm{t_V f}_{L^2(I, V)}\leq C(T) \norm{f}_{L^2(I, V_T)}$, together with $\norm{(a t_V f )'}_{L^2(I, H)}\leq C(T) \norm{(a_T f)'}_{L^2(I, H_T)}$.

By noting that $(t_V)^{-1} = (\circ T)^{-1} $ is bijective, and by the bounded inverse theorem:

$$\circ T : Q(I,V_T)\rightarrow Q(I,V)$$

is a linear isomorphism.

\underline{Zero initial value}

Consider $at_V f$. It has a unique $C([0,T],H)$ representative, $U(at_V f)$. Also, $a_T f$ has a unique continuous representative $U(a_T f)$. Now, $at_V f = t_H a_T f$, so that $[U(at_V f)] = [t_H U(a_T f)]$. By continuity, $U(at_V f) = t_H U(a_T f)$ on $[0,T]$ and thus, whenever $U(a_T f)(0)=0$, so is $U(at_V f)$, informally, also $t_Vf (0) =0$. 

So, $t_V(Q_0(I,V_T))\subseteq Q_0(I,V)$.

$(t_V)^{-1} = (\circ T)^{-1}$ and we can conclude that  $t_V^{-1}(Q_0(I,V))\subseteq Q_0(I,V_T)$.

\end{mproof}


\section{Transforming partial differential equations}

We consider again the two parabolic equations of interest, namely, \cref{pb:diri} and \cref{pb:neu}.

We continue from \cref{prop:eq_form}.

\begin{align*}
w \in Q_0(I, H^1_c), v_0 \in Q_0(I,H^1_0) \\
\int_I ( w' , q)_H+ (\nabla w, \nabla q)_H = \int_I(g,\tr q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, H^1_c) \\
\int_I (v_0',p)_H + (\nabla v_0, \nabla p)_H= -\int_I(\bar{u}',p)_H+(\nabla \bar{u}, \nabla p)_H, \quad \forall p \in Q^0(I, H^1_0) 
\end{align*}

We are working under the assumption:

\begin{ass}
\label{ass:pull}

We have $T=U(\tau), \tau \in \cT$, $U\cc D$ bounded Lipschitz domains and we also assume that $T(U)$ is bounded Lipschitz.
\end{ass}

Suppose the problem is formulated on $T(U)$. To ease the notation, call $H^1_c(T(U))=V_T, H^1_c(U)=V, H^1_0(U)=W$ and analogously for the other spaces.

We write the problem as:

\begin{align*}
w^T \in Q_0(I, V_T), v_0^T \in Q_0(I,W_T) \\
\int_I  (w^T_t , q)_{H_T}+ (\nabla w^T, \nabla q^T)_{H_T} = \int_I(g,\tr_{T(U)} q^T)_{L^2(\Gamma_f)}, \quad \forall q^T \in Q^0(I, V) \\
\int_I (v^T_{0t},p)_{H_T} + (\nabla v_0^T, \nabla p^T)_{H_T}= -\int_I(\bar{u}',p^T)_{H_T}+(\nabla \bar{u}, \nabla p^T)_{H_T}, \quad \forall p^T \in Q^0(I, W_T)
\end{align*}

Applying a change of variables, we get equivalently:

\begin{align*}
w^T \in Q_0(I, V_T), v_0^T \in Q_0(I,W_T) \\
\int_I (w^T_t\circ T, q^T\circ T |\det(DT)|)_H+ (A_T\nabla (w^T\circ T), \nabla( q^T\circ T))_{H} =\\ \int_I(g,\tr_{T(U)} q^T)_{L^2(\Gamma_f)}, \quad \forall q^T \in Q^0(I, V_T) \\
\int_I(v_{0t}^T\circ T,p^T\circ T |\det(DT)|)_H + (A_T \nabla (v_0^T\circ T), \nabla( p^T\circ T))_{H}=\\ -\int_I((\bar{u}')\circ T,p^T\circ T |\det(DT)|)_{H}+(A_T \nabla (\bar{u} \circ T), \nabla (p^T\circ T))_{H}, \quad \forall p^T \in Q^0(I, W_T)
\end{align*}

Here $A_T = |\det(DT)|DT^{-1}(DT)^{-t}$.

Now, we note that:

\begin{itemize}
	\item $\tr_{T(U)} q = \tr_U(q\circ T)$ on $\Sigma_f$ by \cref{thm:change}
	\item $w_t^T\circ T = (w^T\circ T)_t$ by the proof of \cref{prop:change_boch} and analogously for $v_0$
	\item by \cref{prop:change_boch},$\circ T$ is a bijection between $Q^0(I,V_T)$ and $Q^0(I,V)$ and analogously for $W$
	\item $\bar{u} \in H^1(I,V_T)$ and that $\bar{u}'$ denoted the weak derivative in the $H^1(I,V_T)$ sense, so that \ref{prop:bochner_bound} yields $\bar{u}\circ T \in H^1(I,V)$ and $(\bar{u}\circ T )' = \bar{u}'\circ T $
\end{itemize}

We therefore get, equivalently:

\begin{align*}
w^T \in Q_0(I, V_T), v_0^T \in Q_0(I,W_T) \\
\int_I ( (w^T\circ T)_t , q |\det(DT)|)_H+ (A_T\nabla (w^T\circ T), \nabla q)_{H} =\\ \int_I(g,\tr_{U} q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, V) \\
\int_I ( (v_0^T\circ T)_t,p |\det(DT)|)_H + (A_T \nabla (v_0^T\circ T), \nabla p)_{H}=\\ -\int_I((\bar{u}\circ T)',p|\det(DT)|)_{H}+(A_T \nabla (\bar{u} \circ T), \nabla p)_{H}, \quad \forall p \in Q^0(I, W)
\end{align*}

and by \cref{prop:change_boch}, we also get $w^T\circ T \in Q_0(I,V), v_0^T\circ T \in Q_0(I,W)$.

%\tred{Note, here one could absorb $\det$ into the test functions, complicate the PDE but get rid of the time coefficients. From here one could prove a continuity result for the states and then get Frechet differentiability from Gateaux differentiability}.

On the other hand, consider:

\begin{align*}
w \in Q_0(I, V), v_0 \in Q_0(I,W) \\
\int_I ( w_t , q |\det(DT)|)_H+ (A_T\nabla w, \nabla q)_{H} =\int_I(g,\tr_{U} q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, V) \\
\int_I ( v_{0t},p |\det(DT)|)_H + (A_T \nabla v_0, \nabla p)_{H}=\\ -\int_I((\bar{u}\circ T)',p|\det(DT)|)_{H}+(A_T \nabla (\bar{u} \circ T), \nabla p)_{H}, \quad \forall p \in Q^0(I, W)
\end{align*}

Then, we note the following:

\begin{itemize}
	\item by \cref{prop:change_boch}, $w\circ T^{-1} \in Q_0(I, V_T), v_0\circ T^{-1} \in Q_0(I,W_T) $, and as seen above, $((w\circ T^{-1})\circ T)_t = (w\circ T^{-1})_t\circ T$ and the same goes for $v_0\circ T^{-1}$
\end{itemize}

Therefore we obtain, equivalently:

\begin{align*}
w\circ T^{-1} \in Q_0(I, V_T), v_0\circ T^{-1} \in Q_0(I,W_T) \\
\int_I ((w\circ T^{-1})_t , q^T)_{H_T}+ (\nabla (w\circ T^{-1}), \nabla q^T)_{H_T} = \\\int_I(g,\tr_{T(U)} q^T)_{L^2(\Gamma_f)}, \quad \forall q^T \in Q^0(I, V_T) \\
\int_I ((v_0\circ T^{-1})_t,p^T)_{H_T} + (\nabla (v_0\circ T^{-1}), \nabla p^T)_{H_T}= \\-\int_I(\bar{u}',p^T)_{H_T}+(\nabla \bar{u}, \nabla p^T)_{H_T}, \quad \forall p^T \in Q^0(I, W_T)
\end{align*}

and $w\circ T^{-1} \in Q_0(I, V_T), v_0\circ T^{-1} \in Q_0(I,W_T)$.

These findings can be summarized as follows.

\begin{thm}[Equivalent formulations with transported domain]
\label{thm:eq_pde}

Let \cref{ass:diri}, \cref{ass:neu}, \cref{ass:pull} hold.

Consider the following problems.

\begin{pb}[Joint parabolic problem, moving domain]
\label{pb:joint_mov}
\begin{align*}
w^T \in Q_0(I, V_T), v_0^T \in Q_0(I,W_T) \\
\int_I  (w^T_t , q^T)_{H_T}+ (\nabla w^T, \nabla q^T)_{H_T} = \int_I(g,\tr_{T(U)} q^T)_{L^2(\Gamma_f)}, \quad \forall q^T \in Q^0(I, V_T) \\
\int_I (v^T_{0t},p^T)_{H_T} + (\nabla v_0^T, \nabla p^T)_{H_T}= -\int_I(\bar{u}',p^T)_{H_T}+(\nabla \bar{u}, \nabla p^T)_{H_T}, \quad \forall p^T \in Q^0(I, W_T)
\end{align*}
\end{pb}

\begin{pb}[Joint parabolic problem, reference domain]
\label{pb:joint_ref}
\begin{align*}
w \in Q_0(I, V), v_0 \in Q_0(I,W) \\
\int_I ( w_t , q |\det(DT)|)_H+ (A_T\nabla w, \nabla q)_{H} =\int_I(g,\tr_{U} q)_{L^2(\Gamma_f)}, \quad \forall q \in Q^0(I, V) \\
\int_I ( v_{0t},p |\det(DT)|)_H + (A_T \nabla v_0, \nabla p)_{H}=\\ -\int_I((\bar{u}\circ T)',p|\det(DT)|)_{H}+(A_T \nabla (\bar{u} \circ T), \nabla p)_{H}, \quad \forall p \in Q^0(I, W)
\end{align*}
\end{pb}

We have the following:

\begin{itemize}
	\item consider $w^T \in Q_0(I, V_T), v_0^T \in Q_0(I,W_T)$. They solve \cref{pb:joint_mov} $\iff$ $w^T\circ T , v_0^T\circ T $ solve \cref{pb:joint_ref}
	\item consider $w \in Q_0(I, V), v_0^T \in Q_0(I,W)$. They solve \cref{pb:joint_ref} $\iff$ $w\circ T^{-1}, v_0\circ T^{-1}$ solve \cref{pb:joint_mov} 

\end{itemize}

Here, $A_T:=  (DT)^{-1}(DT)^{-t}|\det(DT)|$.

\end{thm}

\chapter{Inhomogenous FEM on smooth domains}

We consider a finite element method for approximating problems of the following form.

\begin{pb}[Inhomogeneous elliptic problem]
\label{pb:inh_elliptic}

Consider $\Omega \subseteq \mR^n$, $n=2,3$, with $C^2$ boundary, and data $f \in L^2(\Omega), g_D \in H^{3/2}(\Gamma_D), g_N \in H^{1/2}(\Gamma_N)$, where $\Gamma_D \sqcup \Gamma_N = \partial \Omega$ and $\overline{\Gamma_D}\cap \overline{\Gamma_N}=\emptyset$.

We assume $\Gamma_D$ to be non-empty.

The problem is:

$$
\left\{\begin{matrix}
-\Delta u + k u = f & \text{ on } \Omega \\ 
u = g_D & \text{ on } \Gamma_D \\ 
\partial_\nu u = g_N & \text{ on } \Gamma_N 
\end{matrix}\right.
$$

where $k \geq 0$ is a constant.

By this we mean to find $u \in H^1(\Omega)$ with:

$$a(u,v) = l(v), \text{ for all } v \in H^1_{0,D}$$

where $a(u,v) =\ds \int_{\Omega}\nabla u \nabla v + k \int_{\Omega} u  v$, and $l(v) = \ds\int_{\Omega}f v + \int_{\Gamma_N} g_{N}v$ and $H^1_{0,D}$ is the space of all $H^1$ functions with vanishing trace on $\Gamma_D$.

\textcolor{red}{Add existence, uniqueness, regularity}

\end{pb}
4.1, for an explanation), we define a polygonal/polyhedral meshing $\Omega_h$ of $\Omega$, which has boundary nodes on $\partial \Omega$. We denote by $\Gamma_{D,h}, \Gamma_{N,h}$ the discrete Dirichlet and Neumann boundaries, and by $S^1_{h,D} $ the space of piecewise linear lagrangian FEM $S^1_h$ which are zero on $\Gamma_{D,h}$.

We collect some useful tools to relate $\	Omega_h$ and $\Omega$.

\begin{prop}[Deformation into smooth boundary]
There exists $G_h: \Omega_h \rightarrow \Omega$ satisfying:

\begin{itemize}
	\item $G_h$ is a homeomorphism
	\item $G_h|_T$ is of class $C^2(T)$ for all closed simplices $T$ composing $\Omega_h$
	\item $G_h|_T = \id$ on interior simplices $T$ (those with at most one node on $\partial \Omega$)
	\item $G_h(\partial \Omega_h) = \partial \Omega$
	\item $G_h|_e=p$, where $e$ is an edge/face of $\partial \Omega_H$ and $p$ is the closest point operator to $\partial \Omega$ (so that $G_h|_{\partial \Omega_h}$ coincides with the boundary lift in Definition 4.12 of \cite{elliott})

\end{itemize}

\end{prop}
\begin{mproof}
See Section 4.1 of \cite{elliott} for the first three points, while the second-last one follows from $G_h$ being a homeomorphism.

The last one is a consequence of the definition of $G_h$, see \cite{elliott}.

\end{mproof}

Given $G_h$, we can define pullbacks and pushforwards of functions defined on $\Omega$ or $\Omega_h$.

\begin{prop}[Lift]
\label{prop:lift}
We define, for $u: \Omega \rightarrow \mR$, $u^{-l}:=u\circ G_h : \Omega_h \rightarrow \mR$, and analogously for $u_h: \Omega_h \rightarrow \mR$ we define $u_h^l:=u_h\circ G_h^{-1}$. We also need the mesh to be quasi-uniform (see Proposition 4.7 of \cite{elliott}).

There holds:

\begin{itemize}
	\item for $v_h \in S^1_{h}$, we have $v_h^l \in H^1(\Omega)$
	\item for $v_h \in S^1_{h,D}$, we have $v_h^l \in H^1(\Omega)$, with zero trace on $\Gamma_D$ 
	\item for $v_h  \in S^1_h$, one has the following norm equivalences, which don't depend on $h$:
	\begin{enumerate}
		\item $\norm{v_h}_{L^2(\partial \Omega_h)} \sim \norm{v_h^l}_{L^2(\partial \Omega)}$
		\item $\norm{v_h}_{L^2( \Omega_h)} \sim \norm{v_h^l}_{L^2( \Omega)}$
		\item $\norm{\nabla v_h}_{L^2( \Omega_h)} \sim \norm{\nabla v_h^l}_{L^2( \Omega)}$
	\end{enumerate}
\end{itemize}

\end{prop}

\begin{mproof}
The lifted $v_h$ mantains continuity at the edges, so that $v_h^l$ is in $H^1(\Omega)$ by an application of the divergence theorem on every (possibly curved) simplex $T^l$ composing $\Omega$.

For the zero trace property, given that $v_h^l \in H^1(\Omega)\cap C(\overline{\Omega})$, we use $G_h(\partial \Gamma_{D,h}) = \partial \Gamma_D$.

The other points are all contained in \cite{elliott}.

\end{mproof}

Now, define $f_h \in S^1_h, g_{N,h} \in S^1_h(\Gamma_{N,h})$ to be any finite element approximations of $f, g_N$. Note, here $S^1_h(\Gamma_{N,h})$ means the usual piecewise linear FEM space over  $\Gamma_{N,h}$.

We can now define the discrete approximation of \cref{pb:inh_elliptic}.

\begin{pb}[FEM approximation of \cref{pb:inh_elliptic}]
We find $u_h \in S^1_h$ with $u_h(p)=g_D(p)$ for all $p$ external nodes of $\partial \Omega_h$, and solving:

$$a_h(u_h,v_h) = l_h(v_h), \text{ for all } v_h \in S^1_{h,D}$$

where $a_h(u_h,v_h) =\ds \int_{\Omega_h}\nabla u_h \nabla v_h + k \int_{\Omega_h} u_h  v_h$, and $l_h(v_h) =\ds \int_{\Omega_h}f_h v_h + \int_{\Gamma_{N,h}} g_{h,N}v_h$


\textcolor{red}{Add existence, uniqueness, connection with Fenics}

\end{pb}

Note, we assumed $g_D \in H^{3/2}(\partial \Omega)$. Thanks to the $C^2$ smoothness of $\partial \Omega$ we can apply theorem 1.5.1.2 of \cite{grisvard} and obtain a $G \in H^2(\Omega)$ with $\tr_2 G = g_D$. Here $\tr_2$ denotes the trace operator from $H^2(\Omega)$. By Sobolev embeddings, $G \in C(\overline{\Omega})$. 

Now, we can pick $G_k \in C^\infty(\overline{\Omega})\cap H^2(\Omega)$ converging in $H^2(\Omega)$ to $G$. We can do so by \cite{adams}, theorem 3.18 at page 54. Then: $G_k|_{\partial \Omega}= \tr_2 G_k \rightarrow \tr_2 G = g_D$, and by $H^2(\Omega)\emb C(\overline{\Omega})$ we obtain $G|_{\partial \Omega} = g_D$, so that $g_D$ is continuous in both $n=2,3$ and so we can define its pointwise interpolation.

Alternatively we could have used Sobolev embeddings on manifolds to arrive to the same conclusion.

\begin{prop}[Interpolation on curved domains]
\label{prop:interp_curv}
Let $u \in H^2(\Omega)$, let $g \in H^2(\partial \Omega)$.

Let $u\in H^2(\Omega)$ and define $\Pi_c u = (\Pi_h u )^l$, where $\Pi_h$ is the usual pointwise Lagrange interpolator on $S^1_h$.

We can also define $\Pi_c g $ for $g \in H^2(\partial \Omega)$ in the same fashion.

It follows that:

\begin{itemize}
	\item $\norm{u-\Pi_c u}_{L^2(\Omega)} + h \norm{u-\Pi_c u}_{H^1(\Omega)}\lesssim h^2\norm{u}_{H^2(\Omega)}$
	\item $\norm{g-\Pi_c g}_{L^2(\partial \Omega)} + h \norm{g-\Pi_c g}_{H^1(\partial \Omega)}\lesssim h^2\norm{g}_{H^2(\partial \Omega)}$
\end{itemize}
Here $a \lesssim b$ means $a \leq Cb$ for $C\geq 0$ not depending on $h$.
\end{prop}

\begin{mproof}
See Proposition 5.4 of \cite{elliott}.
\end{mproof}

\begin{thm}[$H^1$ estimate]
For $h$ small enough, we have $\norm{u-u_h^l}_{H^1(\Omega)} \lesssim h + \norm{f-f_h^l}_{L^2(\Omega)}+ \norm{g_N-g_{h,N}^l}_{L^2(\Gamma_N)}$
\end{thm}
\begin{mproof}

We partially follow the structure of the arguments in \cite{edelmann}, making some simplifications, and modifications to adapt them to our case.

\underline{Conclusion}

$\norm{u-u_h^l}_{H^1(\Omega)}\leq \norm{u-\Pi_c u }_{H^1(\Omega)}+\norm{\Pi_c u-u_h^l}_{H^1(\Omega)}$. The interpolation estimates \cref{prop:interp_curv} allow us to worry only about the second term. It is  $\norm{(\Pi_h u-u_h)^l}_{H^1(\Omega)}\lesssim \norm{\Pi_h u-u_h}_{H^1(\Omega_h)}$ by \cref{prop:lift}. We estimate the latter quantity, calling $e_h := u_h - \Pi_h u$, which is zero on $\Gamma_{D,h}$.

\underline{Defect, $e_h$ and $u$}

Let $d_h \in S^1_{h,D}$ be the unique solution to $a_h(d_h,v_h)=l_h(v_h)-a_h(\Pi_h u,v_h)$, $v_h \in S^1_{h,D}$.

Using $0 = l_h(v_h)-a_h(u_h,v_h)$, $v_h \in S^1_{h,D}$, we come to $a_h(d_h-e_h,v_h)=0$,  $v_h \in S^1_{h,D}$. Testing with $d_h-e_h=0$ on $\Gamma_{D,h}$ and using the connectedness of $\Omega_h$, we conclude that $e_h=d_h$.

Moreover, by \cref{prop:lift}, we have $v_h^l \in H^1_{0,D}$, so that $a(u,v_h^l) = l(v_h^l)$ and thus :

$$a_h(e_h,v_h) = l_h(v_h)-l(v_h^l) + a(u,v_h^l)-a_h(\Pi_h u, v_h)$$

\underline{Estimation of $e_h$}

The form $a_h$ is $H^1$ coercive, $h-$uniformly. This we show by the following estimate, $C$ not depending on $h$:

\begin{align*}
a_h(v_h,v_h) = a(v_h^l,v_h^l) + a_h(v_h,v_h) - a(v_h^l,v_h^l)\\
\geq C\norm{v_h^l}_{H^1(\Omega)}^2 - |a_h(v_h,v_h) - a(v_h^l,v_h^l)|\\
\geq C\norm{v_h}_{H^1(\Omega_h)}^2 -C h \norm{v_h^l}_{H^1(\Omega)}^2\\
\geq C(1-h)\norm{v_h}_{H^1(\Omega_h)}^2
\end{align*} 

We used, in order:
\begin{itemize}
	\item  the $h-$uniform coercivity of $a$ (descending from the Poincaré inequality in which functions vanish only on part of the boundary, $\Gamma_D$, see e.g. lemma 1 of \cite{dorfler})
	\item \cref{prop:lift} on $\norm{v_h^l}_{H^1(\Omega)}^2$
	\item Proposition 4.6 of \cite{edelmann}
\end{itemize}

Therefore $\norm{e_h}^2_{H^1(\Omega_h)}\lesssim a_h(e_h,e_h) = l_h(e_h)-l(e_h^l) + a(u,e_h^l)-a_h(\Pi_h u, e_h)$, where we can test by $e_h=0$ on $\Gamma_{D,h}$.

This last term is estimated exactly as in Proposition 5.5 of \cite{edelmann}. In particular, we make use of th $H^2$ regularity of $u$, and we extend $g_{N,h}, g_N$ to zero, on $\Gamma_{D,h}, \Gamma_D$

\end{mproof}

For an $L^2$ error estimate we apply the Aubin-Nitsche trick, following \cite{fairweather} and \cite{edelmann}.

\begin{thm}[$L^2$ estimate]
Assume either that $f \in H^1(\Omega)$ or that $\norm{f^l_h}_{H^1(\Omega)}\lesssim \norm{f}_{L^2(\Omega)}$. Then, for $h$ small enough, we have $\norm{u-u_h^l}_{L^2(\Omega)}\lesssim h^2 + \norm{f-f_h^l}_{L^2(\Omega)}+ \norm{g_N-g_{h,N}^l}_{L^2(\Gamma_N)} + \norm{g_D - \Pi_c g_D}_{L^2(\Gamma_D)} + A$, where $A = 0$ if  $\norm{f^l_h}_{H^1(\Omega)}\lesssim \norm{f}_{L^2(\Omega)}$ and $A = h^2\norm{f-f_h^l}_{H^1(\Omega)}$ otherwise.
\end{thm}

\begin{mproof}

Define $e:=u-u_h^l$ (whose boundary values at $\Gamma_D$ are not necessarily $0$!), and $z$ solving the dual problem:

$$
\left\{\begin{matrix}
-\Delta z + k z = e & \text{ on } \Omega \\ 
z = 0 & \text{ on } \Gamma_D \\ 
\partial_\nu z = 0 & \text{ on } \Gamma_N 
\end{matrix}\right.
$$

This problem possesses $H^2$ regularity, so that we can write, after multiplying both sides by $e \in H^1$ (thanks to \cref{prop:lift}):

$$\norm{e}^2_{L^2(\Omega)} = a(z,e) - \int_{\partial \Omega} e \partial_\nu z  $$

Using that $z \in H^2$ we have that $\partial_\nu z=0$ on $\Gamma_N$, together with the estimate $\norm{z}_{H^2(\Omega)}\lesssim \norm{e}_{L^2(\Omega)}$ (\textcolor{red}{check!! It's done at page 92 of Grisvard}) and thus:

\begin{align*}
\norm{e}^2_{L^2(\Omega)} = a(z,e) +\norm{e}_{L^2(\Gamma_D)}\norm{ \partial_\nu z}_{L^2(\partial \Omega)} \\
\leq a(z,e) + C \norm{e}_{L^2(\Gamma_D)}\norm{e}_{L^2( \Omega)}
\end{align*}

Only $ a(z,e)$ remains to be estimated, and this is done in the proof of Theorem 5.3 of \cite{edelmann}, and in remark 5.6.

\end{mproof}

\begin{cor}[Actual estimates]
By assuming $f,g_N, g_D$ in $H^2$ we conclude $\norm{u-u_h^l}_{H^1(\Omega)} \lesssim h$,$ \norm{u-u_h^l}_{L^2(\Omega)} \lesssim h^2$.
\end{cor}

\begin{mproof}
It suffices to take $f_h:=\Pi_h f$, $g_{N,h} = \Pi_h g$ and employ \cref{prop:interp_curv}.
\end{mproof}

Unfortunately the smoothness assumptions to obtain optimal order of convergence are quite strict. However, the advantage of this approach is that it is straightforward to implement, and works in both dimensions $n=2,3$.

If one is concerned with just $H^1$ error estimates, without taking numerical integration into account, we can relax the requirements on $f$. Incidentally, how we are about to choose $f$, is more in line with the implementation of Fenics.

\begin{prop}[$H^1$ estimate with rougher $f$]
We choose $f_h=f $ on $\Omega \cap \Omega_h$ and $0$ otherwise, assuming $f \in H^1(\Omega)$. Then we obtain, for $h$ small enough, $\norm{u-u_h^l}_{H^1(\Omega)} \lesssim h + \norm{g_N-g_{h,N}^l}_{L^2(\Gamma_N)}$
\end{prop}
\begin{mproof}

Analysing the proof of Proposition 5.5 in \cite{edelmann} we see that we only need to prove that $\ds \left | \int_\Omega f v_h^l - \int_{\Omega_h}f_h v_h \right |\lesssim h \norm{v_h^l}_{H^1(\Omega)} $, for $v_h \in S^1_{h,D}$.

We can rewrite the difference as follows:

\begin{align*}
\int_\Omega f v_h^l - \int_{\Omega_h}f_h v_h   =\\
\int_{\Omega \cap \Omega_h} f v_h^l - \int_{\Omega_h \cap \Omega} f_h v_h  + \int_{\Omega \setminus \Omega_h} f v_h^l - \int_{\Omega_h \setminus \Omega} f_h v_h  =\\
\int_{\Omega \cap \Omega_h} f v_h^l - \int_{\Omega_h \cap \Omega} f_h v_h  + \int_{\Omega \setminus \Omega_h} f v_h^l = \\
\int_{\Omega \cap \Omega_h^\partial} f (v_h^l - v_h)  + \int_{\Omega \setminus \Omega_h} f v_h^l
\end{align*}

where we used that $f=0$ outside of $\Omega$, that $f=f_h$ in $\Omega \cap \Omega_h$ and that $v_h^l=v_h$ for all simplices with at most one node on $\partial \Omega$ (by the definition of $G_h$). The set of all the other (straight) simplices is denoted by $\Omega_h^\partial$.

For the first integral we have that for $h$ small enough, \textcolor{red}{$\Omega \setminus \Omega_h \subseteq N_{ch^2}$} (see \cite{tiihonen} for this), for $N_\delta :=\{ x \in \Omega, 0 <\text{dist}(x,\partial \Omega) < \delta\}$.

Using the assumption $f 	\in H^1(\Omega)$, together with Lemma 4.10 of \cite{elliott}, we conclude that:

\begin{align*}
\left | \int_{\Omega \setminus \Omega_h} f v_h^l \right | \leq \norm{f}_{L^2(N_\delta)} \norm{v_h^l}_{L^2(N_\delta)} \lesssim \delta \norm{f}_{H^1(\Omega)} \norm{v_h^l}_{H^1(\Omega)}
\end{align*} 

To control the other integral, we note that \textcolor{red}{$\Omega \cap \Omega_h^\partial \subseteq N_h$}, also for $h$ small enough. Then:

\begin{align*}
\left | \int_{\Omega \cap \Omega_h^\partial} f (v_h^l - v_h) \right | \leq \norm{f}_{L^2(N_h)}( \norm{v_h^l}_{L^2(N_h)} + \norm{v_h}_{L^2(\Omega \cap \Omega_h^\partial)})\\ \lesssim h^{1/2} \norm{f}_{H^1(\Omega)} ( h^{1/2}\norm{v_h^l}_{H^1(\Omega)}+ \norm{v_h}_{L^2(\Omega \cap \Omega_h^\partial)})
\end{align*} 

But $\norm{v_h}_{L^2(\Omega \cap \Omega_h^\partial)} \leq \norm{v_h}_{L^2(\Omega_h^\partial)} \lesssim \norm{v_h^l}_{L^2(G_h(\Omega_h^\partial))}$, the last inequality resulting upon a change of variables applied elementwise, and an application of (4.10b) from \cite{elliott} to estimate the appearing determinant.

Because \textcolor{red}{$G_h(\Omega_h^\partial)\subseteq N_h$}, the proof is concluded.

\end{mproof}

This same strategy brings us to an optimal $L^2$ error estimate, too.

\begin{prop}[$L^2$ estimate with rougher $f$]
We choose $f_h=f $ on $\Omega \cap \Omega_h$ and $0$ otherwise, assuming $f \in H^1(\Omega)$. Then we obtain, for $h$ small enough, we have $\norm{u-u_h^l}_{L^2(\Omega)}\lesssim h^{2} + \norm{g_N-g_{h,N}^l}_{L^2(\Gamma_N)} + \norm{g_D - \Pi_c g_D}_{L^2(\Gamma_D)}$.
\end{prop}

\begin{mproof}
Analyizing the proof of the $L^2$ estimate, and of Theorem 5.3 in \cite{edelmann}, we see that we only need to prove that $\ds \left | \int_\Omega f \Pi_c z - \int_{\Omega_h}f_h \Pi_h z \right |\lesssim h^2 \norm{e}_{L^2(\Omega)} $.

Just like before, we arrive at:

\begin{align*}
\int_\Omega f \Pi_c z - \int_{\Omega_h}f_h \Pi_h z   =\int_{\Omega \cap \Omega_h^\partial} f (\Pi_c z - \Pi_h z )  + \int_{\Omega \setminus \Omega_h} f \Pi_c z 
\end{align*}

Here, \cref{prop:interp_curv} lets us estimate $\norm{\Pi_c z}_{H^1(\Omega)}\lesssim \norm{z}_{H^2(\Omega)}$, for $h$ small, so that, just like in the previous proof, and using the $H^2$ regularity of $z$:

\begin{align*}
\left |\int_{\Omega \setminus \Omega_h} f \Pi_c z  \right | \lesssim h^2 \norm{f}_{H^1(\Omega)} \norm{z}_{H^2(\Omega)}\lesssim h^2 \norm{f}_{H^1(\Omega)} \norm{e}_{L^2(\Omega)}
\end{align*} 

Now, $\Omega$ is smooth enough for the existence of a bounded extension operator $E : H^2(\Omega) \rightarrow H^2(\mR^n)$ (see \cite{leoni}, theorem 13.17 at page 425, 13.13 at page 424, and definition 9.57 at page 273). Therefore:

\begin{align*}
\left | \int_{\Omega \cap \Omega_h^\partial} f (\Pi_c z - \Pi_h z )  \right |  \lesssim h^{1/2} \norm{f}_{H^1(\Omega)} \norm{\Pi_c z - \Pi_h z}_{L^2(\Omega \cap \Omega_h^\partial)}
\end{align*} 

But $\norm{\Pi_c z - \Pi_h z}_{L^2(\Omega \cap \Omega_h^\partial)} \leq \norm{\Pi_c z - z}_{L^2(\Omega)} +  \norm{Ez - \Pi_h Ez}_{L^2(\Omega_h)}$.

By \cref{prop:interp_curv} and by Theorem 3.1.6 of \cite{ciarlet}, with constants independent of $h$, we obtain $\norm{\Pi_c z - \Pi_h z}_{L^2(\Omega \cap \Omega_h^\partial)}  \leq C h^2(\norm{z}_{H^2(\Omega)} + \norm{Ez}_{H^2(\Omega_h)})\leq Ch^2(\norm{z}_{H^2(\Omega)} + \norm{Ez}_{H^2(\mR^n)})\lesssim h^2 \norm{z}_{H^2(\Omega)} \leq h^2  \norm{e}_{L^2(\Omega)}$.

Hence $\ds \left | \int_{\Omega \cap \Omega_h^\partial} f (\Pi_c z - \Pi_h z )  \right |  \lesssim h^{5/2} $ and the proof is concluded.

\end{mproof}

\printbibliography[title={Bibliography}]

\addcontentsline{toc}{chapter}{Bibliography}


\end{document}
